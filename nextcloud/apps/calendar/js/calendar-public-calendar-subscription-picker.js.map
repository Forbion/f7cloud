{"version":3,"file":"calendar-public-calendar-subscription-picker.js?v=53f900bc12b29964cc00","mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;AClGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAkBA;AACA;;;;;;;;;;;;;;;;ACvCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AGAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack:///calendar/src/components/Subscription/PublicCalendarSubscriptionPicker.vue?vue&type=script&lang=js","webpack:///calendar/src/components/Subscription/PublicCalendarSubscriptionPicker.vue?vue&type=template&id=61d243f8&scoped=true","webpack:///calendar/src/components/Subscription/PublicCalendarSubscriptionPicker.vue?vue&type=style&index=0&id=61d243f8&lang=scss&scoped=true","webpack:///calendar/src/components/Subscription/PublicCalendarSubscriptionPicker.vue","webpack://calendar/./src/components/Subscription/PublicCalendarSubscriptionPicker.vue?3ba4","webpack://calendar/./src/components/Subscription/PublicCalendarSubscriptionPicker.vue?4d16","webpack://calendar/./src/components/Subscription/PublicCalendarSubscriptionPicker.vue?db03","webpack://calendar/./src/components/Subscription/PublicCalendarSubscriptionPicker.vue?e134"],"sourcesContent":["import { NcButton, NcEmptyContent, NcModal } from '@nextcloud/vue';\nimport { showError } from '@nextcloud/dialogs';\nimport CalendarBlank from 'vue-material-design-icons/CalendarBlank.vue';\nimport { findAllSubscriptions } from '../../services/caldavService.js';\nimport holidayCalendars from '../../resources/holiday_calendars.json';\nimport { uidToHexColor } from '../../utils/color.js';\nimport { loadState } from '@nextcloud/initial-state';\nimport { mapStores } from 'pinia';\nimport useCalendarsStore from '../../store/calendars.js';\nconst isValidString = function (str) {\n  let allowNull = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  return typeof str === 'string' || str instanceof String || allowNull && !str;\n};\nconst isValidURL = str => {\n  try {\n    return Boolean(new URL(str));\n  } catch {\n    return false;\n  }\n};\nexport default {\n  name: 'PublicCalendarSubscriptionPicker',\n  components: {\n    CalendarBlank,\n    NcButton,\n    NcEmptyContent,\n    NcModal\n  },\n  props: {\n    showHolidays: Boolean\n  },\n  data() {\n    let calendars = [];\n    if (this.showHolidays) {\n      calendars = holidayCalendars.map(calendar => ({\n        ...calendar,\n        displayName: t('calendar', 'Holidays in {region}', {\n          region: calendar.country\n        }),\n        name: calendar.country,\n        description: calendar.datespan,\n        source: 'https://www.thunderbird.net/media/caldata/' + calendar.filename\n      }));\n    } else {\n      try {\n        const state = loadState('calendar', 'publicCalendars');\n        calendars = JSON.parse(state).filter(calendar => {\n          const isValid = isValidString(calendar.name) && isValidURL(calendar.source) && isValidString(calendar.displayName, true) && isValidString(calendar.description, true) && isValidString(calendar.authors, true);\n          if (!isValid) {\n            console.error('Invalid public calendar', calendar);\n          }\n          return isValid;\n        });\n      } catch (error) {\n        console.error('Could not read public calendars', error);\n        showError(this.$t('calendar', 'An error occurred, unable to read public calendars.'));\n      }\n    }\n    const subscribing = {};\n    const subscribed = {};\n    calendars.forEach(calendar => {\n      subscribing[calendar.source] = false;\n      subscribed[calendar.source] = false;\n    });\n    return {\n      calendars,\n      loading: true,\n      subscribed,\n      subscribing,\n      subscriptions: []\n    };\n  },\n  computed: {\n    ...mapStores(useCalendarsStore)\n  },\n  async mounted() {\n    this.subscriptions = await findAllSubscriptions();\n    this.subscriptions.map(sub => this.subscribed[sub.source] = true);\n    this.loading = false;\n  },\n  methods: {\n    async subscribe(calendar) {\n      try {\n        this.subscribing[calendar.source] = true;\n        await this.calendarsStore.appendSubscription({\n          displayName: calendar.displayName || calendar.name,\n          color: uidToHexColor(calendar.source),\n          source: calendar.source\n        });\n        this.subscribed[calendar.source] = true;\n      } catch (error) {\n        console.error('Could not add calendar subscription', error);\n        showError(this.$t('calendar', 'An error occurred, unable to subscribe to calendar.'));\n      } finally {\n        this.subscribing[calendar.source] = false;\n      }\n    }\n  }\n};","var render = function render() {\n  var _vm = this,\n    _c = _vm._self._c;\n  return _c(\"NcModal\", {\n    on: {\n      close: function ($event) {\n        return _vm.$emit(\"close\", $event);\n      }\n    }\n  }, [_c(\"div\", {\n    staticClass: \"public-calendar-subscription-picker\"\n  }, [_vm.showHolidays ? _c(\"h2\", [_vm._v(\"\\n\\t\\t\\t\" + _vm._s(_vm.t(\"calendar\", \"Public holiday calendars\")) + \"\\n\\t\\t\")]) : _c(\"h2\", [_vm._v(\"\\n\\t\\t\\t\" + _vm._s(_vm.t(\"calendar\", \"Public calendars\")) + \"\\n\\t\\t\")]), _vm._v(\" \"), !_vm.calendars.length ? _c(\"NcEmptyContent\", {\n    attrs: {\n      title: _vm.$t(\"calendar\", \"No valid public calendars configured\"),\n      description: _vm.$t(\"calendar\", \"Speak to the server administrator to resolve this issue.\")\n    },\n    scopedSlots: _vm._u([{\n      key: \"icon\",\n      fn: function () {\n        return [_c(\"CalendarBlank\", {\n          attrs: {\n            size: 20,\n            decorative: \"\"\n          }\n        })];\n      },\n      proxy: true\n    }], null, false, 2920828918)\n  }) : _vm.showHolidays ? _c(\"p\", {\n    staticClass: \"holiday-subscription-picker__attribution\"\n  }, [_vm._v(\"\\n\\t\\t\\t\" + _vm._s(_vm.t(\"calendar\", \"Public holiday calendars are provided by Thunderbird. Calendar data will be downloaded from {website}\", {\n    website: \"thunderbird.net\"\n  })) + \"\\n\\t\\t\")]) : _c(\"p\", {\n    staticClass: \"holiday-subscription-picker__attribution\"\n  }, [_vm._v(\"\\n\\t\\t\\t\" + _vm._s(_vm.t(\"calendar\", \"These public calendars are suggested by the sever administrator. Calendar data will be downloaded from the respective website.\")) + \"\\n\\t\\t\")]), _vm._v(\" \"), _vm._l(_vm.calendars, function (calendar) {\n    return _c(\"div\", {\n      key: calendar.source,\n      staticClass: \"public-calendar-subscription-picker__region\"\n    }, [_c(\"div\", {\n      staticClass: \"public-calendar-subscription-picker__region__name\"\n    }, [_c(\"h3\", [_vm._v(_vm._s(calendar.name))]), _vm._v(\" \"), calendar.description ? _c(\"div\", {\n      staticClass: \"public-calendar-subscription-picker__region__name__subline\"\n    }, [_vm._v(\"\\n\\t\\t\\t\\t\\t\" + _vm._s(calendar.description) + \"\\n\\t\\t\\t\\t\")]) : _vm._e(), _vm._v(\" \"), calendar.authors ? _c(\"div\", {\n      staticClass: \"public-calendar-subscription-picker__region__name__subline\"\n    }, [_vm._v(\"\\n\\t\\t\\t\\t\\t\" + _vm._s(_vm.t(\"calendar\", \"By {authors}\", {\n      authors: calendar.authors\n    })) + \"\\n\\t\\t\\t\\t\")]) : _vm._e()]), _vm._v(\" \"), _c(\"div\", {\n      staticClass: \"public-calendar-subscription-picker__region__subcribe\"\n    }, [_c(\"NcButton\", {\n      attrs: {\n        disabled: _vm.loading || _vm.subscribing[calendar.source] || _vm.subscribed[calendar.source]\n      },\n      on: {\n        click: function ($event) {\n          return _vm.subscribe(calendar);\n        }\n      }\n    }, [_vm._v(\"\\n\\t\\t\\t\\t\\t\" + _vm._s(_vm.subscribed[calendar.source] ? _vm.t(\"calendar\", \"Subscribed\") : _vm.t(\"calendar\", \"Subscribe\")) + \"\\n\\t\\t\\t\\t\")])], 1)]);\n  })], 2)]);\n};\nvar staticRenderFns = [];\nrender._withStripped = true;\nexport { render, staticRenderFns };","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.public-calendar-subscription-picker[data-v-61d243f8] {\n  padding: 20px;\n}\n.public-calendar-subscription-picker__attribution[data-v-61d243f8] {\n  color: var(--color-text-maxcontrast);\n}\n.public-calendar-subscription-picker__region[data-v-61d243f8] {\n  display: flex;\n  margin-top: 20px;\n  align-items: center;\n}\n.public-calendar-subscription-picker__region__name[data-v-61d243f8] {\n  flex-grow: 1;\n}\n.public-calendar-subscription-picker__region__name h3[data-v-61d243f8] {\n  font-weight: bold;\n  margin-bottom: initial;\n}\n.public-calendar-subscription-picker__region__name__subline[data-v-61d243f8] {\n  color: var(--color-text-maxcontrast);\n}`, \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import { render, staticRenderFns } from \"./PublicCalendarSubscriptionPicker.vue?vue&type=template&id=61d243f8&scoped=true\"\nimport script from \"./PublicCalendarSubscriptionPicker.vue?vue&type=script&lang=js\"\nexport * from \"./PublicCalendarSubscriptionPicker.vue?vue&type=script&lang=js\"\nimport style0 from \"./PublicCalendarSubscriptionPicker.vue?vue&type=style&index=0&id=61d243f8&lang=scss&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"61d243f8\",\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/var/www/nextcloud/apps/calendar/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('61d243f8')) {\n      api.createRecord('61d243f8', component.options)\n    } else {\n      api.reload('61d243f8', component.options)\n    }\n    module.hot.accept(\"./PublicCalendarSubscriptionPicker.vue?vue&type=template&id=61d243f8&scoped=true\", function () {\n      api.rerender('61d243f8', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/components/Subscription/PublicCalendarSubscriptionPicker.vue\"\nexport default component.exports","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicCalendarSubscriptionPicker.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicCalendarSubscriptionPicker.vue?vue&type=script&lang=js\"","export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??ruleSet[1].rules[3]!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicCalendarSubscriptionPicker.vue?vue&type=template&id=61d243f8&scoped=true\"","export * from \"-!../../../node_modules/vue-style-loader/index.js!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/resolve-url-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2.use[3]!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicCalendarSubscriptionPicker.vue?vue&type=style&index=0&id=61d243f8&lang=scss&scoped=true\"","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/resolve-url-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2.use[3]!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicCalendarSubscriptionPicker.vue?vue&type=style&index=0&id=61d243f8&lang=scss&scoped=true\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"170e1bda\", content, false, {});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/resolve-url-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2.use[3]!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicCalendarSubscriptionPicker.vue?vue&type=style&index=0&id=61d243f8&lang=scss&scoped=true\", function() {\n     var newContent = require(\"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/resolve-url-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2.use[3]!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicCalendarSubscriptionPicker.vue?vue&type=style&index=0&id=61d243f8&lang=scss&scoped=true\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}"],"names":[],"sourceRoot":""}