"use strict";(self.webpackChunkcalendar=self.webpackChunkcalendar||[]).push([["src_services_talkService_js-src_utils_calendarObject_js-src_utils_color_js-src_utils_date_js--af18c6"],{44109:(e,t,a)=>{a.d(t,{Ay:()=>i,Wj:()=>r});var n=a(88075);const r=e=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({},{attendeeProperty:null,commonName:null,calendarUserType:"INDIVIDUAL",participationStatus:"NEEDS-ACTION",role:"REQ-PARTICIPANT",rsvp:!1,uri:null,member:null},e)}({attendeeProperty:e,commonName:e.commonName,calendarUserType:e.userType,participationStatus:e.participationStatus,role:e.role,rsvp:e.rsvp,uri:e.email,member:e.member}),i=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=n.Uy.fromNameAndEMail(e.displayname,e.emailAddress,t);return a.userType=e.calendarUserType,r(a)}},75075:(e,t,a)=>{a.d(t,{DL:()=>p,NU:()=>f,P$:()=>n,RW:()=>y,W5:()=>r,Wh:()=>u,_l:()=>o,an:()=>l,bd:()=>d,fM:()=>c,mI:()=>s,rk:()=>m,vC:()=>i});const n="VEVENT",r="VJOURNAL",i="VTODO",s="principal:principals/users/",o="principal:principals/groups/",c="principal:principals/circles/",l="principal:principals/calendar-resources/",d="principal:principals/calendar-rooms/",p="contact_birthdays",u="personal",m="default",y="importing",f="processing"},58195:(e,t,a)=>{a.d(t,{BK:()=>p,Db:()=>c,JW:()=>d,Ky:()=>f,Ze:()=>v,a9:()=>C,dZ:()=>y,hC:()=>m,jb:()=>u,vV:()=>h,wo:()=>b,xX:()=>A});var n=a(32273),r=a(63814),i=a(75075);const s={},o=function(){const e=(e=>JSON.stringify(e))(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return s[e]||(s[e]=new n.Ay({rootUrl:(0,r.dC)("dav"),defaultHeaders:{"X-NC-CalDAV-Webcal-Caching":"On"}})),s[e]},c=async()=>{await o().connect({enableCalDAV:!0})},l=e=>o(e).calendarHomes[0],d=()=>l().findAllCalDAVCollectionsGrouped(),p=()=>l().findAllDeletedCalendars(),u=async e=>{const t=[];for(const a of e){const e=o().publicCalendarHome.find(a).catch((()=>null));t.push(e)}return(await Promise.all(t)).filter((e=>null!==e))},m=async()=>(await l().findAllScheduleOutboxes())[0],y=async(e,t,a,n,r)=>l().createCalendarCollection(e,t,a,n,r),f=async(e,t,a,n)=>l().createSubscribedCollection(e,t,a,n),h=async()=>(await l().enableBirthdayCalendar(),g()),g=async()=>l().find(i.DL),A=()=>o().currentUserPrincipal,v=async e=>o().principalPropertySearchByDisplaynameOrEmail(e),C=async e=>o().findPrincipal(e),b=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o().findPrincipalsInCollection(e,t)}},70784:(e,t,a)=>{a.d(t,{EX:()=>d});var n=a(70715),r=(a(53334),a(63814)),i=a(32981),s=a(21777),o=a(58544),c=a(73990),l=(a(83503),a(4364));async function d(e){const t=(0,i.C)("calendar","talk_api_version"),a=e.getConferenceList()[0]?.uri??e.location;if(!a||!a.startsWith(window.location.protocol+"//"+window.location.host))return void o.Ay.debug("Event's conference/location is from another host",a);const d=(p=a,p.match(/\/call\/([a-z0-9]*)(\/|#.*)?$/)?.[1]??void 0);var p;if(d)try{const{data:{ocs:{data:a}}}=await n.Ay.get((0,r.KT)("apps/spreed/api/"+t+"/",2)+"room/"+d),i=await n.Ay.get((0,r.KT)("apps/spreed/api/"+t+"/",2)+"room/"+d+"/participants");if(!i.data.ocs.data.some((e=>e.actorId===(0,s.HW)().uid&&e.participantType<=2)))return void o.Ay.debug("Current user is not a moderator or owner",{currentUser:(0,s.HW)().uid,conversation:i.data.ocs.data});l.info("room",a);for(const i of e.getAttendeeIterator()){if(o.Ay.debug("Processing attendee",{attendee:i}),["GROUP","RESOURCE","ROOM"].includes(i.userType))continue;const e=(0,c.nO)(i.email);try{const c=await n.Ay.get((0,r.KT)("core/autocomplete/",2)+"get?search="+encodeURIComponent(i.commonName??e)+"&itemType=&itemId=%20&shareTypes[]=0&limit=2");1===c.data.ocs.data.length&&c.data.ocs.data[0].id!==(0,s.HW)().uid&&c.data.ocs.data[0].shareWithDisplayNameUnique===e?await n.Ay.post((0,r.KT)("apps/spreed/api/"+t+"/",2)+"room/"+d+"/participants",{newParticipant:c.data.ocs.data[0].id,source:"users"}):c.data.ocs.data[0]?.id===(0,s.HW)().uid?o.Ay.debug("Skipping organizer "+c.data.ocs.data[0].id):3===a.type?await n.Ay.post((0,r.KT)("apps/spreed/api/"+t+"/",2)+"room/"+d+"/participants",{newParticipant:e,source:"emails"}):o.Ay.debug("Attendee "+e+" ignored as Talk participant")}catch(t){o.Ay.info("Could not add attendee "+e+" as Talk participant",{error:t})}}}catch(e){o.Ay.warn("Could not update Talk room attendees",{error:e})}else o.Ay.debug("URL "+a+" contains no call token")}},73990:(e,t,a)=>{function n(e){return"string"!=typeof e?"":e.startsWith("mailto:")?e.slice(7):e}a.d(t,{nO:()=>n})},53353:(e,t,a)=>{a.d(t,{s:()=>r});var n=a(88075);const r=(e,t)=>{const a=e.calendarComponent.getVObjectIterator().next().value;if(!a)return null;const r=n.Z4.fromJSDate(t,!0);return a.recurrenceManager.getOccurrenceAtExactly(r)}},2557:(e,t,a)=>{a.d(t,{GM:()=>o,dU:()=>l,mj:()=>d,nJ:()=>c});var n=a(16789),r=a(3550),i=a(9048),s=a(8330);function o(e){const t=(0,r.V)(e);return"#"+n.A.rgb.hex(t.r,t.g,t.b)}function c(e){return/^(#)((?:[A-Fa-f0-9]{3}){1,2})$/.test(e)?e:/^((?:[A-Fa-f0-9]{3}){1,2})$/.test(e)?"#"+e:/^(#)((?:[A-Fa-f0-9]{8}))$/.test(e)?e.slice(0,7):!!/^((?:[A-Fa-f0-9]{8}))$/.test(e)&&"#"+e.slice(0,6)}function l(e){return i[e]||null}function d(e){return(0,s.A)(e)}},68020:(e,t,a)=>{a.d(t,{PY:()=>r,RK:()=>n,z8:()=>i});a(58544);function n(){return new Date}function r(e){return Math.floor(e.getTime()/1e3)}function i(e){return new Date(e.year,e.month-1,e.day,e.hour,e.minute,0,0)}},58544:(e,t,a)=>{a.d(t,{Ay:()=>i,fH:()=>r});const n=(0,a(35947).YK)().setApp("calendar").detectUser().build(),r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.info(e,t)},i=n},87509:(e,a,n)=>{n.d(a,{default:()=>y});var r=n(41644),i=n(56809),s=n(26276),o=n(44109),c=n(15680),l=n(58195),d=n(77788),p=n(31728),u=n(88075);const m={name:"ContactsMenuAvailability",components:{FreeBusy:p.A},props:{userId:{type:String,required:!0},userDisplayName:{type:String,required:!0},userEmail:{type:String,required:!0}},data(){const e=u.Uy.fromNameAndEMail(this.userDisplayName,this.userEmail);return{initialized:!1,attendees:[(0,o.Wj)(e)]}},computed:{...(0,r.n2)(i.A,s.A),dialogName(){return t("calendar","Availability of {displayName}",{displayName:this.userDisplayName})},startDate:()=>new Date,endDate(){const e=new Date(this.startDate);return e.setHours(e.getHours()+1),e},organizer(){if(!this.principalsStore.getCurrentUserPrincipal)throw new Error("No principal available for current user");return(0,o.Ay)(this.principalsStore.getCurrentUserPrincipal,!0)}},async created(){this.initSettings(),await(0,l.Db)(),await this.principalsStore.fetchCurrentUserPrincipal(),(0,d.A)(),await this.loadMomentLocale(),this.initialized=!0},methods:{initSettings(){this.settingsStore.loadSettingsFromServer({timezone:"automatic"}),this.settingsStore.initializeCalendarJsConfig()},async loadMomentLocale(){const e=await(0,c.A)();this.settingsStore.setMomentLocale({locale:e})},addAttendee(e){let{commonName:t,email:a}=e;this.attendees.push((0,o.Wj)(u.Uy.fromNameAndEMail(t,a)))},removeAttendee(e){let{email:t}=e;this.attendees=this.attendees.filter((e=>e.uri!==t))},close(){this.$destroy()}}};const y=(0,n(22881).A)(m,(function(){var e=this,t=e._self._c;return e.initialized?t("FreeBusy",{attrs:{"dialog-name":e.dialogName,"start-date":e.startDate,"end-date":e.endDate,organizer:e.organizer,attendees:e.attendees,"disable-find-time":!0},on:{"add-attendee":e.addAttendee,"remove-attendee":e.removeAttendee,close:e.close}}):e._e()}),[],!1,null,"8287e564",null).exports}}]);
//# sourceMappingURL=calendar-src_services_talkService_js-src_utils_calendarObject_js-src_utils_color_js-src_utils_date_js--af18c6.js.map?v=36fd02e17ca404a314ae