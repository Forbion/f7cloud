/*! third party licenses: js/vendor.LICENSE.txt */
import{n as m,V as s}from"./index-C8Z_p2SP.chunk.mjs";import{B as y,i as C,K as g,L as d,v as l,U as p,W as b,a9 as u,u as v,Q as w,a6 as A,a7 as _,x as k,a8 as O}from"./style-DAlIvp5c.chunk.mjs";import{p as D,q as x,H as E}from"./index-D_VjvwME.chunk.mjs";import{l as P}from"./index-BiMVUFfi.chunk.mjs";const h="contacts",f="7.3.1",M={name:"AccountMultipleIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var S=function(){var e=this,a=e._self._c;return a("span",e._b({staticClass:"material-design-icon account-multiple-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(o){return e.$emit("click",o)}}},"span",e.$attrs,!1),[a("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[a("path",{attrs:{d:"M16 17V19H2V17S2 13 9 13 16 17 16 17M12.5 7.5A3.5 3.5 0 1 0 9 11A3.5 3.5 0 0 0 12.5 7.5M15.94 13A5.32 5.32 0 0 1 18 17V19H22V17S22 13.37 15.94 13M15 4A3.39 3.39 0 0 0 13.07 4.59A5 5 0 0 1 13.07 10.41A3.39 3.39 0 0 0 15 11A3.5 3.5 0 0 0 15 4Z"}},[e.title?a("title",[e._v(e._s(e.title))]):e._e()])])])},V=[],N=m(M,S,V,!1,null,null);const I=N.exports,{profileEnabled:$}=P("user_status","profileEnabled",!1),L={name:"ReadOnlyContactDetails",components:{ContactDetailsProperty:y,NcEmptyContent:D,IconContact:I,NcLoadingIcon:x},mixins:[C],props:{contactEmailAddress:{type:String,required:!0},desc:{type:String,required:!1,default:""}},data(){return{contactDetailsSelector:".contact-details",excludeFromBirthdayKey:"x-nc-exclude-from-birthday-calendar",bus:g(),showMenuPopover:!1,profileEnabled:$,contact:void 0,localContact:void 0,loading:!0}},computed:{formattedSubtitle(){const e=this.contact.title,a=this.contact.org;return e&&a?t("contacts","{title} at {organization}",{title:e,organization:a}):e?d(e):a?d(a):""},addressbooks(){return this.$store.getters.getAddressbooks},sortedProperties(){return!this.localContact||!this.localContact.properties?[]:this.localContact.properties.toSorted((e,a)=>{const o=e.name.split(".").pop(),r=a.name.split(".").pop();return l.fieldOrder.indexOf(o)-l.fieldOrder.indexOf(r)})},groupedProperties(){return this.sortedProperties?this.sortedProperties.reduce((e,a)=>(this.canDisplay(a)&&(e[a.name]||(e[a.name]=[]),e[a.name].push(a)),e),{}):{}},addressbookIsReadOnly(){return this.contact.addressbook?.readOnly},addressbook(){return this.contact.addressbook.id},groupsModel(){return{readableName:t("mail","Contact groups"),icon:"icon-contacts-dark"}}},watch:{contact:{handler(e){this.updateLocalContact(e)},immediate:!0}},async beforeMount(){await p.connect({enableCardDAV:!0}),b().setCurrentUserPrincipal(p),await this.$store.dispatch("getAddressbooks"),await this.fetchContact()},methods:{async fetchContact(){try{const e=this.contactEmailAddress,a=(await Promise.all(this.addressbooks.map(async o=>[o.dav,await o.dav.addressbookQuery([{name:[u.IETF_CARDDAV,"prop-filter"],attributes:[["name","EMAIL"]],children:[{name:[u.IETF_CARDDAV,"text-match"],value:e}]}])]))).flatMap(([o,r])=>r.map(i=>new v(i.data,o)));this.contact=a.find(o=>o.email===e)}catch(e){console.error("Error fetching contact:",e)}finally{this.loading=!1}},updateGroups(e){this.newGroupsValue=e},async updateLocalContact(e){if(!e){this.localContact=void 0;return}const a=Object.assign(Object.create(Object.getPrototypeOf(e)),e);w(a),this.localContact=a,this.newGroupsValue=[...this.localContact.groups]},canDisplay(e){const a=l.properties[e.name.split(".").pop()],o=a&&a.force?a.force:e.getDefaultType();return a&&o!=="unknown"}}};var z=function(){var e=this,a=e._self._c;return a("div",{staticClass:"display-contact-details"},[e.loading?a("div",{staticClass:"recipient-details-loading"},[a("NcLoadingIcon")],1):e.contact?a("div",{staticClass:"recipient-details-content"},[a("div",{staticClass:"contact-title"},[a("h6",[e._v(e._s(e.contact.fullName))]),a("span",{domProps:{innerHTML:e._s(e.formattedSubtitle)}})]),a("div",{staticClass:"contact-details-wrapper"},e._l(e.groupedProperties,function(o,r){return a("div",{key:r},e._l(o,function(i,c){return a("ContactDetailsProperty",{key:`${c}-${e.contact.key}-${i.name}`,attrs:{"is-first-property":c===0,"is-last-property":c===o.length-1,property:i,contact:e.contact,"local-contact":e.localContact,contacts:[e.contact],"is-read-only":!0,bus:e.bus}})}),1)}),0)]):a("NcEmptyContent",{staticClass:"empty-content",attrs:{name:e.t("mail","No data for this contact"),description:e.t("mail","No data for this contact on their profile")},scopedSlots:e._u([{key:"icon",fn:function(){return[a("IconContact",{attrs:{size:20}})]},proxy:!0}])})],1)},T=[],H=m(L,z,T,!1,null,"b647dd94");const R=H.exports;function j(e,a){s.use(A);const o=_();s.directive("Tooltip",E),s.prototype.t=t,s.prototype.n=n,s.prototype.appName=h,s.prototype.appVersion=f,s.prototype.logger=k,s.prototype.OC=window.OC,s.prototype.OCA=window.OCA;const r=s.extend(R);return new r({pinia:o,store:O,propsData:{contactEmailAddress:a}}).$mount(e)}window.OCA??={},window.OCA.Contacts={async mountContactDetails(e,a){return j(e,a)}};
//# sourceMappingURL=contacts-oca.mjs.map
