{"version":3,"file":"talk-node_modules_nextcloud_dialogs_dist_chunks_PublicAuthPrompt-ecDAsnUN_mjs-node_modules_nextclo-72c99b.js?v=6a876738deb78e1f546a","mappings":"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","sources":["webpack:///talk/node_modules/@nextcloud/dialogs/dist/chunks/PublicAuthPrompt-ecDAsnUN.mjs","webpack:///talk/node_modules/@nextcloud/vue/dist/chunks/NcTextField-D_IMz2MR.mjs"],"sourcesContent":["import { defineComponent } from \"vue\";\nimport { getBuilder } from \"@nextcloud/browser-storage\";\nimport { setGuestNickname } from \"@nextcloud/auth\";\nimport { showError } from \"@nextcloud/dialogs\";\nimport NcDialog from \"@nextcloud/vue/components/NcDialog\";\nimport NcNoteCard from \"@nextcloud/vue/components/NcNoteCard\";\nimport NcTextField from \"@nextcloud/vue/components/NcTextField\";\nimport { t, n as normalizeComponent } from \"./_plugin-vue2_normalizer-jrlE7CJU.mjs\";\nimport { validateFilename, InvalidFilenameError, InvalidFilenameErrorReason } from \"@nextcloud/files\";\n/*!\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nfunction getGuestNameValidity(name) {\n  if (name.trim() === \"\") {\n    return t(\"Names must not be empty.\");\n  }\n  if (name.startsWith(\".\")) {\n    return t(\"Names must not start with a dot.\");\n  }\n  if (name.length > 64) {\n    return t(\"Names may be at most 64 characters long.\");\n  }\n  try {\n    validateFilename(name);\n    return \"\";\n  } catch (error) {\n    if (!(error instanceof InvalidFilenameError)) {\n      throw error;\n    }\n    switch (error.reason) {\n      case InvalidFilenameErrorReason.Character:\n        return t('\"{char}\" is not allowed inside a name.', { char: error.segment });\n      case InvalidFilenameErrorReason.ReservedName:\n        return t('\"{segment}\" is a reserved name and not allowed.', { segment: error.segment });\n      case InvalidFilenameErrorReason.Extension:\n        if (error.segment.match(/\\.[a-z]/i)) {\n          return t('\"{extension}\" is not an allowed name.', { extension: error.segment });\n        }\n        return t('Names must not end with \"{extension}\".', { extension: error.segment });\n      default:\n        return t(\"Invalid name.\");\n    }\n  }\n}\nconst storage = getBuilder(\"public\").build();\nconst _sfc_main = defineComponent({\n  name: \"PublicAuthPrompt\",\n  components: {\n    NcDialog,\n    NcNoteCard,\n    NcTextField\n  },\n  props: {\n    /**\n     * Preselected nickname\n     * @default '' No name preselected by default\n     */\n    nickname: {\n      type: String,\n      default: \"\"\n    },\n    /**\n     * Dialog title\n     */\n    title: {\n      type: String,\n      default: t(\"Guest identification\")\n    },\n    /**\n     * Dialog text under the dialog title\n     * e.g 'Enter your name to access the file'\n     * @default '' Not shown by default\n     */\n    text: {\n      type: String,\n      default: \"\"\n    },\n    /**\n     * Dialog notice\n     * @default 'You are currently not identified.'\n     */\n    notice: {\n      type: String,\n      default: \"\"\n    },\n    /**\n     * Dialog submit button label\n     * @default 'Submit name'\n     */\n    submitLabel: {\n      type: String,\n      default: t(\"Submit name\")\n    },\n    /**\n     * Whether the dialog is cancellable\n     * @default false\n     */\n    cancellable: {\n      type: Boolean,\n      default: false\n    }\n  },\n  setup() {\n    return {\n      t\n    };\n  },\n  emits: [\"close\"],\n  data() {\n    return {\n      name: \"\"\n    };\n  },\n  computed: {\n    dialogButtons() {\n      const cancelButton = {\n        label: t(\"Cancel\"),\n        variant: \"tertiary\",\n        callback: () => this.$emit(\"close\")\n      };\n      const submitButton = {\n        label: this.submitLabel,\n        type: \"submit\",\n        variant: \"primary\"\n      };\n      if (this.cancellable) {\n        return [cancelButton, submitButton];\n      }\n      return [submitButton];\n    },\n    defaultNotice() {\n      if (this.notice) {\n        return this.notice;\n      }\n      if (this.nickname) {\n        return t(\"You are currently identified as {nickname}.\", { nickname: this.nickname });\n      }\n      return t(\"You are currently not identified.\");\n    }\n  },\n  watch: {\n    /** Reset name to pre-selected nickname (e.g. Talk / Collabora ) */\n    nickname: {\n      handler() {\n        this.name = this.nickname;\n      },\n      immediate: true\n    },\n    name() {\n      const newName = this.name.trim?.() || \"\";\n      const input = this.$refs.input?.$el.querySelector(\"input\");\n      if (!input) {\n        return;\n      }\n      const validity = getGuestNameValidity(newName);\n      input.setCustomValidity(validity);\n      input.reportValidity();\n    }\n  },\n  methods: {\n    onSubmit() {\n      const input = this.$refs.input;\n      const nickname = this.name.trim();\n      if (nickname === \"\") {\n        input.setCustomValidity(t(\"You cannot leave the name empty.\"));\n        input.reportValidity();\n        input.focus();\n        return;\n      }\n      if (nickname.length < 2) {\n        input.setCustomValidity(t(\"Please enter a name with at least 2 characters.\"));\n        input.reportValidity();\n        input.focus();\n        return;\n      }\n      try {\n        setGuestNickname(nickname);\n      } catch (e) {\n        showError(t(\"Failed to set nickname.\"));\n        console.error(\"Failed to set nickname\", e);\n        input.focus();\n        return;\n      }\n      storage.setItem(\"public-auth-prompt-shown\", \"true\");\n      this.$emit(\"close\", this.name);\n    }\n  }\n});\nvar _sfc_render = function render() {\n  var _vm = this, _c = _vm._self._c;\n  _vm._self._setupProxy;\n  return _c(\"NcDialog\", { staticClass: \"public-auth-prompt\", attrs: { \"buttons\": _vm.dialogButtons, \"data-cy-public-auth-prompt-dialog\": \"\", \"is-form\": \"\", \"no-close\": \"\", \"name\": _vm.title }, on: { \"submit\": _vm.onSubmit } }, [_vm.text ? _c(\"p\", { staticClass: \"public-auth-prompt__text\" }, [_vm._v(\" \" + _vm._s(_vm.text) + \" \")]) : _vm._e(), _c(\"NcNoteCard\", { staticClass: \"public-auth-prompt__header\", attrs: { \"text\": _vm.defaultNotice, \"type\": \"info\" } }), _c(\"NcTextField\", { ref: \"input\", staticClass: \"public-auth-prompt__input\", attrs: { \"data-cy-public-auth-prompt-dialog-name\": \"\", \"label\": _vm.t(\"Name\"), \"placeholder\": _vm.t(\"Enter your name\"), \"required\": !_vm.cancellable, \"minlength\": \"2\", \"maxlength\": \"64\", \"name\": \"name\" }, model: { value: _vm.name, callback: function($$v) {\n    _vm.name = $$v;\n  }, expression: \"name\" } })], 1);\n};\nvar _sfc_staticRenderFns = [];\nvar __component__ = /* @__PURE__ */ normalizeComponent(\n  _sfc_main,\n  _sfc_render,\n  _sfc_staticRenderFns,\n  false,\n  null,\n  \"414f7090\"\n);\nconst PublicAuthPrompt = __component__.exports;\nexport {\n  PublicAuthPrompt as default\n};\n//# sourceMappingURL=PublicAuthPrompt-ecDAsnUN.mjs.map\n","import { b as mdiUndo, c as mdiClose, d as mdiArrowRight } from \"./mdi-DXu6GWVJ.mjs\";\nimport { N as NcInputField } from \"./NcInputField-kKgY_2GV.mjs\";\nimport { u as useModelMigration } from \"./useModelMigration-EhAWvqDD.mjs\";\nimport { r as register, b as t50, c as t17, a as t } from \"./_l10n-BEfeU7gr.mjs\";\nimport { N as NcIconSvgWrapper } from \"./NcIconSvgWrapper-BreCg8pX.mjs\";\nimport { n as normalizeComponent } from \"./_plugin-vue2_normalizer-DU4iP6Vu.mjs\";\nregister(t17, t50);\nconst NcInputFieldProps = new Set(Object.keys(NcInputField.props));\nconst _sfc_main = {\n  name: \"NcTextField\",\n  components: {\n    NcIconSvgWrapper,\n    NcInputField\n  },\n  // Allow forwarding all attributes\n  inheritAttrs: false,\n  model: {\n    prop: \"modelValue\",\n    event: \"update:modelValue\"\n  },\n  props: {\n    /**\n     * Any [NcInputField](#/Components/NcFields?id=ncinputfield) props\n     */\n    // Not an actual prop but needed to show in vue-styleguidist docs\n    // eslint-disable-next-line\n    \" \": {},\n    // Reuse all the props from NcInputField for better typing and documentation\n    ...NcInputField.props,\n    /**\n     * The `aria-label` to set on the trailing button\n     * If no explicit value is set it will default to the one matching the `trailingButtonIcon`:\n     *\n     * @default 'Clear text'|'Save changes'|'Undo changes'\n     */\n    trailingButtonLabel: {\n      type: String,\n      default: \"\"\n    },\n    // Custom props\n    /**\n     * Specifies which material design icon should be used for the trailing\n     * button.\n     *\n     * The `'arrowRight'` value is deprecated and will be removed in the next major version.\n     * Use `'arrowEnd'` instead.\n     *\n     * @type {'close'|'arrowEnd'|'arrowRight'|'undo'}\n     */\n    trailingButtonIcon: {\n      type: String,\n      default: \"close\",\n      validator: (value) => [\n        \"close\",\n        \"arrowEnd\",\n        \"arrowRight\",\n        \"undo\"\n      ].includes(value)\n    }\n  },\n  emits: [\n    /**\n     * Removed in v9 - use `update:modelValue` (`v-model`) instead\n     *\n     * @deprecated\n     */\n    \"update:value\",\n    \"update:modelValue\",\n    /** Same as update:modelValue for Vue 2 compatibility */\n    \"update:model-value\"\n  ],\n  setup() {\n    const model = useModelMigration(\"value\", \"update:value\");\n    return {\n      model,\n      mdiArrowRight,\n      mdiClose,\n      mdiUndo\n    };\n  },\n  computed: {\n    /**\n     * Is the trailing button icon directional.\n     * Meaning the icon needs to be flipped on RTL text flow.\n     */\n    isArrow() {\n      return this.trailingButtonIcon === \"arrowEnd\" || this.trailingButtonIcon === \"arrowRight\";\n    },\n    propsAndAttrsToForward() {\n      const predefinedLabels = {\n        arrowEnd: t(\"Save changes\"),\n        arrowRight: t(\"Save changes\"),\n        close: t(\"Clear text\"),\n        undo: t(\"Undo changes\")\n      };\n      return {\n        // Proxy all the HTML attributes\n        ...this.$attrs,\n        // Proxy original NcInputField's props\n        ...Object.fromEntries(Object.entries(this.$props).filter(([key]) => NcInputFieldProps.has(key))),\n        // Adjust aria-label for predefined trailing buttons\n        trailingButtonLabel: this.trailingButtonLabel || predefinedLabels[this.trailingButtonIcon]\n      };\n    }\n  },\n  methods: {\n    /**\n     * Focus the input element\n     *\n     * @public\n     */\n    focus() {\n      this.$refs.inputField.focus();\n    },\n    /**\n     * Select all the text in the input\n     *\n     * @public\n     */\n    select() {\n      this.$refs.inputField.select();\n    }\n  }\n};\nvar _sfc_render = function render() {\n  var _vm = this, _c = _vm._self._c;\n  return _c(\"NcInputField\", _vm._g(_vm._b({ ref: \"inputField\", scopedSlots: _vm._u([!!_vm.$scopedSlots.icon || !!_vm.$slots.default || !!_vm.$scopedSlots.default ? { key: \"icon\", fn: function() {\n    return [_vm._t(\"icon\", function() {\n      return [_vm._t(\"default\")];\n    })];\n  }, proxy: true } : null, _vm.type !== \"search\" ? { key: \"trailing-button-icon\", fn: function() {\n    return [_vm.isArrow ? _c(\"NcIconSvgWrapper\", { attrs: { \"directional\": \"\", \"path\": _vm.mdiArrowRight } }) : _c(\"NcIconSvgWrapper\", { attrs: { \"path\": _vm.trailingButtonIcon === \"undo\" ? _vm.mdiUndo : _vm.mdiClose } })];\n  }, proxy: true } : null], null, true) }, \"NcInputField\", _vm.propsAndAttrsToForward, false), _vm.$listeners));\n};\nvar _sfc_staticRenderFns = [];\nvar __component__ = /* @__PURE__ */ normalizeComponent(\n  _sfc_main,\n  _sfc_render,\n  _sfc_staticRenderFns,\n  false,\n  null,\n  null\n);\nconst NcTextField = __component__.exports;\nexport {\n  NcTextField as N\n};\n//# sourceMappingURL=NcTextField-D_IMz2MR.mjs.map\n"],"names":["getGuestNameValidity","name","error","storage","_sfc_main","cancelButton","submitButton","newName","input","validity","nickname","e","_sfc_render","_vm","_c","$$v","_sfc_staticRenderFns","__component__","PublicAuthPrompt","NcInputFieldProps","value","predefinedLabels","key","NcTextField"],"sourceRoot":""}