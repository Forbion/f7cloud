<div class="header g-ui-user-select-none">
	<a href="#" class="close" data-bind="click: tryToClose">×</a>
	<h3 class="legend" data-bind="visible: !edit()" data-i18n="POPUPS_IDENTITY/TITLE_ADD_IDENTITY"></h3>
	<h3 class="legend" data-bind="visible: edit" data-i18n="POPUPS_IDENTITY/TITLE_UPDATE_IDENTITY"></h3>
</div>
<form id="identityform" class="modal-body" autocomplete="off" spellcheck="false" data-bind="submit: submitForm">
	<div class="alert" data-bind="visible: '' !== submitError()">
		<a href="#" class="close" data-bind="click: function () { submitError('') }">×</a>
		<span data-bind="text: submitError"></span>
	</div>

	<div class="tabs" data-bind="with: identity">
		<input type="radio" name="identitytabs" id="tab-identity" checked>
		<label for="tab-identity" role="tab" aria-selected="true" aria-controls="panel1" tabindex="0">
			<img src="/themes/forbion/images/snappymail/mainTabAccounts.svg">
			<span>
				Основные
			</span>
		</label>
		<div class="form-horizontal tab-content" role="tabpanel" aria-hidden="false">
			<div class="control-group">
				<label>
					Имя
				</label>
				<input name="Name" type="text" class="input-xlarge"
					autocomplete="off" autocorrect="off" autocapitalize="off"
					data-bind="value: name, hasfocus: $root.nameFocused">
			</div>
			<div class="control-group">
				<label>E-mail</label>
				<div>
					<div class="textEmail" data-bind="text: email, visible: !id()"></div>
					<input name="Email" type="email" class="input-xlarge" autofocus=""
						autocomplete="off" autocorrect="off" autocapitalize="off"
						data-bind="visible: id, value: email, attr: {required: !!id()}">
				</div>
			</div>
			<div class="control-group">
				<label>Подпись</label>
				<div>
					<input name="Label" type="text" class="input-xlarge" autofocus=""
						autocomplete="off" autocorrect="off" autocapitalize="off"
						data-bind="value: label, hasfocus: $root.labelFocused">
				</div>
			</div>
		</div>

		<input type="radio" name="identitytabs" id="tab-identity-signature">
		<label for="tab-identity-signature" role="tab" aria-selected="false" aria-controls="panel2" tabindex="0">
			<img src="/themes/forbion/images/snappymail/textTabAccounts.svg">
			<span>
				Текст
			</span>
		</label>
		<div class="form-horizontal tab-content" role="tabpanel" aria-hidden="false">
			<div class="e-signature-place" data-bind="editor: signature"></div>
			<div data-bind="component: {
				name: 'Checkbox',
				params: {
					label: 'POPUPS_IDENTITY/LABEL_SIGNATURE_INSERT_BEFORE',
					value: signatureInsertBefore,
					name: 'SignatureInsertBefore'
				}
			}"></div>
		</div>

		<input type="radio" name="identitytabs" id="tab-identity-crypto">
		<label for="tab-identity-crypto" role="tab" aria-selected="false" aria-controls="panel3" tabindex="0">
			<img src="/themes/forbion/images/snappymail/cryptoTabAccounts.svg">
			<span>
				Шифрование
			</span>
		</label>
		<div class="form-horizontal tab-content" role="tabpanel" aria-hidden="false">
			<div class="control-group">
				<div data-bind="component: {
					name: 'Checkbox',
					params: {
						label: 'CRYPTO/SIGN',
						value: pgpSign,
						name: 'pgpSign'
					}
				}"></div>
			</div>
			<div class="control-group">
				<div data-bind="component: {
					name: 'Checkbox',
					params: {
						label: 'CRYPTO/ENCRYPT',
						value: pgpEncrypt,
						name: 'pgpEncrypt'
					}
				}"></div>
			</div>
<!--
			<div class="control-group">
				<label data-i18n="CRYPTO/ENCRYPT"></label>
				<select name="PgpEncrypt" data-bind="value: pgpEncrypt">
					<option value="Ask" data-i18n="CONTACTS/ASK"></option>
					<option value="Never" data-i18n="CONTACTS/NEVER"></option>
					<option value="Always" data-i18n="CONTACTS/ALWAYS"></option>
					<option value="IfPossible" data-i18n="CONTACTS/ALWAYS_IF_POSSIBLE"></option>
				</select>
			</div>
-->
			<details>
				<summary><strong>S/MIME</strong></summary>
				<div class="control-group" data-bind="css: {'error': smimeKey() && !smimeKeyValid()}">
					<label>Приватный ключ</label>
					<textarea name="smimeKey" class="input-xxlarge" rows="14" autofocus="" autocomplete="off" data-bind="value: smimeKey"></textarea>
				</div>
<!--				<div class="control-group" data-bind="visible:smimeKeyValid() && !smimeKeyEncrypted()"> -->
				<div class="control-group" data-bind="visible:smimeKeyValid">
					<label></label>
					<button type="button" data-bind="click: $root.setSMimeKeyPass" data-i18n="CRYPTO/CHANGE_PASS"></button>
				</div>
				<div class="control-group" data-bind="css: {'error': smimeCertificate() && !smimeCertificateValid()}">
					<label>Сертификат</label>
					<textarea name="smimeCertificate" class="input-xxlarge" rows="14" autofocus="" autocomplete="off" data-bind="value: smimeCertificate"></textarea>
				</div>
				<div class="control-group" data-bind="hidden:smimeCertificate">
					<label></label>
					<button type="button" data-bind="click: $root.createSelfSigned">Создать self-signed</button>
				</div>
			</details>
		</div>

		<input type="radio" name="identitytabs" id="tab-identity-advanced">
		<label for="tab-identity-advanced" role="tab" aria-selected="false" aria-controls="panel4" tabindex="0">
			<img src="/themes/forbion/images/snappymail/moreTabAccounts.svg">
			<span>
				Расширенный
			</span>
		</label>
		<div class="form-horizontal tab-content" role="tabpanel" aria-hidden="false">
			<div class="control-group">
				<label>Ответить на</label>
				<input name="ReplyTo" type="email" class="inputReplyTo input-xlarge"
					autocomplete="off" autocorrect="off" autocapitalize="off"
					data-bind="value: replyTo">
			</div>
			<div class="control-group">
				<label>Скрытая</label>
				<input name="Bcc" type="email" class="inputBcc input-xlarge"
					autocomplete="off" autocorrect="off" autocapitalize="off"
					data-bind="value: bcc">
			</div>
			<div class="control-group">
				<label>Отправленные</label>
				<select name="sentFolder" data-bind="options: $root.folderSelectList, value: sentFolder,
							optionsText: function(item) {
							var nameMap = {
								'dovecot': 'Сервер',
								'Shared': 'Общие',
								'INBOX': 'Входящие',
								'INFO': 'Инфо',
								'sieve': 'Фильтры',
								'Archive': 'Архив',
								'trash': 'Удаленные',
								'Drafts': 'Черновики',
								'Junk': 'Спам',
								'Sent': 'Отправленные',
							};

							const originalName = item.name;
							let translatedName = '';
							let lastIndex = 0;

							const matches = [...originalName.matchAll(/(\s+)/g)];

							if (matches.length === 0) {
								return nameMap[originalName] || originalName;
							}

							for (const match of matches) {
								const пробелы = match[0];
								const пробелыIndex = match.index;

								const word = originalName.substring(lastIndex, пробелыIndex);
								translatedName += nameMap[word] || word;

								translatedName += пробелы;

								lastIndex = пробелыIndex + пробелы.length;
							}

							const lastWord = originalName.substring(lastIndex);
							translatedName += nameMap[lastWord] || lastWord;

							return translatedName;
						}, optionsValue: 'id', optionsAfterRender: $root.defaultOptionsAfterRender"
				>
				</select>
			</div>
		</div>
	</div>
</form>
<div class="footer">
	<button form="identityform" class="btn buttonAddIdentity">
		<i class="hidden" data-bind="visible: !edit(), css: {'icon-user-add': !submitRequest(), 'icon-spinner': submitRequest()}"></i>
		<span data-bind="visible: !edit()" data-i18n="POPUPS_IDENTITY/BUTTON_ADD_IDENTITY" style="margin: 0"></span>
		<i class="hidden" data-bind="visible: edit, css: {'icon-ok': !submitRequest(), 'icon-spinner': submitRequest()}"></i>
		<span data-bind="visible: edit" data-i18n="GLOBAL/SAVE" style="margin: 0"></span>
	</button>
</div>
