(e=>{Array.prototype.unique=function(){return this.filter((e,t,n)=>n.indexOf(e)===t)},Array.prototype.validUnique=function(e){return this.filter((t,n,o)=>(e?e(t):t)&&o.indexOf(t)===n)};let t={LT:{hour:"numeric",minute:"numeric"},LLL:{dateStyle:"long",timeStyle:"short"}};Date.prototype.format=function(n,o,r){"string"==typeof n&&(t[n]?n=t[n]:(console.log("Date.format("+n+")"),n={})),r&&(n.hourCycle=r);let i=e.documentElement;return this.toLocaleString(i.dataset.dateLang||i.lang,n)},Element.prototype.closestWithin=function(e,t){const n=this.closest(e);return n&&n!==t&&t.contains(n)?n:null},Element.fromHTML=t=>{const n=e.createElement("template");return n.innerHTML=t.trim(),n.content.firstChild},RegExp.escape||(RegExp.escape=e=>String(e).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")),Function.prototype.debounce||(Function.prototype.debounce=function(e){let t,n=this;return function(...o){t&&clearTimeout(t),t=setTimeout(()=>{n.apply(this,o),t=0},e)}}),Function.prototype.throttle||(Function.prototype.throttle=function(e){let t,n=this;return function(...o){t=t||setTimeout(()=>{n.apply(this,o),t=0},e)}})})(document),(e=>{let t=navigator.userAgent.toLowerCase();if(t.includes("mobile")&&t.includes("gecko/")){let t,n,o,r,i,s,a,l,c={passive:!1,capture:!1},h="move",u="all",f={};class DataTransfer{get dropEffect(){return h}set dropEffect(e){h=e}get effectAllowed(){return u}set effectAllowed(e){u=e}get files(){return[]}get items(){return[]}get types(){return Object.keys(f)}clearData(e){null!=e?delete f[e]:f={}}getData(e){return f[e]||""}setData(e,t){f[e]=t}constructor(){this.setDragImage=g}}const p=t=>e.documentElement.classList.toggle("firefox-drag",t),g=(e,t,n)=>{l?.remove(),e&&(l=e.cloneNode(!0),C(e,l),l._x=t??e.clientWidth/2,l._y=n??e.clientHeight/2)},m=()=>{n&&(clearInterval(a),l?.remove(),o&&N(s,"dragend",n),l=n=s=i=t=a=null,o=r=!1,p(!1))},v=e=>({x:(e=e.touches?e.touches[0]:e).clientX,y:e.clientY}),y=e=>{n&&(r&&"touchcancel"!==e.type&&N(s,"drop",i),m())},S=t=>{let n=e.elementFromPoint(t.x,t.y);for(;n&&"none"==getComputedStyle(n).pointerEvents;)n=n.parentElement;return n},E=e=>{requestAnimationFrame(()=>{l&&(l.style.left=Math.round(e.x-l._x)+"px",l.style.top=Math.round(e.y-l._y)+"px")})},C=(e,t)=>{if(["id","class","style","draggable"].forEach(e=>t.removeAttribute(e)),e instanceof HTMLCanvasElement){let n=e,o=t;o.width=n.width,o.height=n.height,o.getContext("2d").drawImage(n,0,0)}let n=getComputedStyle(e);Object.entries(n).forEach(([e,n])=>e.includes("transition")||(t.style[e]=n)),t.style.pointerEvents="none";let o=e.children.length;for(;o--;)C(e.children[o],t.children[o])},N=(e,o,r)=>{if(e&&r){let i=new Event(o,{bubbles:!0,cancelable:!0});i.button=0,i.buttons=1,["altKey","ctrlKey","metaKey","shiftKey"].forEach(t=>i[t]=e[t]);let s=e.touches?e.touches[0]:e;return["pageX","pageY","clientX","clientY","screenX","screenY","offsetX","offsetY"].forEach(e=>i[e]=s[e]),n&&(i.dataTransfer=t),r.dispatchEvent(i)}return!1};e.addEventListener("touchstart",r=>{m(),r&&!r.defaultPrevented&&r.touches&&r.touches.length<2&&(n=r.target.closest("[draggable]"),n&&(s=r,a=setTimeout(()=>{if(t=new DataTransfer,o=N(r,"dragstart",n)){p(!0);let t=v(r);l||g(n);let o=l.style;o.top=o.left="-9999px",o.position="fixed",o.pointerEvents="none",o.zIndex="999999999",E(t),e.body.append(l),N(r,"dragenter",S(t))}else m()},1e3)))},c),e.addEventListener("touchmove",e=>{if(o){let t=v(e),n=S(t);s=e,n!=i&&(N(e,"dragleave",i),N(e,"dragenter",n),i=n),E(t),r=!N(e,"dragover",n)}else m()},c),e.addEventListener("touchend",y),e.addEventListener("touchcancel",y)}})(document),(e=>{let t={},n="all";const o=document,r=/Mac OS X/.test(navigator.userAgent)?"meta":"ctrl",i={all:{}},s=e=>Array.isArray(e)?e:e.split(/\s*,\s*/),a=(e,t)=>{try{e.defaultPrevented||!1!==t(e)||(e.preventDefault(),e.stopPropagation())}catch(e){console.error(e)}},l={on:()=>o.addEventListener("keydown",c),off:()=>o.removeEventListener("keydown",c),add:(e,t,n,o)=>{null==o&&(o=n,n="all"),s(n).forEach(n=>{i[n]||(i[n]={}),s(e).forEach(e=>{e=e.toLowerCase(),i[n][e]||(i[n][e]={}),t=s(t).map(e=>"meta"==e?r:e).unique().sort().join("+"),i[n][e][t]||(i[n][e][t]=[]),i[n][e][t].push(o)})})},setScope:e=>{n=e||"all",t=i[n]||{},console.log("Shortcuts scope set to: "+n)},getScope:()=>n,getMetaKey:()=>"meta"===r?"⌘":"Ctrl"},c=e=>{let o=(e.key||"").toLowerCase().replace(" ","space"),r=["alt","ctrl","meta","shift"].filter(t=>e[t+"Key"]).join("+");t[o]?.[r]?.forEach(t=>a(e,t)),!e.defaultPrevented&&"all"!==n&&i.all[o]?.[r]?.forEach(t=>a(e,t))};e.shortcuts=l,l.on()})(this),(e=>{const t=/#(.*)$/,n=/^[#/]+/,o=/^\/+/g,r=e=>e?.replace(o,"")||"",i=()=>{var e=t.exec(location.href);return e?.[1]?decodeURIComponent(e[1]):""},s=e=>{if(h!==e){var t=h;h=e,l(r(e),r(t))}},a=(e,t)=>{(e=e?"/"+e.replace(n,""):e)!==h&&(s(e),e===h&&(e="#"+encodeURI(e),t?location.replace(e):location.hash=e))},l=(...e)=>c.active&&u.forEach(t=>t(...e)),c={clear:()=>{u=[],c.active=!0},active:!0,add:e=>u.push(e),init:()=>l(r(h)),setHash:e=>a(e),replaceHash:e=>a(e,!0)};var h=i(),u=[];addEventListener("hashchange",()=>s(i())),e.hasher=c})(this),(()=>{const e=e=>"function"==typeof e;this.Crossroads=class Crossroads{constructor(){this._routes=[]}addRoute(e,t){var n=new Route(e,t,this);return this._routes.push(n),n}parse(e){e=e||"";for(var t,n=0,o=this._routes,r=o.length;r--;)t=o[r],n&&!t.greedy||!t.match(e)||(t.callback?.(...t._getParamsArray(e)),++n)}};class Route{constructor(t,n,o){var r=t instanceof RegExp;Object.assign(this,{greedy:!1,rules:{},_router:o,_pattern:t,_paramsIds:r?null:v(a,t),_optionalParamsIds:r?null:v(s,t),_matchRegexp:r?t:S(t),callback:e(n)?n:null})}match(t){var n=this._getParamsObject(t);return this._matchRegexp.test(t)&&0==Object.entries(this.rules).filter(([o,r])=>{var i=n[o],s=!1;return"normalize_"===o||null==i&&this._optionalParamsIds?.includes(o)?s=!0:r instanceof RegExp?s=r.test(i):Array.isArray(r)?s=r.includes(i):e(r)&&(s=r(i,t,n)),!s}).length}_getParamsObject(e){var t=y(e,this._matchRegexp)||[],n=t.length;if(this._paramsIds)for(;n--;)t[this._paramsIds[n]]=t[n];return t}_getParamsArray(t){var n=this.rules.normalize_;return e(n)?n(t,this._getParamsObject(t)):y(t,this._matchRegexp)}}const t=/[\\.+*?^$[\](){}/'#]/g,n=/\/$/g,o=/([:}]|\w(?=\/))\/?(:)/g,r=/([:}])\/?(\{)/g,i=/\{([^}]+)\}/g,s=/:([^:]+):/g,a=/(?:\{|:)([^}:]+)(?:\}|:)/g,l="__CR_RP__",c="__CR_OP__",h="__CR_RS__",u="__CR_OS__",f=new RegExp(l,"g"),p=new RegExp(c,"g"),g=new RegExp(u,"g"),m=new RegExp(h,"g"),v=(e,t)=>{for(var n,o=[];n=e.exec(t);)o.push(n[1]);return o},y=(e,t)=>{var n=t.exec(e);return n?.shift(),n},S=e=>new RegExp("^"+(e?e.replace(n,"").replace(o,"$1"+u+"$2").replace(r,"$1"+h+"$2").replace(s,c).replace(i,l).replace(t,"\\$&").replace(g,"\\/?").replace(m,"\\/").replace(p,"([^\\/]+)?/?").replace(f,"([^\\/]+)"):"")+"/?$")})(),(e=>{const t=e=>void 0!==e,n=(e,t,n)=>{if(e?.length){let r,i=0,s=!1;[...e].forEach(e=>{e&&(n&&n<++i?s||(s=!0):(r=o(e),r&&t(r)))})}},o=e=>e.size?{fileName:(e.name||"").replace(/^.*\/([^/]*)$/,"$1"),size:e.size,file:e}:null,r=e=>e.dataTransfer.types.includes("Files");class Queue extends Array{push(e,...t){super.push([e,t]),this.call()}call(){if(!this.running){let e;for(this.running=!0;e=this.shift();)e[0](...e[1]);this.running=!1}}}class Jua{constructor(t){let o,i=t.clickElement;const s=this,a=()=>{o&&clearTimeout(o),o=0};var l,c;s.oEvents={onSelect:null,onStart:null,onComplete:null,onProgress:null,onDragEnter:null,onDragLeave:null,onBodyDragEnter:null,onBodyDragLeave:null},s.oXhrs={},s.oUids={},s.options=Object.assign({action:"",name:"uploader",limit:0},t||{}),s.oQueue=new Queue,i&&(i.style.position="relative",i.style.overflow="hidden","inline"===i.style.display&&(i.style.display="inline-block"),s.generateNewInput(i)),i=t.dragAndDropElement,i&&(l=e,c={dragover:e=>{r(e)&&(a(),i.contains(e.target)?(e.dataTransfer.dropEffect="copy",e.stopPropagation()):e.dataTransfer.dropEffect="none",e.preventDefault())},dragenter:e=>{r(e)&&(a(),e.preventDefault(),s.runEvent("onBodyDragEnter",e),i.contains(e.target)&&(a(),s.runEvent("onDragEnter",i,e)))},dragleave:t=>{if(r(t)){let r=e.elementFromPoint(t.clientX,t.clientY);r&&i.contains(r)||s.runEvent("onDragLeave",i,t),n=()=>s.runEvent("onBodyDragLeave",t),a(),o=setTimeout(n,200)}var n},drop:e=>{r(e)&&(a(),e.preventDefault(),i.contains(e.target)&&n(e.files||e.dataTransfer.files,e=>{e&&s.addFile(e)},s.options.limit)),s.runEvent("onDragLeave",e),s.runEvent("onBodyDragLeave",e)}},Object.entries(c).forEach(([e,t])=>l.addEventListener(e,t)))}on(e,t){return this.oEvents[e]=t,this}runEvent(e,...t){this.oEvents[e]?.apply(null,t)}getEvent(e){return this.oEvents[e]||null}addFile(e){const t="jua-uid-"+Jua.randomId(16)+"-"+Date.now().toString(),n=this.getEvent("onSelect");!e||n&&!1===n(t,e)?this.cancel(t):(this.oUids[t]=!0,this.oQueue.push((...e)=>this.uploadTask(...e),t,e))}uploadTask(e,n){if(!1===this.oUids[e]||!n||!n.file)return!1;try{const o=this,r=new XMLHttpRequest,i=new FormData,s=this.options.action,a=this.getEvent("onStart"),l=this.getEvent("onProgress");return r.open("POST",s,!0),l&&r.upload&&(r.upload.onprogress=n=>{n&&n.lengthComputable&&t(n.loaded)&&t(n.total)&&l(e,n.loaded,n.total)}),r.onreadystatechange=()=>{if(4===r.readyState){delete o.oXhrs[e];let t=!1,n=null;if(200===r.status)try{n=JSON.parse(r.responseText),t=!0}catch(e){console.error(e)}this.getEvent("onComplete")(e,t,n)}},a&&a(e),i.append(this.options.name,n.file),r.send(i),this.oXhrs[e]=r,!0}catch(e){console.error(e)}return!1}generateNewInput(t){if(t){const o=this,r=o.options.limit,i=e.createElement("input"),s=()=>i.click();i.type="file",i.tabIndex=-1,i.style.display="none",i.multiple=1!=r,t.addEventListener("click",s),i.addEventListener("input",()=>{const e=e=>{o.addFile(e),setTimeout(()=>{i.remove(),t.removeEventListener("click",s),o.generateNewInput(t)},10)};i.files?.length?n(i.files,e,r):e({fileName:i.value.split(/\\\//).pop(),size:null,file:null})})}}cancel(e){if(this.oUids[e]=!1,this.oXhrs[e]){try{this.oXhrs[e].abort&&this.oXhrs[e].abort()}catch(e){console.error(e)}delete this.oXhrs[e]}}}Jua.randomId=e=>{let t=new Uint8Array((e||32)/2);return crypto.getRandomValues(t),t.map(e=>e.toString(16).padStart(2,"0")).join("")},this.Jua=Jua})(document),(e=>{const t=e=>e.focus?e.focus():e.setActive(),n=e=>"ArrowUp"===e.key||"ArrowDown"===e.key;this.BSN={Dropdown:function(o){let r,i=[];const s=this,a=o.parentNode,l=e=>{const t=e.target;"#"===(t.href||t.parentNode?.href)?.slice(-1)&&e.preventDefault()},c=e=>{r?.classList.toggle("show",e),a.classList.toggle("show",e),o.setAttribute("aria-expanded",e),o.open=e,e?o.removeEventListener("click",f):setTimeout(()=>o.addEventListener("click",f),1)},h=()=>{const t=(o.open?"add":"remove")+"EventListener";e[t]("click",u),e[t]("keydown",p),e[t]("keyup",g),e[t]("focus",u)},u=e=>{const t=e.target;(r.contains(t)||o.contains(t))&&"focus"===e.type||(s.hide(),l(e))},f=e=>{s.show(),l(e)},p=e=>n(e)&&e.preventDefault(),g=r=>{if("Escape"===r.key)s.toggle();else if(n(r)){let n=e.activeElement,s=n===o,l=s?0:i.indexOf(n);a.contains(n)?(s||(l="ArrowUp"===r.key?l>1?l-1:0:l<i.length-1?l+1:l),i[l]&&t(i[l])):console.log("activeElement not in menu")}};s.show=()=>{r=a.querySelector(".dropdown-menu"),i=[...r.querySelectorAll("A")].filter(e=>"none"!=e.parentNode.style.display),!("tabindex"in r)&&r.setAttribute("tabindex","0"),c(!0),setTimeout(()=>{t(r.getElementsByTagName("INPUT")[0]||o),h()},1)},s.hide=()=>{c(!1),h(),t(o)},s.toggle=()=>o.open?s.hide():s.show(),c(!1),o.Dropdown=s}}})(document),(e=>{function t(e,t){return e===t&&e!==Object(e)}function n(e,t){t?.dispose?.()}function o(e,t){var n=this.Mb,o=n[u];o.X||(this.Na&&this.wa[t]?(n.lb(t,e,this.wa[t]),this.wa[t]=null,--this.Na):o.v[t]||n.lb(t,e,o.A?{S:e}:n.Db(e)),e.ea&&e.Hb())}var r=e.document;const i={W:(e,t)=>{e=e.split(".");for(var n=i,o=0,r=e.length-1;o<r;o++)n=n[e[o]];n[e[r]]=t},g:{extend:(e,t)=>t?Object.assign(e,t):e,K:(e,t)=>e&&Object.entries(e).forEach(e=>t(e[0],e[1])),Ra:e=>[...e.childNodes].forEach(e=>i.removeNode(e)),Xb:e=>{e=[...e];var t=(e[0]?.ownerDocument||r).createElement("div");return e.forEach(e=>t.append(i.ia(e))),t},va:(e,t)=>Array.prototype.map.call(e,t?e=>i.ia(e.cloneNode(!0)):e=>e.cloneNode(!0)),qa:(e,t)=>{i.g.Ra(e),t&&e.append(...t)},ya:(e,t)=>{if(e.length){for(t=8===t.nodeType&&t.parentNode||t;e.length&&e[0].parentNode!==t;)e.splice(0,1);for(;1<e.length&&e[e.length-1].parentNode!==t;)--e.length;if(1<e.length){t=e[0];var n=e[e.length-1];for(e.length=0;t!==n;)e.push(t),t=t.nextSibling;e.push(n)}}return e},Cb:e=>null==e?"":e.trim?e.trim():e.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,""),Qa:e=>e.ownerDocument.documentElement.contains(1!==e.nodeType?e.parentNode:e),Eb:(e,t)=>{if(!e?.nodeType)throw Error("element must be a DOM node when calling triggerEvent");e.dispatchEvent(new Event(t))},h:e=>i.V(e)?e():e,$a:(e,t)=>e.textContent=i.g.h(t)}};i.W("unwrap",i.g.h),(()=>{let e=0,t="__ko__"+Date.now(),n=new WeakMap;i.g.l={get:(e,t)=>(n.get(e)||{})[t],set:(e,t,o)=>(n.has(e)?n.get(e)[t]=o:n.set(e,{[t]:o}),o),Sa(e,t,n){return this.get(e,t)||this.set(e,t,n)},clear:e=>n.delete(e),Z:()=>e+++t}})(),i.g.N=(()=>{var e=i.g.l.Z(),t={1:1,8:1,9:1},n={1:1,9:1};const o=(t,n)=>{var o=i.g.l.get(t,e);return n&&!o&&(o=new Set,i.g.l.set(t,e,o)),o},r=e=>{var t=o(e);t&&new Set(t).forEach(t=>t(e)),i.g.l.clear(e),n[e.nodeType]&&s(e.childNodes,!0)},s=(e,t)=>{for(var n,o=[],i=0;i<e.length;i++)if((!t||8===e[i].nodeType)&&(r(o[o.length]=n=e[i]),e[i]!==n))for(;i--&&!o.includes(e[i]););};return{ha:(e,t)=>{if("function"!=typeof t)throw Error("Callback must be a function");o(e,1).add(t)},Za:(t,n)=>{var r=o(t);r&&(r.delete(n),r.size||i.g.l.set(t,e,null))},ia:e=>(i.u.I(()=>{t[e.nodeType]&&(r(e),n[e.nodeType]&&s(e.getElementsByTagName("*")))}),e),removeNode:e=>{i.ia(e),e.parentNode&&e.parentNode.removeChild(e)}}})(),i.ia=i.g.N.ia,i.removeNode=i.g.N.removeNode,i.W("addDisposeCallback",i.g.N.ha),i.extenders={debounce:(e,t)=>e.Ea(e=>function(e,t){var n;return()=>{clearTimeout(n),n=setTimeout(e,t)}}(e,t)),rateLimit:(e,t)=>e.Ea(e=>function(e,t){var n;return()=>{n||(n=setTimeout(()=>{n=0,e()},t))}}(e,t)),notify:(e,n)=>{e.la="always"==n?null:t}};class fa{constructor(e,t,n){this.S=e,this.fb=t,this.Aa=n,this.Ia=!1,this.H=this.da=null}dispose(){this.Ia||(this.H&&i.g.N.Za(this.da,this.H),this.Ia=!0,this.Aa(),this.S=this.fb=this.Aa=this.da=this.H=null)}o(e){this.da=e,i.g.N.ha(e,this.H=this.dispose.bind(this))}}i.P=function(){Object.setPrototypeOf(this,s),s.init(this)};var s={init:e=>{e.R=new Map,e.R.set("change",new Set),e.kb=1},subscribe:function(e,t,n){var o=this;n=n||"change";var r=new fa(o,t?e.bind(t):e,()=>{o.R.get(n).delete(r),o.Ja?.(n)});return o.Ka?.(n),o.R.has(n)||o.R.set(n,new Set),o.R.get(n).add(r),r},B(e,t){if("change"===(t=t||"change")&&this.Fa(),this.oa(t)){t="change"===t&&this.Fb||new Set(this.R.get(t));try{i.u.ob(),t.forEach(t=>{t.Ia||t.fb(e)})}finally{i.u.end()}}},za(){return this.kb},Sb(e){return this.za()!==e},Fa(){++this.kb},Ea(e){var t,n,o,r,s,a=this,l=i.V(a);a.sa||(a.sa=a.B,a.B=(e,t)=>{t&&"change"!==t?"beforeChange"===t?a.hb(e):a.sa(e,t):a.ib(e)});var c=e(()=>{a.ea=!1,l&&r===a&&(r=a.gb?a.gb():a());var e=n||s&&a.Ca(o,r);s=n=t=!1,e&&a.sa(o=r)});a.ib=(e,n)=>{n&&a.ea||(s=!n),a.Fb=new Set(a.R.get("change")),a.ea=t=!0,r=e,c()},a.hb=e=>{t||(o=e,a.sa(e,"beforeChange"))},a.jb=()=>{s=!0},a.Hb=()=>{a.Ca(o,a.L(!0))&&(n=!0)}},oa(e){return(this.R.get(e)||[]).size},Ca(e,t){return!this.la||!this.la(e,t)},toString:()=>"[object Object]",extend:function(e){var t=this;return e&&i.g.K(e,(e,n)=>{"function"==typeof(e=i.extenders[e])&&(t=e(t,n)||t)}),t}};i.P.fn=Object.setPrototypeOf(s,Function.prototype),i.Wb=e=>"function"==typeof e?.subscribe&&"function"==typeof e.B,(()=>{let e,t=[],n=0;i.u={ob:n=>{t.push(e),e=n},end:()=>e=t.pop(),Ab:t=>{if(e){if(!i.Wb(t))throw Error("Only subscribable things can act as dependencies");e.Kb.call(e.Lb,t,t.Gb||(t.Gb=++n))}},I(n,o,r){try{return t.push(e),e=void 0,n.apply(o,r||[])}finally{e=t.pop()}},na:()=>e?.m.na(),Da:()=>e?.Da,m:()=>e?.m}})();const a=Symbol("_latestValue");i.$=e=>{function t(){return 0<arguments.length?(t.Ca(t[a],arguments[0])&&(t.eb(),t[a]=arguments[0],t.valueHasMutated()),this):(i.u.Ab(t),t[a])}return t[a]=e,Object.defineProperty(t,"length",{get:()=>t[a]?.length}),i.P.fn.init(t),Object.setPrototypeOf(t,l)};var l={toJSON:function(){let e=this[a];return e?.toJSON?.()||e},la:t,L(){return this[a]},valueHasMutated:function(){this.B(this[a],"spectate"),this.B(this[a])},eb(){this.B(this[a],"beforeChange")}};Object.setPrototypeOf(l,i.P.fn);var c=i.$.$b="__ko_proto__";l[c]=i.$,i.V=e=>{if((e="function"==typeof e&&e[c])&&e!==l[c]&&e!==i.m.fn[c])throw Error("Invalid object that looks like an observable; possibly from another Knockout instance");return!!e},i.wb=e=>"function"==typeof e&&(e[c]===l[c]||e[c]===i.m.fn[c]&&e.Tb),i.W("observable",i.$),i.W("isObservable",i.V),i.W("observable.fn",l),i.observableArray=e=>{if(e=e||[],!Array.isArray(e))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return Object.setPrototypeOf(i.$(e),i.observableArray.fn).extend({trackArrayChanges:!0})};const h=Symbol("IS_OBSERVABLE_ARRAY");i.observableArray.fn=Object.setPrototypeOf({[h]:1,remove:function(e){for(var t=this.L(),n=!1,o="function"!=typeof e||i.V(e)?t=>t===e:e,r=t.length;r--;){var s=t[r];if(o(s)){if(t[r]!==s)throw Error("Array modified during remove; cannot remove item");n||this.eb(),n=!0,t.splice(r,1)}}n&&this.valueHasMutated()}},i.$.fn),Object.getOwnPropertyNames(Array.prototype).forEach(e=>{"function"==typeof Array.prototype[e]&&"constructor"!=e&&("copyWithin fill pop push reverse shift sort splice unshift".split(" ").includes(e)?i.observableArray.fn[e]=function(...t){var n=this.L();return this.eb(),this.qb(n,e,t),t=n[e](...t),this.valueHasMutated(),t===n?this:t}:i.observableArray.fn[e]=function(...t){return this()[e](...t)})}),i.isObservableArray=e=>!(!e||!e[h]),i.extenders.trackArrayChanges=(e,t)=>{function n(){if(c){var t=[].concat(e.L()||[]);if(e.oa("arrayChange")){(!l||1<c)&&(l=i.g.rb(s,t,e.La));var n=l}s=t,l=null,c=0,n?.length&&e.B(n,"arrayChange")}}if(e.La={},"object"==typeof t&&i.g.extend(e.La,t),e.La.sparse=!0,!e.qb){var o,r,s,a=!1,l=null,c=0,h=e.Ka,u=e.Ja;e.Ka=t=>{h?.call(e,t),"arrayChange"===t&&(a?n():(a=!0,r=e.subscribe(()=>++c,null,"spectate"),s=[].concat(e.L()||[]),l=null,o=e.subscribe(n)))},e.Ja=t=>{u?.call(e,t),"arrayChange"!==t||e.oa("arrayChange")||(o?.dispose(),r?.dispose(),r=o=null,a=!1,s=void 0)},e.qb=(e,t,n)=>{if(a&&!c){var o=[],r=e.length,s=n.length,h=0,u=(e,t,n)=>o[o.length]={status:e,value:t,index:n};switch(t){case"push":h=r;case"unshift":for(e=0;e<s;++e)u("added",n[e],h+e);break;case"pop":h=r-1;case"shift":r&&u("deleted",e[h],h);break;case"splice":h=Math.min(Math.max(0,0>n[0]?r+n[0]:n[0]),r),r=1===s?r:Math.min(h+(n[1]||0),r),s=h+s-2,t=Math.max(r,s);for(var f=[],p=[],g=2;h<t;++h,++g)h<r&&p.push(u("deleted",e[h],h)),h<s&&f.push(u("added",n[g],h));i.g.ub(p,f);break;default:return}l=o}}}};var u=Symbol("_state");i.m=(e,t)=>{function n(){if(0<arguments.length){if("function"!=typeof o)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return o(...arguments),this}return r.X||i.u.Ab(n),(r.U||r.A&&n.pa())&&n.T(),r.J}if("object"==typeof e?t=e:(t=t||{},e&&(t.read=e)),"function"!=typeof t.read)throw Error("Pass a function that returns the value of the ko.computed");var o=t.write,r={J:void 0,Y:!0,U:!0,Ba:!1,bb:!1,X:!1,Ya:!1,A:!1,zb:t.read,o:t.o||null,ja:t.ja,Pa:null,v:{},G:0,cc:null};return n[u]=r,n.Tb="function"==typeof o,i.P.fn.init(n),Object.setPrototypeOf(n,f),t.pure&&(r.Ya=!0,r.A=!0,i.g.extend(n,p)),r.o&&(r.bb=!0,r.o.nodeType||(r.o=null)),r.A||n.T(),r.o&&n.isActive()&&i.g.N.ha(r.o,r.Pa=()=>{n.dispose()}),n};var f={la:t,na(){return this[u].G},Qb(){var e=[];return i.g.K(this[u].v,(t,n)=>e[n.fa]=n.S),e},Ta(e){if(!this[u].G)return!1;var t=this.Qb();return t.includes(e)||!!t.find(t=>t.Ta&&t.Ta(e))},lb(e,t,n){if(this[u].Ya&&t===this)throw Error("A 'pure' computed must not be called recursively");this[u].v[e]=n,n.fa=this[u].G++,n.ga=t.za()},pa(){var e,t=this[u].v;for(e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var n=t[e];if(this.ra&&n.S.ea||n.S.Sb(n.ga))return!0}},ec(){this[u].Ba||this.ra?.(!1)},isActive(){var e=this[u];return e.U||0<e.G},fc(){this.ea?this[u].U&&(this[u].Y=!0):this.tb()},Db(e){return e.subscribe(this.tb,this)},tb(){this.ra?this.ra(!0):this.T(!0)},T(e){var t=this[u],n=t.ja,o=!1;if(!t.Ba&&!t.X){if(t.o&&!i.g.Qa(t.o)||n?.()){if(!t.bb)return void this.dispose()}else t.bb=!1;try{t.Ba=!0,o=this.Ob(e)}finally{t.Ba=!1}return o}},Ob(e){var t=this[u],r=t.Ya?void 0:!t.G,s={Mb:this,wa:t.v,Na:t.G};i.u.ob({Lb:s,Kb:o,m:this,Da:r}),t.v={},t.G=0;e:{try{var a=t.zb();break e}finally{i.u.end(),s.Na&&!t.A&&i.g.K(s.wa,n),t.Y=t.U=!1}a=void 0}return t.G?s=this.Ca(t.J,a):(this.dispose(),s=!0),s&&(t.A?this.Fa():this.B(t.J,"beforeChange"),t.J=a,this.B(t.J,"spectate"),!t.A&&e&&this.B(t.J),this.jb&&this.jb()),r&&this.B(t.J,"awake"),s},L(e){var t=this[u];return(t.U&&(e||!t.G)||t.A&&this.pa())&&this.T(),t.J},Ea(e){var t=this;i.P.fn.Ea.call(t,e),t.gb=()=>(t[u].A||(t[u].Y?t.T():t[u].U=!1),t[u].J),t.ra=e=>{t.hb(t[u].J),t[u].U=!0,e&&(t[u].Y=!0),t.ib(t,!e)}},dispose:function(){var e=this[u];!e.A&&e.v&&i.g.K(e.v,(e,t)=>t.dispose?.()),e.o&&e.Pa&&i.g.N.Za(e.o,e.Pa),e.v=void 0,e.G=0,e.X=!0,e.Y=!1,e.U=!1,e.A=!1,e.o=void 0,e.ja=void 0,e.zb=void 0}},p={Ka(e){var t=this,n=t[u];if(!n.X&&n.A&&"change"==e){if(n.A=!1,n.Y||t.pa())n.v=null,n.G=0,t.T()&&t.Fa();else{var o=[];i.g.K(n.v,(e,t)=>o[t.fa]=e),o.forEach((e,o)=>{var r=n.v[e],i=t.Db(r.S);i.fa=o,i.ga=r.ga,n.v[e]=i}),t.pa()&&t.T()&&t.Fa()}n.X||t.B(n.J,"awake")}},Ja(e){var t=this[u];t.X||"change"!=e||this.oa("change")||(i.g.K(t.v,(e,n)=>{n.dispose&&(t.v[e]={S:n.S,fa:n.fa,ga:n.ga},n.dispose())}),t.A=!0,this.B(void 0,"asleep"))},za(){var e=this[u];return e.A&&(e.Y||this.pa())&&this.T(),i.P.fn.za.call(this)}};Object.setPrototypeOf(f,i.P.fn);var g,m,v,y=i.$.$b;f[y]=i.m,i.m.fn=f,i.W("computed",i.m),i.isComputed=e=>"function"==typeof e&&e[y]===f[y],i.yb=e=>"function"==typeof e?i.m(e,{pure:!0}):(e={...e,pure:!0},i.m(e)),i.C={M:e=>{switch(e.nodeName){case"OPTION":return!0===e.__ko__hasDomDataOptionValue__?i.g.l.get(e,i.i.options.Xa):e.value;case"SELECT":return 0<=e.selectedIndex?i.C.M(e.options[e.selectedIndex]):void 0;default:return e.value}},Ga:(e,t)=>{switch(e.nodeName){case"OPTION":"string"==typeof t?(i.g.l.set(e,i.i.options.Xa,void 0),delete e.__ko__hasDomDataOptionValue__,e.value=t):(i.g.l.set(e,i.i.options.Xa,t),e.__ko__hasDomDataOptionValue__=!0,e.value="number"==typeof t?t:"");break;case"SELECT":for(var n,o=-1,r=""===(t??""),s=e.options.length;s--;)if((n=i.C.M(e.options[s]))==t||""===n&&r){o=s;break}(0<=o||r&&1<e.size)&&(e.selectedIndex=o);break;default:e.value=t??""}}},i.ma=(g=RegExp("\"(?:\\\\.|[^\"])*\"|'(?:\\\\.|[^'])*'|`(?:\\\\.|[^`])*`|/\\*(?:[^*]|\\*+[^*/])*\\*+/|//.*\n|/(?:\\\\.|[^/])+/w*|[^\\s:,/][^,\"'`{}()/:[\\]]*[^\\s,\"'`{}()/:[\\]]|[^\\s]","g"),m=/[\])"'A-Za-z0-9_$]+$/,v={in:1,return:1,typeof:1},{Zb:e=>{123===(e=i.g.Cb(e)).charCodeAt(0)&&(e=e.slice(1,-1));var t=[],n=(e+="\n,").match(g),o=[],r=0;if(1<n.length){for(var s,a=0;s=n[a++];){var l=s.charCodeAt(0);if(44===l){if(0>=r){c&&o.length&&t.push("'"+c+"':()=>("+o.join("")+")");var c=r=0;o=[];continue}}else if(58===l){if(!r&&!c&&1===o.length){c=o.pop();continue}}else{if(47===l&&1<s.length&&(47===s.charCodeAt(1)||42===s.charCodeAt(1)))continue;47===l&&a&&1<s.length?(l=n[a-1].match(m))&&!v[l[0]]&&(n=(e=e.slice(e.indexOf(s)+1)).match(g),a=-1,s="/"):40===l||123===l||91===l?++r:41===l||125===l||93===l?--r:c||o.length||34!==l&&39!==l||(s=s.slice(1,-1))}o.push(s)}if(0<r)throw Error("Unbalanced parentheses, braces, or brackets")}return t.push("'$data':()=>$data"),t.join(",")},dc:(e,t)=>-1<e.findIndex(e=>e.key==t),Ha:(e,t,n,o,r,s)=>{t&&i.V(t)?!i.wb(t)||s&&t.L()===r||t(r):(console.log(`"${o}" should contain observable in ${e.outerHTML.replace(/>.+/,">")}`),n.get("$data")[o]=r)}}),(()=>{function e(e){return 8==e.nodeType&&o.test(e.nodeValue)}function t(e){return 8==e.nodeType&&r.test(e.nodeValue)}function n(n,o){for(var r=n,a=1,l=[];r=r.nextSibling;){if(t(r)&&(i.g.l.set(r,s,!0),! --a))return l;l.push(r),e(r)&&++a}if(!o)throw Error("Cannot find closing comment tag to match: "+n.nodeValue);return null}var o=/^\s*ko(?:\s+([\s\S]+))?\s*$/,r=/^\s*\/ko\s*$/,s="__ko_matchedEndComment__";i.s={aa:{},childNodes:t=>e(t)?n(t):t.childNodes,ka:t=>{e(t)?(t=n(t))&&[...t].forEach(e=>i.removeNode(e)):i.g.Ra(t)},qa:(t,n)=>{e(t)?(i.s.ka(t),t.after(...n)):i.g.qa(t,n)},Vb:(t,n,o)=>{o?o.after(n):e(t)?t.nextSibling.before(n):t.prepend(n)},firstChild:n=>{if(e(n))return!(n=n.nextSibling)||t(n)?null:n;let o=n.firstChild;if(o&&t(o))throw Error("Found invalid end comment, as the first child of "+n);return o},nextSibling:o=>{if(e(o)){var r=n(o,void 0);o=r?(r.length?r[r.length-1]:o).nextSibling:null}if((r=o.nextSibling)&&t(r)){if(t(r)&&!i.g.l.get(r,s))throw Error("Found end comment without a matching opening comment, as child of "+o);return null}return r},Rb:e,bc:e=>(e=e.nodeValue.match(o))?e[1]:null}})();const S=new Map;i.pb=new class{Yb(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind");case 8:return i.s.Rb(e)}return!1}Pb(e,t){if(e=(e=>{switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return i.s.bc(e)}return null})(e))try{let n=S.get(e);return n||(n=new Function("$context","with($context){return{"+i.ma.Zb(e)+"}}"),S.set(e,n)),n(t=new Proxy(t,{has:()=>!0,get:(e,t)=>e[t]||e.$data[t]}))}catch(t){throw t.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+t.message,t}return null}};const E=Symbol("_subscribable"),C=Symbol("_ancestorBindingInfo"),N=Symbol("_dataDependency"),_={},T=i.g.l.Z();i.i={},i.ba=class{constructor(e,t,n,o){var r=this,s=e===_,a=s?void 0:e,l="function"==typeof a&&!i.V(a),c=o?.dataDependency;if(e=()=>{var e=l?a():a;return e=i.g.h(e),t?(i.g.extend(r,t),C in t&&(r[C]=t[C])):r.$root=e,r[E]=h,s?e=r.$data:r.$data=e,n?.(r,t,e),t?.[E]&&!i.u.m().Ta(t[E])&&t[E](),c&&(r[N]=c),r.$data},o?.exportDependencies)e();else{var h=i.yb(e);h.L(),h.isActive()?h.la=null:r[E]=void 0}}createChildContext(e,t){return new i.ba(e,this,(e,n)=>{e.$parent=n.$data,t.extend?.(e)},t)}extend(e,t){return new i.ba(_,this,t=>i.g.extend(t,"function"==typeof e?e(t):e),t)}};const x=e=>{e=i.g.l.get(e,T);var t=e?.D;t&&(e.D=null,t.xb())};class ma{constructor(e,t,n){this.H=e,this.da=t,this.ua=new Set,this.F=!1,t.D||i.g.N.ha(e,x),n?.D&&(n.D.ua.add(e),this.Aa=n)}xb(){this.Aa?.D?.Nb(this.H)}Nb(e){this.ua.delete(e),this.ua.size||this.sb?.()}sb(){this.F=!0,this.da.D&&!this.ua.size&&(this.da.D=null,i.g.N.Za(this.H,x),i.j.notify(this.H,i.j.ca),this.xb())}}i.j={F:"childrenComplete",ca:"descendantsComplete",subscribe:(e,t,n,o,r)=>{var s=i.g.l.Sa(e,T,{});return s.xa||(s.xa=new i.P),r?.notifyImmediately&&s.Wa[t]&&i.u.I(n,o,[e]),s.xa.subscribe(n,o,t)},notify:(e,t)=>{var n=i.g.l.get(e,T);if(n&&(n.Wa[t]=!0,n.xa?.B(e,t),t==i.j.F))if(n.D)n.D.sb();else if(void 0===n.D&&n.xa?.oa(i.j.ca))throw Error("descendantsComplete event not supported for bindings on this node")},ab:(e,t)=>{var n=i.g.l.Sa(e,T,{});return n.D||(n.D=new ma(e,n,t[C])),t[C]==n?t:t.extend(e=>{e[C]=n})}};const L=(e,t)=>{for(var n,o=i.s.firstChild(t);n=o;)o=i.s.nextSibling(n),A(e,n);i.j.notify(t,i.j.F)},A=(e,t)=>{var n=e;(1===t.nodeType||i.pb.Yb(t))&&(n=k(t,null,e)),n&&!t.matches?.("SCRIPT,TEXTAREA,TEMPLATE")&&L(n,t)},k=(e,t,n)=>{var o=i.g.l.Sa(e,T,{}),r=o.Ib;if(!t){if(r)throw Error("You cannot apply bindings multiple times to the same element.");o.Ib=!0}if(r||(o.context=n),o.Wa||(o.Wa={}),t&&"function"!=typeof t)var s=t;else{var a=i.m(()=>((s=t?t(n,e):i.pb.Pb(e,n))&&(n[E]?.(),n[N]?.()),s),{o:e});s&&a.isActive()||(a=null)}var l,c=n;if(s){var h=a?e=>()=>a()[e]():e=>s[e],u={get:e=>s[e]&&h(e)(),has:e=>e in s};i.j.F in s&&i.j.subscribe(e,i.j.F,()=>{var t=s[i.j.F]();if(t){var n=i.s.childNodes(e);n.length&&t(n,i.dataFor(n[0]))}}),i.j.ca in s&&(c=i.j.ab(e,n),i.j.subscribe(e,i.j.ca,()=>{var t=s[i.j.ca]();t&&i.s.firstChild(e)&&t(e)})),(e=>{var t=[],n={},o=[],r=s=>{if(!n[s]){var a=i.i[s];a&&(a.after&&(o.push(s),a.after.forEach(t=>{if(e[t]){if(o.includes(t))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+o.join(", "));r(t)}}),o.length--),t.push({key:s,vb:a})),n[s]=!0}};return i.g.K(e,r),t})(s).forEach(t=>{var n=t.vb.init,o=t.vb.update,r=t.key;if(8===e.nodeType&&!i.s.aa[r])throw Error("The binding '"+r+"' cannot be used with comment nodes");try{"function"==typeof n&&i.u.I(()=>{var t=n(e,h(r),u,c.$data,c);if(t&&t.controlsDescendantBindings){if(void 0!==l)throw Error("Multiple bindings ("+l+" and "+r+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");l=r}}),"function"==typeof o&&i.m(()=>o(e,h(r),u,c.$data,c),{o:e})}catch(e){throw e.message='Unable to process binding "'+r+": "+s[r]+'"\nMessage: '+e.message,e}})}return void 0===l&&c};i.ac=e=>i.g.l.get(e,T)?.context;const O=e=>e&&e instanceof i.ba?e:new i.ba(e);i.applyBindingAccessorsToNode=(e,t,n)=>k(e,t,O(n)),i.nb=(e,t)=>{1!==t.nodeType&&8!==t.nodeType||L(O(e),t)},i.Jb=(e,t)=>A(O(e),t),i.dataFor=e=>([1,8].includes(e?.nodeType)&&i.ac(e))?.$data,i.W("bindingHandlers",i.i),(()=>{var e=Object.create(null),t=new Map;i.components={get:(n,o)=>{if(t.has(n))o(t.get(n));else{var r=e[n];r?r.subscribe(o):((r=e[n]=new i.P).subscribe(o),s(n,o=>{t.set(n,o),delete e[n],r.B(o)}))}},register:(e,t)=>{if(!t)throw Error("Invalid configuration for "+e);if(n[e])throw Error("Component "+e+" is already registered");n[e]=t}};var n=Object.create(null),o=(e,t)=>{throw Error(`Component '${e}': ${t}`)},s=(e,t)=>{var s={},a=n[e]||{},l=a.template;if(a=a.viewModel,l){l.element||o(e,"Unknown template value: "+l),l=l.element;var c=r.getElementById(l);c||o(e,"Cannot find element with ID "+l),c.matches("TEMPLATE")||o(e,"Template Source Element not a <template>"),s.template=i.g.va(c.content.childNodes)}a&&("function"!=typeof a.createViewModel&&o(e,"Unknown viewModel value: "+a),s.createViewModel=a.createViewModel),t(s.template&&s.createViewModel?s:null)}})(),(()=>{var e=0;i.i.component={init:(t,n,o,r,s)=>{var a,l,c=()=>{var e=a&&a.dispose;"function"==typeof e&&e.call(a),l=a=null};return i.s.ka(t),i.g.N.ha(t,c),i.m(()=>{var o=i.g.h(n());if("string"!=typeof o){var r=i.g.h(o.params);o=i.g.h(o.name)}if(!o)throw Error("No component name specified");var h=i.j.ab(t,s),u=l=++e;i.components.get(o,e=>{if(l===u){if(c(),!e)throw Error("Unknown component '"+o+"'");var n=e.template;if(!n)throw Error("Component '"+o+"' has no template");i.s.qa(t,i.g.va(n)),a=e.createViewModel(r,{element:t}),i.nb(h.createChildContext(a,{}),t)}})},{o:t}),{controlsDescendantBindings:!0}}},i.s.aa.component=!0})(),i.i.attr={update:(e,t)=>{t=i.g.h(t())||{},i.g.K(t,function(t,n){n=i.g.h(n);var o=t.indexOf(":");o="lookupNamespaceURI"in e&&0<o&&e.lookupNamespaceURI(t.slice(0,o)),!1===n||null==n?o?e.removeAttributeNS(o,t):e.removeAttribute(t):(n=n.toString(),o?e.setAttributeNS(o,t,n):e.setAttribute(t,n))})}},i.i.checked={after:["value","attr"],init:function(e,t,n){var o="checkbox"==e.type,r="radio"==e.type;if(o||r){const f=i.yb(()=>n.has("checkedValue")?i.g.h(n.get("checkedValue")):h?n.has("value")?i.g.h(n.get("value")):e.value:void 0);var s=()=>{if(!i.u.Da()){var s=e.checked,a=f();if(s||!r&&!i.u.na()){var h=i.u.I(t);if(l){var p=c?h.L():h,g=u;u=a,g!==a?s&&(p.push(a),p.remove(g)):s?p.push(a):p.remove(a),c&&i.wb(h)&&h(p)}else o&&(void 0===a?a=s:s||(a=void 0)),i.ma.Ha(e,h,n,"checked",a,!0)}}},a=t(),l=o&&i.g.h(a)instanceof Array,c=!(l&&a.push&&a.splice),h=r||l,u=l?f():void 0;i.m(s,null,{o:e}),e.addEventListener("click",s),i.m(()=>{var n=i.g.h(t()),r=f();l?(e.checked=n.includes(r),u=r):e.checked=o&&void 0===r?!!n:f()===n},null,{o:e}),a=void 0}}},i.i.checkedValue={update:function(e,t){e.value=i.g.h(t())}};var w=(e,t,n)=>t&&t.split(/\s+/).forEach(t=>e.classList.toggle(t,n));i.i.css={update:(e,t)=>{"object"==typeof(t=i.g.h(t()))?i.g.K(t,(t,n)=>{n=i.g.h(n),w(e,t,!!n)}):(t=i.g.Cb(t),w(e,e.__ko__cssValue,!1),e.__ko__cssValue=t,w(e,t,!0))}},i.i.enable={update:(e,t)=>{(t=i.g.h(t()))&&e.disabled?e.removeAttribute("disabled"):t||e.disabled||(e.disabled=!0)}},i.i.disable={update:(e,t)=>i.i.enable.update(e,()=>!i.g.h(t()))},i.i.event={init:function(e,t,n,o,r){i.g.K(t()||{},n=>{"string"==typeof n&&e.addEventListener(n,(...e)=>{var i=t()[n];if(i)try{o=r.$data;var s=i.apply(o,[o,...e])}finally{!0!==s&&e[0].preventDefault()}})})}};const D=e=>()=>{var t=e(),n=i.V(t)?t.L():t;return!n||Array.isArray(n)?{foreach:t}:(i.g.h(t),{foreach:n.data})};i.i.foreach={init:(e,t)=>i.i.template.init(e,D(t)),update:(e,t,n,o,r)=>i.i.template.update(e,D(t),n,o,r)},i.s.aa.foreach=!0,i.i.hasfocus={init:(e,t,n)=>{var o=o=>{e.__ko_hasfocusUpdating=!0,o=e.ownerDocument.activeElement===e,i.ma.Ha(e,t(),n,"hasfocus",o,!0),e.__ko_hasfocusLastValue=o,e.__ko_hasfocusUpdating=!1},r=o.bind(null,!0);o=o.bind(null,!1),e.addEventListener("focus",r),e.addEventListener("focusin",r),e.addEventListener("blur",o),e.addEventListener("focusout",o),e.__ko_hasfocusLastValue=!1},update:(e,t)=>{t=!!i.g.h(t()),e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===t||(t?e.focus():e.blur())}},i.i.html={init:()=>({controlsDescendantBindings:!0}),update:(e,t)=>{if(i.g.Ra(e),null!=(t=i.g.h(t()))){const n=r.createElement("template");n.innerHTML="string"!=typeof t?t.toString():t,e.appendChild(n.content)}}},(()=>{function e(e,t,n){i.i[e]={init:(e,o,r,s,a)=>{var l,c={};t&&(c={exportDependencies:!0});var h=r.has(i.j.ca);return i.m(()=>{var r=i.g.h(o()),s=!n!=!r,u=!l;if(h&&(a=i.j.ab(e,a)),s){c.dataDependency=i.u.m();var f=t?a.createChildContext("function"==typeof r?r:o,c):i.u.na()?a.extend(null,c):a}u&&i.u.na()&&(l=i.g.va(i.s.childNodes(e),!0)),s?(u||i.s.qa(e,i.g.va(l)),i.nb(f,e)):(i.s.ka(e),i.j.notify(e,i.j.F))},{o:e}),{controlsDescendantBindings:!0}}},i.s.aa[e]=!0}e("if"),e("ifnot",!1,!0),e("with",!0)})();var R={};i.i.options={init:e=>{if(!e.matches("SELECT"))throw Error("options binding applies only to SELECT elements");let t=e.length;for(;t--;)e.remove(t);return{controlsDescendantBindings:!0}},update:(e,t,n)=>{var o=e.multiple,r=0!=e.length&&o?e.scrollTop:null,s=i.g.h(t()),a=[];t=()=>Array.from(e.options).filter(e=>e.selected);var l=(e,t,n)=>{var o=typeof t;return"function"==o?t(e):"string"==o?e[t]:n},c=(t,n)=>{a.length&&(t=a.includes(i.C.M(n[0])),n[0].selected=t,u&&!t&&i.u.I(i.g.Eb,null,[e,"change"]))};if(o?a=t().map(i.C.M):0<=e.selectedIndex&&a.push(i.C.M(e.options[e.selectedIndex])),s){Array.isArray(s)||(s=[s]);var h=s.filter(e=>e??1)}var u=!1;s=c,n.has("optionsAfterRender")&&"function"==typeof n.get("optionsAfterRender")&&(s=(e,t)=>{c(e,t),i.u.I(n.get("optionsAfterRender"),null,[t[0],e!==R?e:void 0])}),i.g.Bb(e,h,(t,o,r)=>(r.length&&(a=r[0].selected?[i.C.M(r[0])]:[],u=!0),o=e.ownerDocument.createElement("option"),t===R?(i.g.$a(o),i.C.Ga(o,void 0)):(r=l(t,n.get("optionsValue"),t),i.C.Ga(o,i.g.h(r)),t=l(t,n.get("optionsText"),r),i.g.$a(o,t)),[o]),{},s),h=a.length,(o?h&&t().length<h:h&&0<=e.selectedIndex?i.C.M(e.options[e.selectedIndex])!==a[0]:h||0<=e.selectedIndex)&&i.u.I(i.g.Eb,null,[e,"change"]),i.u.Da()&&i.j.notify(e,i.j.F),r&&20<Math.abs(r-e.scrollTop)&&(e.scrollTop=r)}},i.i.options.Xa=i.g.l.Z(),i.i.style={update:(e,t)=>{i.g.K(i.g.h(t()||{}),(t,n)=>{if(null!=(n=i.g.h(n))&&!1!==n||(n=""),/^--/.test(t))e.style.setProperty(t,n);else{t=t.replace(/-(\w)/g,(e,t)=>t.toUpperCase());var o=e.style[t];e.style[t]=n,n===o||e.style[t]!=o||isNaN(n)||(e.style[t]=n+"px")}})}},i.i.submit={init:(e,t,n,o,r)=>{if("function"!=typeof t())throw Error("The value for a submit binding must be a function");e.addEventListener("submit",n=>{var o=t();try{var i=o.call(r.$data,e)}finally{!0!==i&&n.preventDefault()}})}},i.i.text={init:()=>({controlsDescendantBindings:!0}),update:(e,t)=>{8===e.nodeType&&(e.text||e.after(e.text=r.createTextNode("")),e=e.text),i.g.$a(e,t())}},i.s.aa.text=!0,i.i.textInput={init:(e,t,n)=>{var o,r,s=e.value,a=()=>{clearTimeout(o),r=o=void 0;var a=e.value;e.checkValidity()&&s!==a&&(s=a,i.ma.Ha(e,t(),n,"textInput",a))},l=()=>{var n=i.g.h(t())??"";void 0!==r&&n===r?setTimeout(l,4):e.value!==n&&(e.value=n,s=e.value)};e.addEventListener("input",a),e.addEventListener("change",a),i.m(l,{o:e})}},i.i.value={init:(e,t,n)=>{var o=e.matches("SELECT"),r=e.matches("INPUT");if(!r||"checkbox"!=e.type&&"radio"!=e.type){var s=new Set,a=n.get("valueUpdate"),l=null,c=()=>{l=null;var o=t(),r=i.C.M(e);i.ma.Ha(e,o,n,"value",r)};a&&("string"==typeof a?s.add(a):a.forEach(e=>s.add(e)),s.delete("change")),s.forEach(t=>{var n=c;(t||"").startsWith("after")&&(n=()=>{l=i.C.M(e),setTimeout(c,0)},t=t.slice(5)),e.addEventListener(t,n)});var h,u=r&&"file"==e.type?()=>{var n=i.g.h(t());null==n||""===n?e.value="":i.u.I(c)}:()=>{var n=i.g.h(t()),r=i.C.M(e);null!==l&&n===l?setTimeout(u,0):n===r&&void 0!==r||(o?(i.C.Ga(e,n),n!==i.C.M(e)&&i.u.I(c)):i.C.Ga(e,n))};if(o)i.j.subscribe(e,i.j.F,()=>{h?n.get("valueAllowUnset")?u():c():(e.addEventListener("change",c),h=i.m(u,{o:e}))},null,{notifyImmediately:!0});else e.addEventListener("change",c),i.m(u,{o:e})}else i.applyBindingAccessorsToNode(e,{checkedValue:t})},update:()=>{}},i.i.visible={update:(e,t)=>{t=i.g.h(t());var n="none"!=e.style.display;t&&!n?e.style.display="":n&&!t&&(e.style.display="none")}},i.i.hidden={update:(e,t)=>e.hidden=!!i.g.h(t())},function(e){i.i[e]={init:function(t,n,o,r,s){return i.i.event.init.call(this,t,()=>({[e]:n()}),o,r,s)}}}("click"),(()=>{let e=i.g.l.Z();class b{constructor(e){this.Oa=e}Va(...t){let n=this.Oa;if(!t.length)return i.g.l.get(n,e)||(11===this.H?n.content:1===this.H?n:void 0);i.g.l.set(n,e,t[0])}}i.cb={Oa:class d extends b{constructor(e){super(e),e&&(this.H=e.matches("TEMPLATE")&&e.content?e.content.nodeType:1)}},mb:b}})(),(()=>{const e=(e,t)=>{if(e.length){var n=e[0],o=n.parentNode;((e,t,n)=>{var o;for(t=i.s.nextSibling(t);e&&(o=e)!==t;)n(o,e=i.s.nextSibling(o))})(n,e[e.length-1],e=>(1===e.nodeType||8===e.nodeType)&&i.Jb(t,e)),i.g.ya(e,o)}},t=(t,n,o,s)=>{var a=(t&&(t.nodeType?t:0<t.length?t[0]:null)||o||{}).ownerDocument;if("string"==typeof o){if(!(a=(a=a||r).getElementById(o)))throw Error("Cannot find template with ID "+o);o=new i.cb.Oa(a)}else{if(![1,8].includes(o.nodeType))throw Error("Unknown template type: "+o);o=new i.cb.mb(o)}if(o=(o=o.Va?o.Va():null)?[...o.cloneNode(!0).childNodes]:null,!Array.isArray(o)||0<o.length&&"number"!=typeof o[0].nodeType)throw Error("Template engine must return an array of DOM nodes");return n&&(i.s.qa(t,o),e(o,s),i.j.notify(t,i.j.F)),o},n=(e,t,n)=>i.V(e)?e():"function"==typeof e?e(t,n):e,o=i.g.l.Z();i.i.template={init:(e,t)=>{if("string"==typeof(t=i.g.h(t()))||"name"in t)i.s.ka(e);else{if(!(t=i.s.childNodes(e)).length)throw Error("Anonymous template defined, but no template content was provided");t=i.g.Xb(t),new i.cb.mb(e).Va(t)}return{controlsDescendantBindings:!0}},update:(r,s,a,l,c)=>{l=s(),a=null,"string"==typeof(s=i.g.h(l))?s={}:l="name"in s?s.name:r;var h=!!l;"foreach"in s?a=((o,r,s,a,l)=>{var c,h=(e,r)=>(c=l.createChildContext(e,{extend:e=>e.$index=r}),e=n(o,e,c),t(a,!1,e,c)),u=(t,n)=>{e(n,c),c=null},f=(e,t)=>{i.u.I(i.g.Bb,null,[a,e,h,s,u,t]),i.j.notify(a,i.j.F)};if(i.isObservableArray(r)){f(r.L());var p=r.subscribe(e=>{f(r(),e)},null,"arrayChange");return p.o(a),p}return i.m(()=>{var e=i.g.h(r)||[];Array.isArray(e)||(e=[e]),f(e)},{o:a})})(l,h&&s.foreach||[],s,r,c):h?(a=c,"data"in s&&(a=c.createChildContext(s.data,{exportDependencies:!0})),a=((e,o,r,s)=>{if(r=r||{},s){var a=s.nodeType?s:0<s.length?s[0]:null;return i.m(()=>{var r=o instanceof i.ba?o:new i.ba(o,null,null,{exportDependencies:!0}),a=n(e,r.$data,r);t(s,!0,a,r)},{ja:()=>!a||!i.g.Qa(a),o:a})}console.log("no targetNodeOrNodeArray")})(l,a,s,r)):i.s.ka(r),c=a,i.g.l.get(r,o)?.dispose?.(),i.g.l.set(r,o,!c||c.isActive&&!c.isActive()?void 0:c)}},i.s.aa.template=!0})(),i.g.ub=(e,t,n)=>{var o,r=0,i=t.length;i&&e.every(e=>(0<=(o=t.findIndex(t=>e.value===t.value))&&(e.moved=t[o].index,t[o].moved=e.index,t.splice(o,1),r=o=0,--i),r+=i,i&&(!n||r<n)))},i.g.rb=(()=>{var e=(e,t,n,o,r)=>{for(var s,a,l,c,h=Math.min,u=Math.max,f=[],p=-1,g=e.length,m=t.length,v=m-g||1,y=g+m+1;++p<=g;)for(l=a,f.push(a=[]),c=h(m,p+v),s=u(0,p-1);s<=c;s++)a[s]=s?p?e[p-1]===t[s-1]?l[s-1]:h(l[s]||y,a[s-1]||y)+1:s+1:p+1;for(h=[],u=[],v=[],p=g,s=m;p||s;)m=f[p][s]-1,s&&m===f[p][s-1]?u.push(h[h.length]={status:n,value:t[--s],index:s}):p&&m===f[p-1][s]?v.push(h[h.length]={status:o,value:e[--p],index:p}):(--s,--p,r.sparse||h.push({status:"retained",value:t[s]}));return i.g.ub(v,u,10*g),h.reverse()};return(t,n,o)=>(n=n||[],(t=t||[]).length<n.length?e(t,n,"added","deleted",o):e(n,t,"deleted","added",o))})(),(()=>{var e=i.g.l.Z(),t=i.g.l.Z();i.g.Bb=(n,o,r,s,a,l)=>{o=o||[],Array.isArray(o)||(o=[o]);var c,h=i.g.l.get(n,e),u=[],f=0,p=0,g=[],m=[],v=e=>{c={ta:e,Ua:i.$(p++)},u.push(c)},y=e=>{(c=h[e]).Ua(p++),i.g.ya(c.O,n),u.push(c)};if(h){let e,t;for((!l||h&&h._countWaitingForRemove)&&(l=i.g.rb(Array.prototype.map.call(h,e=>e.ta),o,{sparse:!0})),l.forEach(o=>{switch(e=o.moved,t=o.index,o.status){case"deleted":for(;f<t;)y(f++);void 0===e&&((c=h[f]).Ma&&(c.Ma.dispose(),c.Ma=void 0),i.g.ya(c.O,n).length&&c&&g.push.apply(g,c.O)),f++;break;case"added":for(;p<t;)y(f++);void 0!==e?(m.push(u.length),y(e)):v(o.value)}});p<o.length;)y(f++);u._countWaitingForRemove=0}else o.forEach(v);i.g.l.set(n,e,u),g.forEach(i.removeNode);var S=e=>{i.s.Vb(n,e,E),E=e};if(l=n.ownerDocument.activeElement,m.length)for(;null!=(o=m.shift());){for(c=u[o];o--;)if(s=u[o].O,s?.length){var E=s[s.length-1];break}c.O.forEach(S)}u.forEach(e=>{e.O||i.g.extend(e,function(e,t,n,o,r){var s=[],a=i.m(()=>{var a=t(n,r,i.g.ya(s,e))||[];if(0<s.length){var l=s.nodeType?[s]:s;if(0<l.length){var c=l[0],h=c.parentNode;a.forEach(e=>h.insertBefore(e,c)),l.forEach(e=>i.removeNode(e))}o&&i.u.I(o,null,[n,a,r])}s.length=0,s.push(...a)},{o:e,ja:()=>!!s.find(i.g.Qa)});return{O:s,Ma:a.isActive()?a:void 0}}(n,r,e.ta,a,e.Ua)),e.O.forEach(S),!e.Ub&&a&&(a(e.ta,e.O,e.Ua),e.Ub=!0,E=e.O[e.O.length-1])}),n.ownerDocument.activeElement!=l&&l?.focus(),[].forEach(e=>e&&(e.ta=t))}})(),e.ko=i})(this),(()=>{var e=NodeFilter.FILTER_ACCEPT;TreeWalker.prototype.previousPONode=function(){const t=this.root;let n,o=this.currentNode;for(;;){for(n=o.lastChild;!n&&o&&o!==t;)n=o.previousSibling,n||(o=o.parentNode);if(!n)return null;const r=n.nodeType;if((r===Node.ELEMENT_NODE?NodeFilter.SHOW_ELEMENT:r===Node.TEXT_NODE?NodeFilter.SHOW_TEXT:0)&this.whatToShow&&e===this.filter.acceptNode(n))return this.currentNode=n,n;o=n}};var t=(t,n,o)=>document.createTreeWalker(t,n,{acceptNode:t=>!o||o(t)?e:NodeFilter.FILTER_SKIP}),n="​",o=navigator.userAgent,r=/Mac OS X/.test(o),i=/Windows NT/.test(o),s=/iP(?:ad|hone)/.test(o)||r&&!!navigator.maxTouchPoints,a=(/Android/.test(o),r||s?"Meta-":"Ctrl-"),l=/WebKit\//.test(o),c=/[^ \t\r\n]/,h=/^(?:#text|A(?:BBR|CRONYM)?|B(?:R|D[IO])?|C(?:ITE|ODE)|D(?:ATA|EL|FN)|EM|FONT|HR|I(?:MG|NS)?|KBD|Q|R(?:P|T|UBY)|S(?:AMP|MALL|PAN|TR(?:IKE|ONG)|U[BP])?|TIME|U|VAR|WBR)$/,u=new Set(["BR","HR","IMG"]),f=new WeakMap,p=e=>u.has(e.nodeName),g=e=>{switch(e.nodeType){case 3:return 1;case 1:case 11:if(f.has(e))return f.get(e);break;default:return 0}let t;return t=Array.from(e.childNodes).every(m)?h.test(e.nodeName)?1:2:3,f.set(e,t),t},m=e=>1===g(e),v=e=>2===g(e),y=e=>3===g(e),S=(e,t,n)=>{const o=document.createElement(e);return t instanceof Array&&(n=t,t=null),w(o,t),n&&o.append(...n),o},E=(e,t)=>!p(e)&&(e.nodeType===t.nodeType&&e.nodeName===t.nodeName&&(!(e instanceof HTMLElement&&t instanceof HTMLElement)||"A"!==e.nodeName&&e.className===t.className&&e.style.cssText===t.style.cssText)),C=(e,t,n)=>{if(e.nodeName!==t)return!1;for(const t in n)if(!("getAttribute"in e)||e.getAttribute(t)!==n[t])return!1;return!0},N=(e,t,n,o)=>{for(;e&&e!==t;){if(C(e,n,o))return e;e=e.parentNode}return null},_=(e,t)=>{let n=e.childNodes;for(;t&&e instanceof Element;)n=(e=n[t-1]).childNodes,t=n.length;return e},T=(e,t)=>{let n=e;if(n instanceof Element){const e=n.childNodes;if(t<e.length)n=e[t];else{for(;n&&!n.nextSibling;)n=n.parentNode;n&&(n=n.nextSibling)}}return n},x=e=>e instanceof Element||e instanceof DocumentFragment?e.childNodes.length:e instanceof CharacterData?e.length:0,L=e=>{const t=document.createDocumentFragment();return t.append(...e.childNodes),t},A=e=>(e.parentNode?.removeChild(e),e),k=(e,t)=>e.parentNode?.replaceChild(t,e),O=(e,t,n)=>(e=(e&&!e.closest?e.parentElement:e)?.closest(n),e&&t.contains(e)?e:null),w=(e,t)=>{t&&Object.entries(t).forEach(([t,n])=>{null==n?e.removeAttribute(t):"style"===t&&"object"==typeof n?Object.entries(n).forEach(([t,n])=>e.style[t]=n):e.setAttribute(t,n)})},D=e=>e instanceof Element?"BR"===e.nodeName:c.test(e.data),R=e=>{let n=e.parentNode;for(;m(n);)n=n.parentNode;const o=t(n,5,D);return o.currentNode=e,!!o.nextNode()},B=(e,o)=>{const r=t(e,4);let i,s;for(;i=r.nextNode();)for(;(s=i.data.indexOf(n))>-1&&(!o||i.parentNode!==o);){if(1===i.length){let e=i,t=e.parentNode;for(;t&&(t.removeChild(e),r.currentNode=t,m(t)&&!x(t));)e=t,t=e.parentNode;break}i.deleteData(s,1)}},I=(e,t,n)=>{if(n)return e.intersectsNode(t);{const n=document.createRange();n.selectNode(t);const o=e.compareBoundaryPoints(0,n)<1,r=e.compareBoundaryPoints(2,n)>-1;return o&&r}},U=e=>{let{startContainer:t,startOffset:n,endContainer:o,endOffset:r}=e;for(;!(t instanceof Text);){let e=t.childNodes[n];if(!e||p(e)){if(n&&(e=t.childNodes[n-1],e instanceof Text)){let o,r=e;for(;!r.length&&(o=r.previousSibling)&&o instanceof Text;)r.remove(),r=o;t=r,n=r.length}break}t=e,n=0}if(r)for(;!(o instanceof Text);){const e=o.childNodes[r-1];if(!e||p(e)){if(e&&"BR"===e.nodeName&&!R(e)){--r;continue}break}o=e,r=x(o)}else for(;!(o instanceof Text);){const e=o.firstChild;if(!e||p(e))break;o=e}e.setStart(t,n),e.setEnd(o,r)},P=(e,t,n,o)=>{let r,i=e.startContainer,s=e.startOffset,a=e.endContainer,l=e.endOffset;for(t||(t=e.commonAncestorContainer),n||(n=t);!s&&i!==t&&i!==o;)r=i.parentNode,s=Array.from(r.childNodes).indexOf(i),i=r;for(;a!==n&&a!==o&&(3!==a.nodeType&&a.childNodes[l]&&"BR"===a.childNodes[l].nodeName&&!R(a.childNodes[l])&&++l,l===x(a));)r=a.parentNode,l=Array.from(r.childNodes).indexOf(a)+1,a=r;e.setStart(i,s),e.setEnd(a,l)},M=(e,t,n)=>{let o=O(e.endContainer,n,t);if(o&&(o=o.parentNode)){const t=e.cloneRange();P(t,o,o,n),t.endContainer===o&&(e.setStart(t.endContainer,t.endOffset),e.setEnd(t.endContainer,t.endOffset))}return e},F={"font-weight":{regexp:/^bold|^700/i,replace:()=>S("B")},"font-style":{regexp:/^italic/i,replace:()=>S("I")},"font-family":{regexp:c,replace:(e,t)=>S("SPAN",{class:e.fontFamily,style:"font-family:"+t})},"font-size":{regexp:c,replace:(e,t)=>S("SPAN",{class:e.fontSize,style:"font-size:"+t})},"text-decoration":{regexp:/^underline/i,replace:()=>S("U")}},H=e=>(t,n)=>{const o=S(e),r=t.attributes;for(let e=0,t=r.length;e<t;++e){const t=r[e];o.setAttribute(t.name,t.value)}return n.replaceChild(o,t),o.append(L(t)),o},j={1:"x-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large","-1":"smaller","+1":"larger"},$={STRONG:H("B"),EM:H("I"),INS:H("U"),STRIKE:H("S"),SPAN:(e,t,n)=>{const o=e.style;let r,i;for(const t in F){const s=F[t],a=o.getPropertyValue(t);if(a&&s.regexp.test(a)){const o=s.replace(n.classNames,a);if(o.nodeName===e.nodeName&&o.className===e.className)continue;i||(i=o),r&&r.append(o),r=o,e.style.removeProperty(t)}}return i&&r&&(r.append(L(e)),e.style.cssText?e.append(i):k(e,i)),r||e},FONT:(e,t,n)=>{const o=e,r=o.face,i=o.size;let s=o.color,a=S("SPAN"),l=a.style;return a.style.cssText=e.style.cssText,r&&(l.fontFamily=r),i&&(l.fontSize=j[i]),s&&/^#?([\dA-F]{3}){1,2}$/i.test(s)&&("#"!==s.charAt(0)&&(s="#"+s),l.color=s),k(e,a),a.append(L(e)),a},TT:(e,t,n)=>{const o=S("SPAN",{class:n.classNames.fontFamily,style:'font-family:menlo,consolas,"courier new",monospace'});return k(e,o),o.append(L(e)),o}},V=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|COL(?:GROUP)?|UL)$/,q=new Set(["HEAD","META","STYLE"]),W=(e,n,o)=>{const r=e.childNodes;let i=e;for(;m(i);)i=i.parentNode;t(i,5);let s=r.length;for(;s--;){let t=r[s];const i=t.nodeName;if(t instanceof HTMLElement){const r=t.childNodes.length;if($[i])t=$[i](t,e,n);else{if(q.has(i)){t.remove();continue}if(!V.test(i)&&!m(t)){s+=r,k(t,L(t));continue}}r&&W(t,n,o||"PRE"===i)}}return e},z=e=>{const t=e.childNodes;let n=t.length;for(;n--;){const o=t[n];o instanceof Element&&!p(o)?(z(o),m(o)&&!o.firstChild&&e.removeChild(o)):o instanceof Text&&!o.length&&e.removeChild(o)}},K=e=>{const t=e.querySelectorAll("BR:last-child");let n=t.length;for(;n--;){const e=t[n],o=e.parentElement;!e.nextSibling&&1===o.children.length&&o.textContent.trim().length&&e.remove()}},G=e=>e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;"),Q=e=>(!(e instanceof Element||e instanceof DocumentFragment)||m(e)||e.children.length||e.textContent.length||e.appendChild(S("BR")),e),X=e=>{let t=null;return[...e.childNodes].forEach(n=>{m(n)?(t||(t=S("DIV")),t.append(n)):t&&((t.children.length||t.textContent.trim().length)&&e.insertBefore(t,n),t=null)}),t&&e.append(t),e},Y=(e,t,n,o)=>{if(e instanceof Text&&e!==n){if("number"!=typeof t)throw new Error("Offset must be a number to split text node!");if(!e.parentNode)throw new Error("Cannot split text node with no parent!");return Y(e.parentNode,e.splitText(t),n,o)}let r="number"==typeof t?t<e.childNodes.length?e.childNodes[t]:null:t;const i=e.parentNode;if(!(i&&e!==n&&e instanceof Element))return r;const s=e.cloneNode(!1);for(;r;){const e=r.nextSibling;s.append(r),r=e}return e instanceof HTMLOListElement&&O(e,o,"BLOCKQUOTE")&&(s.start=(+e.start||1)+e.childNodes.length-1),Q(e),Q(s),e.after(s),Y(i,s,n,o)},J=(e,t)=>{const n=e.childNodes;let o=n.length;const r=[];for(;o--;){const i=n[o],s=o?n[o-1]:null;if(s&&m(i)&&E(i,s))t.startContainer===i&&(t.startContainer=s,t.startOffset+=x(s)),t.endContainer===i&&(t.endContainer=s,t.endOffset+=x(s)),t.startContainer===e&&(t.startOffset>o?--t.startOffset:t.startOffset===o&&(t.startContainer=s,t.startOffset=x(s))),t.endContainer===e&&(t.endOffset>o?--t.endOffset:t.endOffset===o&&(t.endContainer=s,t.endOffset=x(s))),A(i),i instanceof Text?s.appendData(i.data):r.push(L(i));else if(i instanceof Element){let e;for(;e=r.pop();)i.append(e);J(i,t)}}},Z=(e,t)=>{const n=e instanceof Text?e.parentNode:e;if(n instanceof Element){const e={startContainer:t.startContainer,startOffset:t.startOffset,endContainer:t.endContainer,endOffset:t.endOffset};J(n,e),t.setStart(e.startContainer,e.startOffset),t.setEnd(e.endContainer,e.endOffset)}},ee=(e,t,n,o)=>{let r,i,s=t;for(;(r=s.parentNode)&&r!==o&&r instanceof Element&&1===r.childNodes.length;)s=r;A(s),i=e.childNodes.length;const a=e.lastChild;a&&"BR"===a.nodeName&&(a.remove(),--i),e.append(L(t)),n.setStart(e,i),n.collapse(!0),Z(e,n)},te=(e,t)=>{const n=e.previousSibling,o=e.firstChild,r="LI"===e.nodeName;if(!r||o&&/^[OU]L$/.test(o.nodeName))if(n&&E(n,e)){if(!y(n)){if(!r)return;const e=S("DIV");e.append(L(n)),n.append(e)}A(e);const i=!y(e);n.append(L(e)),i&&X(n),o&&te(o,t)}else if(r){const t=S("DIV");e.insertBefore(t,o),Q(t)}},ne=(e,n)=>{const o=t(n,1,v);return o.currentNode=e,o},oe=(e,t)=>{const n=ne(e,t).previousNode();return n!==t?n:null},re=(e,t)=>{const n=ne(e,t).nextNode();return n!==t?n:null},ie=e=>!e.textContent&&!e.querySelector("IMG"),se=(e,t)=>{const n=e.startContainer;let o;if(m(n))o=oe(n,t);else if(n!==t&&n instanceof HTMLElement&&v(n))o=n;else{const r=_(n,e.startOffset);o=re(r,t)}return o&&I(e,o,!0)?o:null},ae=(e,t)=>{const n=e.endContainer;let o;if(m(n))o=oe(n,t);else if(n!==t&&n instanceof HTMLElement&&v(n))o=n;else{let r=T(n,e.endOffset);if(!r||!t.contains(r)){let e;for(r=t;e=r.lastChild;)r=e}o=oe(r,t)}return o&&I(e,o,!0)?o:null},le=e=>e instanceof Text?c.test(e.data):"IMG"===e.nodeName,ce=(e,o)=>{const r=e.startContainer,i=e.startOffset;let s;if(r instanceof Text){const e=r.data;for(let t=i;t>0;--t)if(e.charAt(t-1)!==n)return!1;s=r}else if(s=T(r,i),s&&!o.contains(s)&&(s=null),!s&&(s=_(r,i),s instanceof Text&&s.length))return!1;const a=se(e,o);if(!a)return!1;const l=t(a,5,le);return l.currentNode=s,!l.previousNode()},de=(e,o)=>{const r=e.endContainer,i=e.endOffset;let s;if(r instanceof Text){const e=r.data,t=e.length;for(let o=i;o<t;++o)if(e.charAt(o)!==n)return!1;s=r}else s=_(r,i);const a=ae(e,o);if(!a)return!1;const l=t(a,5,le);return l.currentNode=s,!l.nextNode()};function he(e,t,n,o){const r=document.createRange();return r.setStart(e,t),n&&"number"==typeof o?r.setEnd(n,o):r.setEnd(e,t),r}var ue=(e,t)=>{let n,{startContainer:o,startOffset:r,endContainer:i,endOffset:s}=e;if(o instanceof Text){const t=o.parentNode;if(n=t.childNodes,r===o.length)r=Array.from(n).indexOf(o)+1,e.collapsed&&(i=t,s=r);else{if(r){const e=o.splitText(r);i===o?(s-=r,i=e):i===t&&++s,o=e}r=Array.from(n).indexOf(o)}o=t}else n=o.childNodes;const a=n.length;r===a?o.append(t):o.insertBefore(t,n[r]),o===i&&(s+=n.length-a),e.setStart(o,r),e.setEnd(i,s)},fe=(e,t,n)=>{const o=document.createDocumentFragment();if(e.collapsed)return o;t||(t=e.commonAncestorContainer),t instanceof Text&&(t=t.parentNode);const r=e.startContainer,i=e.startOffset;let s=Y(e.endContainer,e.endOffset,t,n),a=0,l=Y(r,i,t,n);for(;l&&l!==s;){const e=l.nextSibling;o.append(l),l=e}return l=s&&s.previousSibling,l&&l instanceof Text&&s instanceof Text&&(a=l.length,l.appendData(s.data),A(s),s=l),e.setStart(r,i),s?e.setEnd(s,a):e.setEnd(t,t.childNodes.length),Q(t),o},pe=(e,t,n)=>{let o;for(e.currentNode=n;o=e[t]();){if(o instanceof Text||p(o))return o;if(!m(o))return null}return null},ge=(e,n)=>{const o=se(e,n);let r=ae(e,n);const i=o!==r;o&&r&&(U(e),P(e,o,r,n));const s=fe(e,null,n);U(e),i&&(r=ae(e,n),o&&r&&o!==r&&ee(o,r,e,n)),o&&Q(o);const a=n.firstChild;a&&"BR"!==a.nodeName||(Q(n),n.firstChild&&e.selectNodeContents(n.firstChild)),e.collapse(!0);const l=e.startContainer,c=e.startOffset,h=t(n,5);let u=l,f=c;u instanceof Text&&f!==u.length||(u=pe(h,"nextNode",u),f=0);let p=l,g=c-1;p instanceof Text&&-1!==g||(p=pe(h,"previousPONode",u||(l instanceof Text?l:l.childNodes[c]||l)),p instanceof Text&&(g=p.length));let m=null,v=0;return u instanceof Text&&" "===u.data.charAt(f)&&ce(e,n)?(m=u,v=f):p instanceof Text&&" "===p.data.charAt(g)&&(u instanceof Text&&" "===u.data.charAt(f)||de(e,n))&&(m=p,v=g),m&&m.replaceData(v,1," "),e.setStart(l,c),e.collapse(!0),s},me=n=>{if(n.collapsed)return"";const o=n.startContainer,r=n.endContainer,i=t(n.commonAncestorContainer,5,e=>I(n,e,!0));i.currentNode=o;let s,a=o,l="",c=!1;for((a instanceof Element||a instanceof Text)&&e===i.filter.acceptNode(a)||(a=i.nextNode());a;)a instanceof Text?(s=a.data,s&&/\S/.test(s)&&(a===r&&(s=s.slice(0,n.endOffset)),a===o&&(s=s.slice(n.startOffset)),l+=s,c=!0)):("BR"===a.nodeName||c&&!m(a))&&(l+="\n",c=!1),a=i.nextNode();return l=l.replace(/ /g," "),l},ve=(Array.prototype.indexOf,(e,t,n,o,r,s,a)=>{const l=e.clipboardData;if(!l)return!1;let c=s?"":me(t);const h=se(t,n);let u,f=n;h===ae(t,n)&&h?.contains(t.commonAncestorContainer)&&(f=h),o?u=ge(t,n):(t=t.cloneRange(),U(t),P(t,f,f,n),u=t.cloneContents());let p,g=t.commonAncestorContainer;for(g instanceof Text&&(g=g.parentNode);g&&g!==f;){const e=g.cloneNode(!1);e.append(u),u=e,g=g.parentNode}if(1===u.childNodes.length&&u.childNodes[0]instanceof Text)c=u.childNodes[0].data.replace(/ /g," "),a=!0;else{const e=S("DIV");e.append(u),p=e.innerHTML,r&&(p=r(p))}return s&&void 0!==p&&(c=s(p)),i&&(c=c.replace(/\r?\n/g,"\r\n")),!a&&p&&c!==p&&(p="\x3c!-- squire --\x3e"+p,l.setData("text/html",p)),l.setData("text/plain",c),e.preventDefault(),!0}),be=function(e){const t=this.getSelection(),n=this._root;if(t.collapsed)return void e.preventDefault();this.saveUndoState(t);ve(e,t,n,!0,this._config.willCutCopy,this._config.toPlainText,!1)||setTimeout(()=>{try{this._ensureBottomLine()}catch(e){this._config.didError(e)}},0),this.setSelection(t)},ye=function(e){ve(e,this.getSelection(),this._root,!1,this._config.willCutCopy,this._config.toPlainText,!1)},Se=function(e){this._isShiftDown=e.shiftKey},Ee=function(e){const t=e.clipboardData,n=t.items,o=this._isShiftDown;let r=!1,i=!1,s=null,a=null,l=n.length;for(;l--;){const e=n[l],t=e.type;"text/html"===t?a=e:"text/plain"===t||"text/uri-list"===t?s=e:"text/rtf"===t?r=!0:/^image\/.*/.test(t)&&(i=!0)}if(i&&(!r||!a))return e.preventDefault(),void this.fireEvent("pasteImage",{clipboardData:t});e.preventDefault(),!a||o&&s?s&&s.getAsString(e=>{let t=!1;const n=this.getSelection();if(!n.collapsed&&c.test(n.toString())){const n=this.linkRegExp.exec(e);t=!!n&&n[0].length===e.length}t?this.makeLink(e):this.insertPlainText(e,!0)}):a.getAsString(e=>{this.insertHTML(e,!0)})},Ce=function(e){if(!e.dataTransfer)return;const t=e.dataTransfer.types;let n=t.length,o=!1,r=!1;for(;n--;)switch(t[n]){case"text/plain":o=!0;break;case"text/html":r=!0;break;default:return}(r||o&&this.saveUndoState)&&this.saveUndoState()},Ne=(e,t)=>{try{t||(t=e.getSelection());let o=t.startContainer;o instanceof Text&&(o=o.parentNode);let r=o;for(;m(r)&&(!r.textContent||r.textContent===n);)o=r,r=o.parentNode;o!==r&&(t.setStart(r,Array.from(r.childNodes).indexOf(o)),t.collapse(!0),r.removeChild(o),v(r)||(r=oe(r,e._root)||e._root),Q(r),U(t)),o===e._root&&(o=o.firstChild)&&"BR"===o.nodeName&&A(o),e._ensureBottomLine(),e.setSelection(t),e._updatePath(t,!0)}catch(t){e._config.didError(t)}},_e=(e,t)=>{let n;for(;(n=e.parentNode)&&n!==t&&!n.isContentEditable;)e=n;A(e)},Te=(e,t,n)=>{if(O(t,e._root,"A"))return;const o=t.data||"",r=Math.max(o.lastIndexOf(" ",n-1),o.lastIndexOf(" ",n-1))+1,i=o.slice(r,n),s=e.linkRegExp.exec(i);if(s){const n=e.getSelection();e._docWasChanged(),e._recordUndoState(n),e._getRangeAndRemoveBookmark(n);const i=r+s.index,a=i+s[0].length,l=n.startContainer===t,c=n.startOffset-a;i&&(t=t.splitText(i));const h=e._config.tagAttributes.a,u=S("A",Object.assign({href:s[1]?/^(?:ht|f)tps?:/i.test(s[1])?s[1]:"http://"+s[1]:"mailto:"+s[0]},h));u.textContent=o.slice(i,a),t.parentNode.insertBefore(u,t),t.data=o.slice(a),l&&(n.setStart(t,c),n.setEnd(t,c)),e.setSelection(n)}},xe=function(e){if(e.defaultPrevented||e.isComposing)return;let t=e.key,n="";const o=e.code;/^Digit\d$/.test(o)&&(t=o.slice(-1)),"Backspace"!==t&&"Delete"!==t&&(e.altKey&&(n+="Alt-"),e.ctrlKey&&(n+="Ctrl-"),e.metaKey&&(n+="Meta-"),e.shiftKey&&(n+="Shift-")),i&&e.shiftKey&&"Delete"===t&&(n+="Shift-"),t=n+t;const r=this.getSelection();this._keyHandlers[t]?this._keyHandlers[t](this,e,r):r.collapsed||e.ctrlKey||e.metaKey||1!==t.length||(this.saveUndoState(r),ge(r,this._root),this._ensureBottomLine(),this.setSelection(r),this._updatePath(r,!0))},Le={Backspace:(e,t,n)=>{const o=e._root;if(e._removeZWS(),e.saveUndoState(n),n.collapsed)if(ce(n,o)){t.preventDefault();const r=se(n,o);if(!r)return;let i=r;X(i.parentNode);const s=oe(i,o);if(s){if(!s.isContentEditable)return void _e(s,o);for(ee(s,i,n,o),i=s.parentNode;i!==o&&!i.nextSibling;)i=i.parentNode;i!==o&&(i=i.nextSibling)&&te(i,o),e.setSelection(n)}else if(i){if(O(i,o,"UL")||O(i,o,"OL"))return void e.decreaseListLevel(n);if(O(i,o,"BLOCKQUOTE"))return void e.removeQuote(n);e.setSelection(n),e._updatePath(n,!0)}}else{U(n);const o=n.startContainer,r=n.startOffset,i=o.parentNode;o instanceof Text&&i instanceof HTMLAnchorElement&&r&&i.href.includes(o.data)?(o.deleteData(r-1,1),e.setSelection(n),e.removeLink(),t.preventDefault()):(e.setSelection(n),setTimeout(()=>{Ne(e)},0))}else t.preventDefault(),ge(n,o),Ne(e,n)},Delete:(e,t,n)=>{const o=e._root;let r,i,s,a,l,c;if(e._removeZWS(),e.saveUndoState(n),n.collapsed)if(de(n,o)){if(t.preventDefault(),r=se(n,o),!r)return;if(X(r.parentNode),i=re(r,o),i){if(!i.isContentEditable)return void _e(i,o);for(ee(r,i,n,o),i=r.parentNode;i!==o&&!i.nextSibling;)i=i.parentNode;i!==o&&(i=i.nextSibling)&&te(i,o),e.setSelection(n),e._updatePath(n,!0)}}else{if(s=n.cloneRange(),P(n,o,o,o),a=n.endContainer,l=n.endOffset,a instanceof Element&&(c=a.childNodes[l],c&&"IMG"===c.nodeName))return t.preventDefault(),A(c),U(n),void Ne(e,n);e.setSelection(s),setTimeout(()=>{Ne(e)},0)}else t.preventDefault(),ge(n,o),Ne(e,n)},Tab:(e,t,n)=>{const o=e._root;e._removeZWS(),n.collapsed&&ce(n,o)&&O(n.startContainer,o,"UL,OL,BLOCKQUOTE")&&e.changeIndentationLevel("increase")&&t.preventDefault()},"Shift-Tab":(e,t,n)=>{const o=e._root;e._removeZWS(),n.collapsed&&ce(n,o)&&decreaseLevel(e,n,n.startContainer)&&t.preventDefault()}," ":(e,o,r)=>{let i;const s=e._root;if(e._recordUndoState(r),e._getRangeAndRemoveBookmark(r),r.collapsed){if(de(r,s)){const i=se(r,s);if(i&&"PRE"!==i.nodeName){const s=i.textContent?.trimEnd().replace(n,"");if("*"===s||"1."===s){o.preventDefault(),e.insertPlainText(" ",!1),e._docWasChanged(),e.saveUndoState(r);const n=t(i,4);let a;for(;a=n.nextNode();)A(a);return void("*"===s?e.makeUnorderedList():e.makeOrderedList())}}}}else ge(r,s),e._ensureBottomLine(),e.setSelection(r),e._updatePath(r,!0);if(i=r.endContainer,r.endOffset===x(i))do{if("A"===i.nodeName){r.setStartAfter(i);break}}while(!i.nextSibling&&(i=i.parentNode)&&i!==s);if(e._config.addLinks){const t=r.cloneRange();U(t);const n=t.startContainer,o=t.startOffset;setTimeout(()=>{Te(e,n,o)},0)}e.setSelection(r)},ArrowLeft(e){e._removeZWS()},ArrowRight(e,t,n){e._removeZWS();const o=e.getRoot();if(de(n,o)){U(n);let r=n.endContainer;do{if("CODE"===r.nodeName){let o=r.nextSibling;if(!(o instanceof Text)){const e=document.createTextNode(" ");r.parentNode.insertBefore(e,o),o=e}n.setStart(o,1),e.setSelection(n),t.preventDefault();break}}while(!r.nextSibling&&(r=r.parentNode)&&r!==o)}}};r||s||(Le.PageUp=e=>{e.moveCursorToStart()},Le.PageDown=e=>{e.moveCursorToEnd()});var Ae=(e,t)=>(t=t||null,(n,o)=>{o.preventDefault();const r=n.getSelection();n.hasFormat(e,null,r)?n.changeFormat(null,{tag:e},r):n.changeFormat({tag:e},t,r)});Le[a+"b"]=Ae("B"),Le[a+"i"]=Ae("I"),Le[a+"u"]=Ae("U"),Le[a+"Shift-7"]=Ae("S"),Le[a+"Shift-5"]=Ae("SUB",{tag:"SUP"}),Le[a+"Shift-6"]=Ae("SUP",{tag:"SUB"}),Le[a+"Shift-8"]=(e,t)=>{t.preventDefault();const n=e.getPath();/(?:^|>)UL/.test(n)?e.removeList():e.makeUnorderedList()},Le[a+"Shift-9"]=(e,t)=>{t.preventDefault();const n=e.getPath();/(?:^|>)OL/.test(n)?e.removeList():e.makeOrderedList()},Le[a+"["]=(e,t)=>{t.preventDefault();const n=e.getPath();/(?:^|>)BLOCKQUOTE/.test(n)||!/(?:^|>)[OU]L/.test(n)?e.decreaseQuoteLevel():e.decreaseListLevel()},Le[a+"]"]=(e,t)=>{t.preventDefault();const n=e.getPath();/(?:^|>)BLOCKQUOTE/.test(n)||!/(?:^|>)[OU]L/.test(n)?e.increaseQuoteLevel():e.increaseListLevel()},Le[a+"d"]=(e,t)=>{t.preventDefault(),e.toggleCode()},Le[a+"z"]=(e,t)=>{t.preventDefault(),e.undo()},Le[a+"y"]=Le[a+"Shift-z"]=Le[a+"Shift-Z"]=(e,t)=>{t.preventDefault(),e.redo()};window.Squire=class{constructor(e,t){this.customEvents=new Set(["pathChange","select","input","pasteImage","undoStateChange"]),this.startSelectionId="squire-selection-start",this.endSelectionId="squire-selection-end",this.linkRegExp=/\b(?:((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.]|[a-z0-9][a-z0-9.\-]*[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:[^\s?&`!()\[\]{};:'".,<>«»“”‘’]|\([^\s()<>]+\)))|([\w\-.%+]+@(?:[\w\-]+\.)+[a-z]{2,}\b(?:[?][^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+(?:&[^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+)*)?))/i,this.tagAfterSplit={DT:"DD",DD:"DT",LI:"LI",PRE:"PRE"},this._root=e,this._config=this._makeConfig(t),this._isFocused=!1,this._lastSelection=he(e,0),this._willRestoreSelection=!1,this._mayHaveZWS=!1,this._lastAnchorNode=null,this._lastFocusNode=null,this._path="",this._events=new Map,this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0,this._isInUndoState=!1,this._ignoreChange=!1,this._ignoreAllChanges=!1,this.addEventListener("selectionchange",this._updatePathOnEvent),this.addEventListener("blur",this._enableRestoreSelection),this.addEventListener("mousedown",this._disableRestoreSelection),this.addEventListener("touchstart",this._disableRestoreSelection),this.addEventListener("focus",this._restoreSelection),this.addEventListener("blur",this._removeZWS),this._isShiftDown=!1,this.addEventListener("cut",be),this.addEventListener("copy",ye),this.addEventListener("paste",Ee),this.addEventListener("drop",Ce),this.addEventListener("keydown",Se),this.addEventListener("keyup",Se),this.addEventListener("keydown",xe),this._keyHandlers=Object.create(Le);const n=new MutationObserver(()=>this._docWasChanged());n.observe(e,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._mutation=n,e.setAttribute("contenteditable","true"),this.addEventListener("beforeinput",this._beforeInput),this.setHTML("")}destroy(){this._events.forEach((e,t)=>{this.removeEventListener(t)}),this._mutation.disconnect(),this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0}_makeConfig(e){const t={blockTag:"DIV",classNames:{color:"color",fontFamily:"font",fontSize:"size",highlight:"highlight"},undo:{documentSizeThreshold:-1,undoLimit:-1},addLinks:!0,willCutCopy:null,toPlainText:null,sanitizeToDOMFragment:e=>{const t=DOMPurify.sanitize(e,{ALLOW_UNKNOWN_PROTOCOLS:!0,WHOLE_DOCUMENT:!1,RETURN_DOM:!0,RETURN_DOM_FRAGMENT:!0,FORCE_BODY:!1});return t?document.importNode(t,!0):document.createDocumentFragment()},didError:e=>console.log(e)};return e&&(Object.assign(t,e),t.blockTag=t.blockTag.toUpperCase()),t}setKeyHandler(e,t){return this._keyHandlers[e]=t,this}_beforeInput(e){switch(e.inputType){case"insertLineBreak":e.preventDefault(),this.splitBlock(!0);break;case"insertParagraph":e.preventDefault(),this.splitBlock(!1);break;case"insertOrderedList":e.preventDefault(),this.makeOrderedList();break;case"insertUnoderedList":e.preventDefault(),this.makeUnorderedList();break;case"historyUndo":e.preventDefault(),this.undo();break;case"historyRedo":e.preventDefault(),this.redo();break;case"formatBold":e.preventDefault(),this.bold();break;case"formaItalic":e.preventDefault(),this.italic();break;case"formatUnderline":e.preventDefault(),this.underline();break;case"formatStrikeThrough":e.preventDefault(),this.strikethrough();break;case"formatSuperscript":e.preventDefault(),this.superscript();break;case"formatSubscript":e.preventDefault(),this.subscript();break;case"formatJustifyFull":case"formatJustifyCenter":case"formatJustifyRight":case"formatJustifyLeft":{e.preventDefault();let t=e.inputType.slice(13).toLowerCase();"full"===t&&(t="justify"),this.setTextAlignment(t);break}case"formatRemove":e.preventDefault(),this.setStyle();break;case"formatSetBlockTextDirection":{e.preventDefault();let t=e.data;"null"===t&&(t=null),this.setTextDirection(t);break}case"formatBackColor":e.preventDefault(),this.setStyle({backgroundColor:e.data});break;case"formatFontColor":e.preventDefault(),this.setStyle({color:e.data});break;case"formatFontName":e.preventDefault(),this.setStyle({fontFamily:e.data})}}handleEvent(e){this.fireEvent(e.type,e)}fireEvent(e,t){let n=this._events.get(e);if(/^(?:focus|blur)/.test(e)){const t=this._root===document.activeElement;if("focus"===e){if(!t||this._isFocused)return this;this._isFocused=!0}else{if(t||!this._isFocused)return this;this._isFocused=!1}}if(n){const o=t instanceof Event?t:new CustomEvent(e,{detail:t});n=n.slice();for(const e of n)try{"handleEvent"in e?e.handleEvent(o):e.call(this,o)}catch(e){this._config.didError(e)}}return this}addEventListener(e,t){let n=this._events.get(e),o=this._root;return n||(n=[],this._events.set(e,n),this.customEvents.has(e)||("selectionchange"===e&&(o=document),o.addEventListener(e,this,!0))),n.push(t),this}removeEventListener(e,t){const n=this._events.get(e);let o=this._root;if(n){if(t){let e=n.length;for(;e--;)n[e]===t&&n.splice(e,1)}else n.length=0;n.length||(this._events.delete(e),this.customEvents.has(e)||("selectionchange"===e&&(o=document),o.removeEventListener(e,this,!0)))}return this}focus(){return this._root.focus({preventScroll:!0}),this}blur(){return this._root.blur(),this}_enableRestoreSelection(){this._willRestoreSelection=!0}_disableRestoreSelection(){this._willRestoreSelection=!1}_restoreSelection(){this._willRestoreSelection&&this.setSelection(this._lastSelection)}_removeZWS(){this._mayHaveZWS&&(B(this._root),this._mayHaveZWS=!1)}_saveRangeToBookmark(e){let t,n=S("INPUT",{id:this.startSelectionId,type:"hidden"}),o=S("INPUT",{id:this.endSelectionId,type:"hidden"});ue(e,n),e.collapse(!1),ue(e,o),n.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_PRECEDING&&(n.id=this.endSelectionId,o.id=this.startSelectionId,t=n,n=o,o=t),e.setStartAfter(n),e.setEndBefore(o)}_getRangeAndRemoveBookmark(e){const t=this._root,n=t.querySelector("#"+this.startSelectionId),o=t.querySelector("#"+this.endSelectionId);if(n&&o){let t=n.parentNode,r=o.parentNode;const i=Array.from(t.childNodes).indexOf(n);let s=Array.from(r.childNodes).indexOf(o);t===r&&--s,n.remove(),o.remove(),e||(e=document.createRange()),e.setStart(t,i),e.setEnd(r,s),Z(t,e),t!==r&&Z(r,e),e.collapsed&&(t=e.startContainer,t instanceof Text&&(r=t.childNodes[e.startOffset],r&&r instanceof Text||(r=t.childNodes[e.startOffset-1]),r&&r instanceof Text&&(e.setStart(r,0),e.collapse(!0))))}return e||null}getSelection(){const e=window.getSelection(),t=this._root;let n=null;if(this._isFocused&&e&&e.rangeCount){n=e.getRangeAt(0).cloneRange();const t=n.startContainer,o=n.endContainer;t&&p(t)&&n.setStartBefore(t),o&&p(o)&&n.setEndBefore(o)}return n&&t.contains(n.commonAncestorContainer)?this._lastSelection=n:(n=this._lastSelection,document.contains(n.commonAncestorContainer)||(n=null)),n||he(t.firstElementChild||t,0)}setSelection(e){if(this._lastSelection=e,this._isFocused){const t=window.getSelection();t&&("setBaseAndExtent"in Selection.prototype?t.setBaseAndExtent(e.startContainer,e.startOffset,e.endContainer,e.endOffset):(t.removeAllRanges(),t.addRange(e)))}else this._enableRestoreSelection();return this}_moveCursorTo(e){const t=this._root,n=he(t,e?0:t.childNodes.length);return U(n),this.setSelection(n),this}moveCursorToStart(){return this._moveCursorTo(!0)}moveCursorToEnd(){return this._moveCursorTo(!1)}getCursorPosition(){const e=this.getSelection();let t=e.getBoundingClientRect();if(t&&!t.top){this._ignoreChange=!0;const o=S("SPAN");o.textContent=n,ue(e,o),t=o.getBoundingClientRect();const r=o.parentNode;r.removeChild(o),Z(r,e)}return t}getPath(){return this._path}_updatePathOnEvent(){this._isFocused&&this._updatePath(this.getSelection())}_updatePath(e,t){const n=e.startContainer,o=e.endContainer;let r;(t||n!==this._lastAnchorNode||o!==this._lastFocusNode)&&(this._lastAnchorNode=n,this._lastFocusNode=o,r=n&&o?n===o?this._getPath(o):"(selection)":"",this._path===r&&n===o||(this._path=r,this.fireEvent("pathChange",{path:r}))),this.fireEvent(e.collapsed?"cursor":"select",{range:e})}_getPath(e){const t=this._root,n=this._config;let o="";if(e&&e!==t){const t=e.parentNode;if(o=t?this._getPath(t):"",e instanceof HTMLElement){const t=e.id,r=e.classList,i=Array.from(r).sort(),s=e.dir,a=n.classNames;o+=(o?">":"")+e.nodeName,t&&(o+="#"+t),i.length&&(o+=".",o+=i.join(".")),s&&(o+="[dir="+s+"]"),r.contains(a.highlight)&&(o+="[backgroundColor="+e.style.backgroundColor.replace(/ /g,"")+"]"),r.contains(a.color)&&(o+="[color="+e.style.color.replace(/ /g,"")+"]"),r.contains(a.fontFamily)&&(o+="[fontFamily="+e.style.fontFamily.replace(/ /g,"")+"]"),r.contains(a.fontSize)&&(o+="[fontSize="+e.style.fontSize+"]")}}return o}modifyDocument(e){const t=this._mutation;return t&&(t.takeRecords().length&&this._docWasChanged(),t.disconnect()),this._ignoreAllChanges=!0,e(),this._ignoreAllChanges=!1,t&&(t.observe(this._root,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._ignoreChange=!1),this}_docWasChanged(){f=new WeakMap,this._mayHaveZWS=!0,this._ignoreAllChanges||(this._ignoreChange?this._ignoreChange=!1:(this._isInUndoState&&(this._isInUndoState=!1,this.fireEvent("undoStateChange",{canUndo:!0,canRedo:!1})),this.fireEvent("input")))}_recordUndoState(e,t){const n=this._isInUndoState;if(!n||t){let o=this._undoIndex+1;const r=this._undoStack,i=this._config.undo,s=i.documentSizeThreshold,a=i.undoLimit;if(o<this._undoStackLength&&(r.length=this._undoStackLength=o),e&&this._saveRangeToBookmark(e),n)return this;const l=this._getRawHTML();t&&--o,s>-1&&2*l.length>s&&a>-1&&o>a&&(r.splice(0,o-a),o=a,this._undoStackLength=a),r[o]=l,this._undoIndex=o,++this._undoStackLength,this._isInUndoState=!0}return this}saveUndoState(e){return e||(e=this.getSelection()),this._recordUndoState(e,this._isInUndoState),this._getRangeAndRemoveBookmark(e),this}undo(){if(0!==this._undoIndex||!this._isInUndoState){this._recordUndoState(this.getSelection(),!1),--this._undoIndex,this._setRawHTML(this._undoStack[this._undoIndex]);const e=this._getRangeAndRemoveBookmark();e&&this.setSelection(e),this._isInUndoState=!0,this.fireEvent("undoStateChange",{canUndo:0!==this._undoIndex,canRedo:!0}),this.fireEvent("input")}return this.focus()}redo(){const e=this._undoIndex,t=this._undoStackLength;if(e+1<t&&this._isInUndoState){++this._undoIndex,this._setRawHTML(this._undoStack[this._undoIndex]);const n=this._getRangeAndRemoveBookmark();n&&this.setSelection(n),this.fireEvent("undoStateChange",{canUndo:!0,canRedo:e+2<t}),this.fireEvent("input")}return this.focus()}getRoot(){return this._root}_getRawHTML(){return this._root.innerHTML}_setRawHTML(e){if(void 0!==e){const t=this._root;let n=t;t.innerHTML=e;do{Q(n)}while(n=re(n,t));this._ignoreChange=!0}return this}getHTML(e){let t;e&&(t=this.getSelection(),this._saveRangeToBookmark(t));const n=this._getRawHTML().replace(/\u200B/g,"");return e&&this._getRangeAndRemoveBookmark(t),n}setHTML(e){const t=this._config.sanitizeToDOMFragment(e,this),n=this._root;W(t,this._config),K(t),X(t);let o=t,r=o.firstChild;if(r&&"BR"!==r.nodeName)for(;o=re(o,n);)Q(o);else{const e=this.createDefaultBlock();r?o.replaceChild(e,r):o.append(e)}for(this._ignoreChange=!0;r=n.lastChild;)n.removeChild(r);n.append(t),this._undoIndex=-1,this._undoStack.length=0,this._undoStackLength=0,this._isInUndoState=!1;const i=this._getRangeAndRemoveBookmark()||he(n.firstElementChild||n,0);return this.saveUndoState(i),this.setSelection(i),this._updatePath(i,!0),this}insertHTML(e,t){const n=this._config;let o=n.sanitizeToDOMFragment(e,this);const r=this.getSelection();this.saveUndoState(r);try{const i=this._root;n.addLinks&&this.addDetectedLinks(o,o),W(o,this._config),K(o),z(o),o.normalize();let s=o;for(;s=re(s,o);)Q(s);let a=!0;if(t){const t=new CustomEvent("willPaste",{cancelable:!0,detail:{html:e,fragment:o}});this.fireEvent("willPaste",t),o=t.detail.fragment,a=!t.defaultPrevented}a&&(((e,t,n)=>{const o=t.firstChild&&m(t.firstChild);let r;for(X(t),r=t;r=re(r,n);)Q(r);e.collapsed||ge(e,n),U(e),e.collapse(!1);const i=O(e.endContainer,n,"BLOCKQUOTE")||n;let s=se(e,n),a=null;const l=re(t,t),c=!o&&!!s&&ie(s);if(s&&l&&!c&&!O(l,t,"PRE")&&!O(l,t,"TABLE")){P(e,s,s,n),e.collapse(!0);let t=e.endContainer,o=e.endOffset;if(K(s),m(t)){const e=Y(t,o,oe(t,n)||n,n);t=e.parentNode,o=Array.from(t.childNodes).indexOf(e)}if(o!==x(t))for(a=document.createDocumentFragment();r=t.childNodes[o];)a.append(r);ee(t,l,e,n),o=Array.from(t.parentNode.childNodes).indexOf(t)+1,t=t.parentNode,e.setEnd(t,o)}if(x(t)){c&&s&&(e.setEndBefore(s),e.collapse(!1),A(s)),P(e,i,i,n);let o=Y(e.endContainer,e.endOffset,i,n);const r=o?o.previousSibling:i.lastChild;i.insertBefore(t,o),o?e.setEndBefore(o):e.setEnd(i,x(i)),s=ae(e,n),U(e);const a=e.endContainer,l=e.endOffset;o&&y(o)&&te(o,n),o=r&&r.nextSibling,o&&y(o)&&te(o,n),e.setEnd(a,l)}if(a&&s){const t=e.cloneRange();Q(a),ee(s,a,t,n),e.setEnd(t.endContainer,t.endOffset)}U(e)})(r,o,i),r.collapse(!1),M(r,"A",i),this._ensureBottomLine()),this.setSelection(r),this._updatePath(r,!0),t&&this.focus()}catch(e){this._config.didError(e)}return this}insertElement(e,t){if(t||(t=this.getSelection()),t.collapse(!0),m(e))ue(t,e),t.setStartAfter(e);else{const n=this._root,o=se(t,n);let r=o||n,i=null;for(;r!==n&&!r.nextSibling;)r=r.parentNode;if(r!==n){const e=r.parentNode;i=Y(e,r.nextSibling,n,n)}o&&ie(o)&&A(o),n.insertBefore(e,i);const s=this.createDefaultBlock();n.insertBefore(s,i),t.setStart(s,0),t.setEnd(s,0),U(t)}return this.focus(),this.setSelection(t),this._updatePath(t),this}insertImage(e,t){const n=S("IMG",Object.assign({src:e},t));return this.insertElement(n),n}insertPlainText(e,t){const n=this.getSelection();if(n.collapsed&&O(n.startContainer,this._root,"PRE")){const o=n.startContainer;let r,i=n.startOffset;if(o&&o instanceof Text)r=o;else{const e=document.createTextNode("");o.insertBefore(e,o.childNodes[i]),r=e,i=0}let s=!0;if(t){const t=new CustomEvent("willPaste",{cancelable:!0,detail:{text:e}});this.fireEvent("willPaste",t),e=t.detail.text,s=!t.defaultPrevented}return s&&(r.insertData(i,e),n.setStart(r,i+e.length),n.collapse(!0)),this.setSelection(n),this}const o=e.split("\n"),r=this._config.blockTag,i="</"+r+">",s="<"+r+">";for(let e=0,t=o.length;e<t;++e){let t=o[e];t=G(t).replace(/ (?=(?: |$))/g,"&nbsp;"),e&&(t=s+(t||"<BR>")+i),o[e]=t}return this.insertHTML(o.join(""),t)}getSelectedText(e){return me(e||this.getSelection())}getFontInfo(e){const t={color:void 0,backgroundColor:void 0,fontFamily:void 0,fontSize:void 0};e||(e=this.getSelection()),U(e);let n=0,o=e.commonAncestorContainer;if(e.collapsed||o instanceof Text)for(o instanceof Text&&(o=o.parentNode);n<4&&o;){const e=o.style;if(e){const o=e.color;!t.color&&o&&(t.color=o,++n);const r=e.backgroundColor;!t.backgroundColor&&r&&(t.backgroundColor=r,++n);const i=e.fontFamily;!t.fontFamily&&i&&(t.fontFamily=i,++n);const s=e.fontSize;!t.fontSize&&s&&(t.fontSize=s,++n)}o=o.parentNode}return t}hasFormat(e,n,o){e=e.toUpperCase(),n||(n={}),o||(o=this.getSelection()),!o.collapsed&&o.startContainer instanceof Text&&o.startOffset===o.startContainer.length&&o.startContainer.nextSibling&&o.setStartBefore(o.startContainer.nextSibling),!o.collapsed&&o.endContainer instanceof Text&&0===o.endOffset&&o.endContainer.previousSibling&&o.setEndAfter(o.endContainer.previousSibling);const r=this._root,i=o.commonAncestorContainer;if(N(i,r,e,n))return!0;if(i instanceof Text)return!1;const s=t(i,4,e=>I(o,e,!0));let a,l=!1;for(;a=s.nextNode();){if(!N(a,r,e,n))return!1;l=!0}return l}changeFormat(e,t,n,o){return n||(n=this.getSelection()),this.saveUndoState(n),t&&(n=this._removeFormat(t.tag.toUpperCase(),t.attributes||{},n,o)),e&&(n=this._addFormat(e.tag.toUpperCase(),e.attributes||{},n)),this.setSelection(n),this._updatePath(n,!0),this.focus()}_addFormat(n,o,r){const i=this._root;if(r.collapsed){const e=Q(S(n,o));ue(r,e);const t=e.firstChild||e,i=t instanceof Text?t.length:0;r.setStart(t,i),r.collapse(!0);let s=e;for(;m(s);)s=s.parentNode;B(s,e)}else{const s=t(r.commonAncestorContainer,5,e=>(e instanceof Text||"BR"===e.nodeName||"IMG"===e.nodeName)&&I(r,e,!0));let{startContainer:a,startOffset:l,endContainer:c,endOffset:h}=r;if(s.currentNode=a,!((a instanceof Element||a instanceof Text)&&e===s.filter.acceptNode(a))){const e=s.nextNode();if(!e)return r;a=e,l=0}do{let e=s.currentNode;if(!N(e,i,n,o)){e===c&&e.length>h&&e.splitText(h),e===a&&l&&(e=e.splitText(l),c===a?(c=e,h-=l):c===a.parentNode&&++h,a=e,l=0);const t=S(n,o);k(e,t),t.append(e)}}while(s.nextNode());r=he(a,l,c,h)}return r}_removeFormat(e,t,o,r){let i;this._saveRangeToBookmark(o),o.collapsed&&(i=l?document.createTextNode(n):document.createTextNode(""),ue(o,i));let s=o.commonAncestorContainer;for(;m(s);)s=s.parentNode;const a=o.startContainer,c=o.startOffset,h=o.endContainer,u=o.endOffset,f=[],p=(e,t)=>{if(I(o,e,!1))return;let n,r;if(I(o,e,!0))if(e instanceof Text)e===h&&u!==e.length&&f.push([t,e.splitText(u)]),e===a&&c&&(e.splitText(c),f.push([t,e]));else for(n=e.firstChild;n;n=r)r=n.nextSibling,p(n,t);else e instanceof HTMLInputElement||e instanceof Text&&!e.data||f.push([t,e])},g=Array.from(s.getElementsByTagName(e)).filter(n=>I(o,n,!0)&&C(n,e,t));if(r||g.forEach(e=>p(e,e)),f.forEach(([e,t])=>{e=e.cloneNode(!1),k(t,e),e.append(t)}),g.forEach(e=>k(e,L(e))),l&&i){i=i.parentNode;let e=i;for(;e&&m(e);)e=e.parentNode;e&&B(e,i)}return this._getRangeAndRemoveBookmark(o),i&&o.collapse(!1),Z(s,o),o}bold(){this.toggleTag("B")}italic(){this.toggleTag("I")}underline(){this.toggleTag("U")}strikethrough(){this.toggleTag("S")}subscript(){this.toggleTag("SUB","SUP")}superscript(){this.toggleTag("SUP","SUB")}makeLink(e,t){const n=this.getSelection();if(n.collapsed){let t=e.indexOf(":")+1;if(t)for(;"/"===e[t];)++t;ue(n,document.createTextNode(e.slice(t)))}return t=Object.assign({href:e},t),this.changeFormat({tag:"A",attributes:t},{tag:"A"},n)}removeLink(){return this.changeFormat(null,{tag:"A"},this.getSelection(),!0)}addDetectedLinks(e,n){const o=t(e,4,e=>!O(e,n||this._root,"A")),r=this.linkRegExp;let i;for(;i=o.nextNode();){const e=i.parentNode;let t,n=i.data;for(;t=r.exec(n);){const o=t.index,r=o+t[0].length;o&&e.insertBefore(document.createTextNode(n.slice(0,o)),i);const s=S("A",{href:t[1]?/^(?:ht|f)tps?:/i.test(t[1])?t[1]:"http://"+t[1]:"mailto:"+t[0]});s.textContent=n.slice(o,r),e.insertBefore(s,i),i.data=n=n.slice(r)}}return this}_ensureBottomLine(){const e=this._root,t=e.lastElementChild;t&&t.nodeName===this._config.blockTag&&v(t)||e.append(this.createDefaultBlock())}createDefaultBlock(e){const t=this._config;return Q(S(t.blockTag,null,e))}splitBlock(e,t){t||(t=this.getSelection());const o=this._root;let r,i,s,a;if(this._recordUndoState(t),this._removeZWS(),this._getRangeAndRemoveBookmark(t),t.collapsed||ge(t,o),this._config.addLinks){U(t);const e=t.startContainer,n=t.startOffset;setTimeout(()=>{Te(this,e,n)},0)}if(r=se(t,o),r&&(i=O(r,o,"PRE"))){U(t),s=t.startContainer;const n=t.startOffset;return s instanceof Text||(s=document.createTextNode(""),i.insertBefore(s,i.firstChild)),!e&&s instanceof Text&&("\n"===s.data.charAt(n-1)||ce(t,o))&&("\n"===s.data.charAt(n)||de(t,o))?(s.deleteData(n&&n-1,n?2:1),a=Y(s,n&&n-1,o,o),s=a.previousSibling,s.textContent||A(s),s=this.createDefaultBlock(),a.parentNode.insertBefore(s,a),a.textContent||A(a),t.setStart(s,0)):(s.insertData(n,"\n"),Q(i),s.length===n+1?t.setStartAfter(s):t.setStart(s,n+1)),t.collapse(!0),this.setSelection(t),this._updatePath(t,!0),this._docWasChanged(),this}if(!r||e||/^T[HD]$/.test(r.nodeName))return M(t,"A",o),ue(t,S("BR")),t.collapse(!1),this.setSelection(t),this._updatePath(t,!0),this;if((i=O(r,o,"LI"))&&(r=i),ie(r)){if(O(r,o,"UL")||O(r,o,"OL"))return this.decreaseListLevel(t),this;if(O(r,o,"BLOCKQUOTE"))return this.replaceWithBlankLine(t),this}s=t.startContainer;const l=t.startOffset;let c=this.tagAfterSplit[r.nodeName]||this._config.blockTag;for(a=Y(s,l,r.parentNode,this._root),C(a,c)||(r=S(c),a.dir&&(r.dir=a.dir),k(a,r),r.append(L(a)),a=r),B(r),z(r),Q(r);a instanceof Element;){let e,t=a.firstChild;if("A"===a.nodeName&&(!a.textContent||a.textContent===n)){t=document.createTextNode(""),k(a,t),a=t;break}for(;t&&t instanceof Text&&!t.length&&(e=t.nextSibling,e&&"BR"!==e.nodeName);)A(t),t=e;if(!t||"BR"===t.nodeName||t instanceof Text)break;a=t}return t=he(a,0),this.setSelection(t),this._updatePath(t,!0),this}forEachBlock(e,t,n){n||(n=this.getSelection()),t&&this.saveUndoState(n);const o=this._root;let r=se(n,o);const i=ae(n,o);if(r&&i)do{if(e(r)||r===i)break}while(r=re(r,o));return t&&(this.setSelection(n),this._updatePath(n,!0)),this}modifyBlocks(e,t){t||(t=this.getSelection()),this._recordUndoState(t,this._isInUndoState);const n=this._root;((e,t)=>{const n=se(e,t),o=ae(e,t);let r;n&&o&&(r=n.parentNode,e.setStart(r,Array.from(r.childNodes).indexOf(n)),r=o.parentNode,e.setEnd(r,Array.from(r.childNodes).indexOf(o)+1))})(t,n),P(t,n,n,n);const o=fe(t,n,n);if(!t.collapsed){let e=t.endContainer;if(e===n)t.collapse(!1);else{for(;e.parentNode!==n;)e=e.parentNode;t.setStartBefore(e),t.collapse(!0)}}return ue(t,e.call(this,o)),t.endOffset<t.endContainer.childNodes.length&&te(t.endContainer.childNodes[t.endOffset],n),te(t.startContainer.childNodes[t.startOffset],n),this._getRangeAndRemoveBookmark(t),this.setSelection(t),this._updatePath(t,!0),this}setTextAlignment(e){return this.forEachBlock(t=>{const n=t.className.split(/\s+/).filter(e=>!!e&&!/^align/.test(e)).join(" ");e?(t.className=n+" align-"+e,t.style.textAlign=e):(t.className=n,t.style.textAlign="")},!0),this.focus()}setTextDirection(e){return this.forEachBlock(t=>{e?t.dir=e:t.removeAttribute("dir")},!0),this.focus()}_getListSelection(e,t){let n=e.commonAncestorContainer,o=e.startContainer,r=e.endContainer;for(;n&&n!==t&&!/^[OU]L$/.test(n.nodeName);)n=n.parentNode;if(!n||n===t)return null;for(o===n&&(o=o.childNodes[e.startOffset]),r===n&&(r=r.childNodes[e.endOffset]);o&&o.parentNode!==n;)o=o.parentNode;for(;r&&r.parentNode!==n;)r=r.parentNode;return[n,o,r]}increaseListLevel(e){e||(e=this.getSelection());const t=this._root,n=this._getListSelection(e,t);if(!n)return this.focus();let[o,r,i]=n;if(!r||r===o.firstChild)return this.focus();this._recordUndoState(e,this._isInUndoState);const s=o.nodeName;let a,l=r.previousSibling;l.nodeName!==s&&(l=S(s),o.insertBefore(l,r));do{a=r===i?null:r.nextSibling,l.append(r)}while(r=a);return a=l.nextSibling,a&&te(a,t),this._getRangeAndRemoveBookmark(e),this.setSelection(e),this._updatePath(e,!0),this.focus()}decreaseListLevel(e){e||(e=this.getSelection());const t=this._root,n=this._getListSelection(e,t);if(!n)return this.focus();let o,[r,i,s]=n;i||(i=r.firstChild),s||(s=r.lastChild),this._recordUndoState(e,this._isInUndoState);let a=null;if(i){let e=r.parentNode;if(a=s.nextSibling?Y(r,s.nextSibling,e,t):r.nextSibling,e!==t&&"LI"===e.nodeName){for(e=e.parentNode;a;)o=a.nextSibling,s.append(a),a=o;a=r.parentNode.nextSibling}const n=!/^[OU]L$/.test(e.nodeName);do{o=i===s?null:i.nextSibling,r.removeChild(i),n&&"LI"===i.nodeName&&(i=this.createDefaultBlock([L(i)])),e.insertBefore(i,a)}while(i=o)}return r.firstChild||A(r),a&&te(a,t),this._getRangeAndRemoveBookmark(e),this.setSelection(e),this._updatePath(e,!0),this.focus()}_makeList(e,t){const n=ne(e,this._root);let o;for(;o=n.nextNode();)if(o.parentNode instanceof HTMLLIElement&&(o=o.parentNode,n.currentNode=o.lastChild),o instanceof HTMLLIElement){o=o.parentNode;const e=o.nodeName;e!==t&&/^[OU]L$/.test(e)&&k(o,S(t,null,[L(o)]))}else{const e=S("LI");o.dir&&(e.dir=o.dir);const r=o.previousSibling;r&&r.nodeName===t?(r.append(e),A(o)):k(o,S(t,null,[e])),e.append(L(o)),n.currentNode=e}return e}makeUnorderedList(){return this.modifyBlocks(e=>this._makeList(e,"UL")),this.focus()}makeOrderedList(){return this.modifyBlocks(e=>this._makeList(e,"OL")),this.focus()}removeList(){return this.modifyBlocks(e=>{const t=e.querySelectorAll("UL, OL"),n=e.querySelectorAll("LI");this._root;for(let e=0,n=t.length;e<n;++e){const n=t[e],o=L(n);X(o),k(n,o)}for(let e=0,t=n.length;e<t;++e){const t=n[e];v(t)?k(t,this.createDefaultBlock([L(t)])):(X(t),k(t,L(t)))}return e}),this.focus()}increaseQuoteLevel(e){return this.modifyBlocks(e=>S("BLOCKQUOTE",null,[e]),e),this.focus()}decreaseQuoteLevel(e){return this.modifyBlocks(e=>(Array.from(e.querySelectorAll("blockquote")).filter(t=>!O(t.parentNode,e,"BLOCKQUOTE")).forEach(e=>{k(e,L(e))}),e),e),this.focus()}removeQuote(e){return this.modifyBlocks(e=>(Array.from(e.querySelectorAll("blockquote")).forEach(e=>{k(e,L(e))}),e),e),this.focus()}replaceWithBlankLine(e){return this.modifyBlocks(()=>this.createDefaultBlock([S("INPUT",{id:this.startSelectionId,type:"hidden"}),S("INPUT",{id:this.endSelectionId,type:"hidden"})]),e),this.focus()}code(){const e=this.getSelection();return e.collapsed||y(e.commonAncestorContainer)?(this.modifyBlocks(e=>{const n=this._root,o=document.createDocumentFragment(),r=ne(e,n);let i;for(;i=r.nextNode();){let e=i.querySelectorAll("BR");const t=[];let n=e.length;for(let o=0;o<n;++o)t[o]=R(e[o]);for(;n--;){const o=e[n];t[n]?k(o,document.createTextNode("\n")):A(o)}for(e=i.querySelectorAll("CODE"),n=e.length;n--;)k(e[n],L(e[n]));o.childNodes.length&&o.append(document.createTextNode("\n")),o.append(L(i))}const s=t(o,4);for(;i=s.nextNode();)i.data=i.data.replace(/ /g," ");return o.normalize(),Q(S("PRE",null,[o]))},e),this.focus()):this.changeFormat({tag:"CODE",attributes:null},null,e),this}removeCode(){const e=this.getSelection(),n=e.commonAncestorContainer;return O(n,this._root,"PRE")?(this.modifyBlocks(e=>{this._root;const n=e.querySelectorAll("PRE");let o=n.length;for(;o--;){const e=n[o],r=t(e,4);let i;for(;i=r.nextNode();){let e=i.data;e=e.replace(/ (?= )/g," ");const t=document.createDocumentFragment();let n;for(;(n=e.indexOf("\n"))>-1;)t.append(document.createTextNode(e.slice(0,n))),t.append(S("BR")),e=e.slice(n+1);i.parentNode.insertBefore(t,i),i.data=e}X(e),k(e,L(e))}return e},e),this.focus()):this.changeFormat(null,{tag:"CODE"},e),this}toggleCode(){return this.hasFormat("PRE")||this.hasFormat("CODE")?this.removeCode():this.code(),this}changeIndentationLevel(e){let t=this.getSelectionClosest("UL,OL,BLOCKQUOTE");if(t||"increase"===e)return this[(e+=t&&"BLOCKQUOTE"!==t.nodeName?"List":"Quote")+"Level"]()}getSelectionClosest(e){return O(this.getSelection().commonAncestorContainer,this._root,e)}setAttribute(e,t){let n=this.getSelection(),o=n?.startContainer||{},r=n?.endContainer||{};if("dir"==e||o instanceof Text&&0===n.startOffset&&o===r&&r.length===n.endOffset)this._recordUndoState(n),w(o.parentNode,{[e]:t}),this._docWasChanged();else if(null==t){this._recordUndoState(n);let o=O(n.commonAncestorContainer,this._root,"*");n.collapsed?w(o,{[e]:t}):o.querySelectorAll("*").forEach(n=>w(n,{[e]:t})),this._docWasChanged()}else this.changeFormat({tag:"SPAN",attributes:{[e]:t}},null,n);return this.focus()}setStyle(e){this.setAttribute("style",e)}toggleTag(e,t){let n=this.getSelection();this.hasFormat(e,null,n)?this.changeFormat(null,{tag:e},n):this.changeFormat({tag:e},t?{tag:t}:null,n)}setRange(e){this.setSelection(e),this._updatePath(e,!0)}setConfig(e){return this._config=mergeObjects({addLinks:!0},e,!0),this}}})(),(()=>{"use strict";const e=2147483647,t=36,n=/^xn--/,o=/[^\0-\x7F]/,r=/[\x2E\u3002\uFF0E\uFF61]/g,i={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},s=Math.floor,a=String.fromCharCode,l=e=>{throw new RangeError(i[e])},c=(e,t)=>{const n=(e||"").split("@");return n.push(n.pop().split(r).map(e=>t(e)).join(".")),n.join("@")},h=e=>e>=48&&e<58?e-48+26:e>=65&&e<91?e-65:e>=97&&e<123?e-97:t,u=(e,t)=>e+22+75*(e<26)-((0!=t)<<5),f=(e,n,o)=>{let r=0;for(e=o?s(e/700):e>>1,e+=s(e/n);e>455;r+=t)e=s(e/35);return s(r+36*e/(e+38))};window.IDN={version:"2.3.1",toUnicode:o=>c(o,o=>n.test(o)?(n=>{const o=[],r=n.length;let i=0,a=128,c=72,u=n.lastIndexOf("-");u<0&&(u=0);for(let e=0;e<u;++e)n.charCodeAt(e)>=128&&l("not-basic"),o.push(n.charCodeAt(e));for(let p=u>0?u+1:0;p<r;){const u=i;for(let o=1,a=t;;a+=t){p>=r&&l("invalid-input");const u=h(n.charCodeAt(p++));u>=t&&l("invalid-input"),u>s((e-i)/o)&&l("overflow"),i+=u*o;const f=a<=c?1:a>=c+26?26:a-c;if(u<f)break;const g=t-f;o>s(e/g)&&l("overflow"),o*=g}const g=o.length+1;c=f(i-u,g,0==u),s(i/g)>e-a&&l("overflow"),a+=s(i/g),i%=g,o.splice(i++,0,a)}return String.fromCodePoint(...o)})(o.slice(4).toLowerCase()):o),toASCII:n=>c(n,n=>(o.test(n)?"xn--"+(n=>{const o=[];n=(e=>{const t=[];let n=0;const o=e.length;for(;n<o;){const r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<o){const o=e.charCodeAt(n++);56320==(64512&o)?t.push(((1023&r)<<10)+(1023&o)+65536):(t.push(r),n--)}else t.push(r)}return t})(n);const r=n.length;let i=128,c=0,h=72;for(const e of n)e<128&&o.push(a(e));const p=o.length;let g=p;for(p&&o.push("-");g<r;){let r=e;for(const e of n)e>=i&&e<r&&(r=e);const m=g+1;r-i>s((e-c)/m)&&l("overflow"),c+=(r-i)*m,i=r;for(const r of n)if(r<i&&++c>e&&l("overflow"),r===i){let e=c;for(let n=t;;n+=t){const r=n<=h?1:n>=h+26?26:n-h;if(e<r)break;const i=e-r,l=t-r;o.push(a(u(r+i%l,0))),e=s(i/l)}o.push(a(u(e,0))),h=f(c,m,g===p),c=0,++g}++c,++i}return o.join("")})(n):n).toLowerCase())}})();const TurndownService=(()=>{const e=(e,t)=>Array(t+1).join(e),t=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"],n=e=>s(e,t),o=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"],r=e=>s(e,o),i=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"],s=(e,t)=>t.indexOf(e.nodeName)>=0,a=(e,t)=>e.getElementsByTagName&&t.some(t=>e.getElementsByTagName(t).length),l={paragraph:{filter:"p",replacement:e=>"\n\n"+e+"\n\n"},lineBreak:{filter:"br",replacement:(e,t,n)=>n.br+"\n"},heading:{filter:["h1","h2","h3","h4","h5","h6"],replacement:(t,n,o)=>{var r=Number(n.nodeName.charAt(1));return"setext"===o.headingStyle&&r<3?"\n\n"+t+"\n"+e(1===r?"=":"-",t.length)+"\n\n":"\n\n"+e("#",r)+" "+t+"\n\n"}},blockquote:{filter:"blockquote",replacement:e=>"\n\n"+(e=(e=e.replace(/^\n+|\n+$/g,"")).replace(/^/gm,"> "))+"\n\n"},list:{filter:["ul","ol"],replacement:(e,t)=>{var n=t.parentNode;return"LI"===n.nodeName&&n.lastElementChild===t?"\n"+e:"\n\n"+e+"\n\n"}},listItem:{filter:"li",replacement:(e,t,n)=>{e=e.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");var o=n.bulletListMarker+"   ",r=t.parentNode;if("OL"===r.nodeName){var i=r.getAttribute("start"),s=Array.prototype.indexOf.call(r.children,t);o=(i?Number(i)+s:s+1)+".  "}return o+e+(t.nextSibling&&!/\n$/.test(e)?"\n":"")}},indentedCodeBlock:{filter:(e,t)=>"indented"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName,replacement:(e,t)=>"\n\n    "+t.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"},fencedCodeBlock:{filter:(e,t)=>"fenced"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName,replacement:(t,n,o)=>{for(var r,i=((n.firstChild.getAttribute("class")||"").match(/language-(\S+)/)||[null,""])[1],s=n.firstChild.textContent,a=o.fence.charAt(0),l=3,c=new RegExp("^"+a+"{3,}","gm");r=c.exec(s);)r[0].length>=l&&(l=r[0].length+1);var h=e(a,l);return"\n\n"+h+i+"\n"+s.replace(/\n$/,"")+"\n"+h+"\n\n"}},horizontalRule:{filter:"hr",replacement:(e,t,n)=>"\n\n"+n.hr+"\n\n"},inlineLink:{filter:(e,t)=>"inlined"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href"),replacement:(e,t)=>{var n=t.getAttribute("href");n&&(n=n.replace(/([()])/g,"\\$1"));var o=c(t.getAttribute("title"));return o&&(o=' "'+o.replace(/"/g,'\\"')+'"'),"["+e+"]("+n+o+")"}},referenceLink:{filter:(e,t)=>"referenced"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href"),replacement(e,t,n){var o,r,i=t.getAttribute("href"),s=c(t.getAttribute("title"));switch(s&&(s=' "'+s+'"'),n.linkReferenceStyle){case"collapsed":o="["+e+"][]",r="["+e+"]: "+i+s;break;case"shortcut":o="["+e+"]",r="["+e+"]: "+i+s;break;default:var a=this.references.length+1;o="["+e+"]["+a+"]",r="["+a+"]: "+i+s}return this.references.push(r),o},references:[],append(){var e="";return this.references.length&&(e="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),e}},emphasis:{filter:["em","i"],replacement:(e,t,n)=>e.trim()?n.emDelimiter+e+n.emDelimiter:""},strong:{filter:["strong","b"],replacement:(e,t,n)=>e.trim()?n.strongDelimiter+e+n.strongDelimiter:""},code:{filter:e=>{var t=e.previousSibling||e.nextSibling,n="PRE"===e.parentNode.nodeName&&!t;return"CODE"===e.nodeName&&!n},replacement:e=>{if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",n="`",o=e.match(/`+/gm)||[];-1!==o.indexOf(n);)n+="`";return n+t+e+t+n}},image:{filter:"img",replacement:(e,t)=>{var n=c(t.getAttribute("alt")),o=t.getAttribute("src")||"",r=c(t.getAttribute("title"));return o?"!["+n+"]("+o+(r?' "'+r+'"':"")+")":""}},style:{filter:"style",replacement:()=>""}},c=e=>e?e.replace(/(\n+\s*)+/g,"\n"):"";class Rules{constructor(e){for(var t in this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[],e.rules)this.array.push(e.rules[t])}add(e,t){this.array.unshift(t)}keep(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})}remove(e){this._remove.unshift({filter:e,replacement:()=>""})}forNode(e){return e.isBlank?this.blankRule:h(this.array,e,this.options)||h(this._keep,e,this.options)||h(this._remove,e,this.options)||this.defaultRule}forEach(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}}const h=(e,t,n)=>{for(var o=0;o<e.length;o++){var r=e[o];if(u(r,t,n))return r}},u=(e,t,n)=>{var o=e.filter;if("string"==typeof o)return o===t.nodeName.toLowerCase();if(Array.isArray(o))return o.indexOf(t.nodeName.toLowerCase())>-1;if("function"==typeof o)return!!o.call(e,t,n);throw new TypeError("`filter` needs to be a string, array, or function")},f=e=>{var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t},p=(e,t,n)=>e&&e.parentNode===t||n(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode,g=(e,t)=>{var o;"string"==typeof e?o=v().parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html").getElementById("turndown-root"):o=e.cloneNode(!0);return(e=>{var t=e.element,n=e.isBlock,o=e.isVoid,r=e.isPre||(e=>"PRE"===e.nodeName);if(t.firstChild&&!r(t)){for(var i=null,s=!1,a=null,l=p(a,t,r);l!==t;){if(3===l.nodeType||4===l.nodeType){var c=l.data.replace(/[ \r\n\t]+/g," ");if(i&&!/ $/.test(i.data)||s||" "!==c[0]||(c=c.substr(1)),!c){l=f(l);continue}l.data=c,i=l}else{if(1!==l.nodeType){l=f(l);continue}n(l)||"BR"===l.nodeName?(i&&(i.data=i.data.replace(/ $/,"")),i=null,s=!1):o(l)||r(l)?(i=null,s=!0):i&&(s=!1)}var h=p(a,l,r);a=l,l=h}i&&(i.data=i.data.replace(/ $/,""),i.data||f(i))}})({element:o,isBlock:n,isVoid:r,isPre:t.preformattedCode?y:null}),o};var m;const v=()=>m=m||new DOMParser,y=e=>"PRE"===e.nodeName||"CODE"===e.nodeName,S=e=>!r(e)&&!(e=>s(e,i))(e)&&/^\s*$/i.test(e.textContent)&&!(e=>a(e,o))(e)&&!(e=>a(e,i))(e),E=(e,t)=>{if(e.isBlock||t.preformattedCode&&e.isCode)return{leading:"",trailing:""};var n=C(e.textContent);return n.leadingAscii&&N("left",e,t)&&(n.leading=n.leadingNonAscii),n.trailingAscii&&N("right",e,t)&&(n.trailing=n.trailingNonAscii),{leading:n.leading,trailing:n.trailing}},C=e=>{var t=e.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:t[1],leadingAscii:t[2],leadingNonAscii:t[3],trailing:t[4],trailingNonAscii:t[5],trailingAscii:t[6]}},N=(e,t,o)=>{var r,i,s;return"left"===e?(r=t.previousSibling,i=/ $/):(r=t.nextSibling,i=/^ /),r&&(3===r.nodeType?s=i.test(r.nodeValue):o.preformattedCode&&"CODE"===r.nodeName?s=!1:1!==r.nodeType||n(r)||(s=i.test(r.textContent))),s},_=Array.prototype.reduce,T=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];const x=(e,t)=>{var n=(e=>{for(var t=e.length;t>0&&"\n"===e[t-1];)t--;return e.substring(0,t)})(e),o=t.replace(/^\n*/,""),r=Math.max(e.length-n.length,t.length-o.length);return n+"\n\n".substring(0,r)+o},L=e=>null!=e&&("string"==typeof e||e.nodeType&&(1===e.nodeType||9===e.nodeType||11===e.nodeType));return class TurndownService{constructor(e){this.options=Object.assign({rules:l,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:(e,t)=>t.isBlock?"\n\n":"",keepReplacement:(e,t)=>t.isBlock?"\n\n"+t.outerHTML+"\n\n":t.outerHTML,defaultReplacement:(e,t)=>t.isBlock?"\n\n"+e+"\n\n":e},e),this.rules=new Rules(this.options)}turndown(e){if(!L(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(""===e)return"";var t=this.process(g(e,this.options));return this.postProcess(t)}use(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else{if("function"!=typeof e)throw new TypeError("plugin must be a Function or an Array of Functions");e(this)}return this}addRule(e,t){return this.rules.add(e,t),this}keep(e){return this.rules.keep(e),this}remove(e){return this.rules.remove(e),this}escape(e){return T.reduce((e,t)=>e.replace(t[0],t[1]),e)}process(e){var t=this;return _.call(e.childNodes,(e,o)=>{var r="";return 3===(o=((e,t)=>(e.isBlock=n(e),e.isCode="CODE"===e.nodeName||e.parentNode.isCode,e.isBlank=S(e),e.flankingWhitespace=E(e,t),e))(o,t.options)).nodeType?r=o.isCode?o.nodeValue:t.escape(o.nodeValue):1===o.nodeType&&(r=t.replacementForNode(o)),x(e,r)},"")}postProcess(e){var t=this;return this.rules.forEach(n=>{"function"==typeof n.append&&(e=x(e,n.append(t.options)))}),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}replacementForNode(e){var t=this.rules.forNode(e),n=this.process(e),o=e.flankingWhitespace;return(o.leading||o.trailing)&&(n=n.trim()),o.leading+t.replacement(n,e,this.options)+o.trailing}}})();(e=>{const t=(e,t)=>rl.i18n(e)||t,n=shortcuts.getMetaKey()+" + ",o=t=>e.createElement(t),r=o("template"),i=e=>e.trim().replace(/^(<div>\s*<br\s*\/?>\s*<\/div>)+/,"").trim(),s=e=>rl.Utils.htmlToPlain(e).trim(),a=e=>rl.Utils.plainToHtml(e),l=(e,t)=>Object.values(e).forEach(t),c={sanitizeToDOMFragment:(e,t)=>(e=(e||"").replace(/<\/?(BODY|HTML)[^>]*>/gi,"").replace(/<!--[^>]+-->/g,"").replace(/<span[^>]*>\s*<\/span>/gi,"").trim(),r.innerHTML=t?rl.Utils.cleanHtml(e).html:e,r.content)};this.SquireUI=class SquireUI{constructor(r){const i=o("input"),s=e=>t=>{i.style.left=t.offsetLeft+t.parentNode.offsetLeft+"px",i.style.width=t.offsetWidth+"px",i.value="",i.onchange=()=>g.setStyle({[e]:i.value}),setTimeout(()=>i.click(),1)},a={mode:{plain:{select:[[t("SETTINGS_GENERAL/EDITOR_HTML"),"wysiwyg"],[t("SETTINGS_GENERAL/EDITOR_PLAIN"),"plain"]],cmd:e=>this.setMode("plain"==e.value?"plain":"wysiwyg")}},font:{fontFamily:{select:{"sans-serif":{Arial:"'Nimbus Sans L', 'Liberation sans', 'Arial Unicode MS', Arial, Helvetica, Garuda, Utkal, FreeSans, sans-serif",Tahoma:"'Luxi Sans', Tahoma, Loma, Geneva, Meera, sans-serif",Trebuchet:"'DejaVu Sans Condensed', Trebuchet, 'Trebuchet MS', sans-serif",Lucida:"'Lucida Sans Unicode', 'Lucida Sans', 'DejaVu Sans', 'Bitstream Vera Sans', 'DejaVu LGC Sans', sans-serif",Verdana:"'DejaVu Sans', Verdana, Geneva, 'Bitstream Vera Sans', 'DejaVu LGC Sans', sans-serif"},monospace:{Courier:"'Liberation Mono', 'Courier New', FreeMono, Courier, monospace",Lucida:"'DejaVu Sans Mono', 'DejaVu LGC Sans Mono', 'Bitstream Vera Sans Mono', 'Lucida Console', Monaco, monospace"},sans:{Times:"'Nimbus Roman No9 L', 'Times New Roman', Times, FreeSerif, serif",Palatino:"'Bitstream Charter', 'Palatino Linotype', Palatino, Palladio, 'URW Palladio L', 'Book Antiqua', Times, serif",Georgia:"'URW Palladio L', Georgia, Times, serif"}},cmd:e=>g.setStyle({fontFamily:e.value})},fontSize:{select:[["Размер шрифта",""],"11px","13px","16px","20px","24px","30px"],defaultValueIndex:0,cmd:e=>g.setStyle({fontSize:e.value})}},dir:{dir_ltr:{html:"⁋",cmd:()=>g.setTextDirection("ltr")},dir_rtl:{html:"¶",cmd:()=>g.setTextDirection("rtl")}},colors:{textColor:{html:"A<sub>▾</sub>",cmd:s("color")},backgroundColor:{html:"🎨",cmd:s("backgroundColor")}},inline:{bold:{html:"B",cmd:()=>this.doAction("bold"),key:"B",matches:"B,STRONG"},italic:{html:"I",cmd:()=>this.doAction("italic"),key:"I",matches:"I"},underline:{html:"<u>U</u>",cmd:()=>this.doAction("underline"),key:"U",matches:"U"},strike:{html:"<s>S</s>",cmd:()=>this.doAction("strikethrough"),key:"Shift + 7",matches:"S"},sub:{html:"Xₙ",cmd:()=>this.doAction("subscript"),key:"Shift + 5",matches:"SUB"},sup:{html:"Xⁿ",cmd:()=>this.doAction("superscript"),key:"Shift + 6",matches:"SUP"}},block:{ol:{html:"#",cmd:()=>this.doList("OL"),key:"Shift + 8",matches:"OL"},ul:{html:"⋮",cmd:()=>this.doList("UL"),key:"Shift + 9",matches:"UL"},quote:{html:'"',cmd:()=>{let e=g.getSelectionClosest("UL,OL,BLOCKQUOTE")?.nodeName;"BLOCKQUOTE"==e?g.decreaseQuoteLevel():g.increaseQuoteLevel()},matches:"BLOCKQUOTE"},indentDecrease:{html:"⇤",cmd:()=>g.changeIndentationLevel("decrease"),key:"]"},indentIncrease:{html:"⇥",cmd:()=>g.changeIndentationLevel("increase"),key:"["}},targets:{link:{html:"🔗",cmd:()=>{let e=g.getSelectionClosest("A"),t=prompt("Link",e?.href||"https://");null!=t&&(t.length?g.makeLink(t):e&&g.removeLink())},matches:"A"},imageUrl:{html:"🖼️",cmd:()=>{let e=g.getSelectionClosest("IMG"),t=prompt("Image",e?.src||"https://");t?.length?g.insertImage(t):e?.remove()},matches:"IMG"},imageUpload:{html:"📂️",cmd:()=>p.click(),matches:"IMG"}},changes:{undo:{html:"↶",cmd:()=>g.undo(),key:"Z"},redo:{html:"↷",cmd:()=>g.redo(),key:"Y"},source:{html:"👁",cmd:e=>{this.setMode("source"==this.mode?"wysiwyg":"source"),e.classList.toggle("active","source"==this.mode)}}},clear:{removeStyle:{html:"⎚",cmd:()=>g.setStyle()}}},h=o("textarea"),u=o("div"),f=o("div"),p=o("input"),g=new Squire(u,c);i.type="color",f.append(i);let m,v,y="squire-colors",S=e.getElementById(y),E=e=>S.append(new Option(e));for(m in S||(S=o("datalist"),S.id=y,E("#4E79A7"),E("#F28E2B"),E("#E15759"),E("#76B7B2"),E("#59A14F"),E("#EDC948"),E("#B07AA1"),E("#FF9DA7"),E("#9C755F"),E("#BAB0AC"),e.body.append(S)),i.setAttribute("list",y),p.type="file",p.accept="image/*",p.style.display="none",p.onchange=()=>{if(p.files.length){let e=new FileReader;e.readAsDataURL(p.files[0]),e.onloadend=()=>e.result&&g.insertImage(e.result)}},h.className="squire-plain",u.className="squire-wysiwyg",u.dir="auto",this.mode="",this.container=r,this.squire=g,this.plain=h,this.wysiwyg=u,dispatchEvent(new CustomEvent("squire-toolbar",{detail:{squire:this,actions:a}})),f.className="squire-toolbar btn-toolbar",a){let e=o("div");for(v in e.className="btn-group",e.id="squire-toolgroup-"+m,a[m]){let r,i=a[m][v],s="click";i.input?(r=o("input"),r.type=i.input,s="change"):i.select?(r=o("select"),r.className="btn",Array.isArray(i.select)?i.select.forEach(e=>{e=Array.isArray(e)?e:[e,e];var t=new Option(e[0],e[1]);t.style[v]=e[1],r.append(t)}):("font"==m?r.add(new Option("Шрифт","")):r.add(new Option(t("GLOBAL/DEFAULT"),"")),Object.entries(i.select).forEach(([e,t])=>{let n=o("optgroup");n.label=e,Object.entries(t).forEach(([e,t])=>{var o=new Option(e,t);o.style[v]=t,n.append(o)}),r.add(n)})),s="input"):(r=o("button"),r.type="button",r.className="btn",r.innerHTML=i.html,r.action_cmd=i.cmd),r.addEventListener(s,()=>i.cmd(r)),i.hint=t("EDITOR/"+v.toUpperCase()),i.hint?r.title=i.key?i.hint+" ("+n+i.key+")":i.hint:i.key&&(r.title=n+i.key),r.dataset.action=v,r.tabIndex=-1,i.input=r,e.append(r)}e.children.length&&f.append(e)}this.modeSelect=a.mode.plain.input;let C=a.changes;C.undo.input.disabled=C.redo.input.disabled=!0,g.addEventListener("undoStateChange",e=>{C.undo.input.disabled=!e.detail.canUndo,C.redo.input.disabled=!e.detail.canRedo}),g.addEventListener("pasteImage",e=>{const t=e.detail.clipboardData.items;let n=t.length;for(;n--;){const e=t[n];if(/^image\/(png|jpeg|webp)/.test(e.type)){let t=new FileReader;t.onload=e=>{let t=o("img"),n=o("canvas"),r=n.getContext("2d");t.onload=()=>{r.drawImage(t,0,0);let e=t.width,o=t.height;e>o?e>1024&&(o=1024*o/e,e=1024):o>1024&&(e=1024*e/o,o=1024),n.width=e,n.height=o,r.drawImage(t,0,0,e,o),g.insertHTML('<img alt="" style="width:100%;max-width:'+e+'px" src="'+n.toDataURL()+'">',!0)},t.src=e.target.result},t.readAsDataURL(e.getAsFile());break}}}),a.font.fontSize.input.selectedIndex=a.font.fontSize.defaultValueIndex,r.append(f,u,h);const N=e=>e.trim().replace(/(^["']*|["']*$)/g,"").trim().toLowerCase(),_=Object.values(a.font.fontFamily.input.options).map(e=>e.value.toLowerCase());let T=0;const x=getComputedStyle(g.getRoot()).fontFamily.split(",").map(N);_.some((e,t)=>{const n=e.split(",").some(e=>{const t=N(e);return x.some(e=>e===t)});return n&&(T=t),n});const L={},A=(e,t)=>{e.split(",").forEach(e=>{const n=N(e);void 0===L[n]&&(L[n]=t)})};A(_[T],T),_.forEach((e,t)=>{t!==T&&A(e,t)}),g.addEventListener("pathChange",()=>{const e=g.getRoot();let t=g.getSelection(),n=t.collapsed,o=n?t.endContainer:t?.commonAncestorContainer;if(!o||o instanceof Element||(o=o.parentElement),l(a,r=>{l(r,r=>{r.matches&&r.input.classList.toggle("active",!(!o||!(!n&&[...o.querySelectorAll(r.matches)].some(e=>t.intersectsNode(e))||o.closestWithin(r.matches,e))))})}),o){let t=a.font.fontSize.defaultValueIndex,n=T,r=!1,i=!1;do{if(!r&&o.style.fontFamily){r=!0,n=-1;const e=o.style.fontFamily.split(",");for(let t=0;t<e.length;t++){const o=L[N(e[t])];if(void 0!==o){n=o;break}}}!i&&o.style.fontSize&&(i=!0,t=a.font.fontSize.select.indexOf(o.style.fontSize)),o=o.parentElement}while((!r||!i)&&o&&o!==e);a.font.fontFamily.input.selectedIndex=n,a.font.fontSize.input.selectedIndex=t}})}doAction(e){this.squire[e](),this.squire.focus()}doList(e){let t=this.squire.getSelectionClosest("UL,OL")?.nodeName;t==e?this.squire.removeList():this.squire[{UL:"makeUnorderedList",OL:"makeOrderedList"}[e]]()}setMode(e){if(this.mode!=e){let t=this.container.classList,n="source"==this.mode;t.remove("squire-mode-"+this.mode),"plain"==e?this.plain.value=s(n?this.plain.value:this.squire.getHTML()):"source"==e?this.plain.value=this.squire.getHTML():(this.setData(n?this.plain.value:a(this.plain.value)),e="wysiwyg"),this.mode=e,t.add("squire-mode-"+e),this.onModeChange?.(),setTimeout(()=>this.focus(),1)}this.modeSelect.selectedIndex="plain"==this.mode?1:0}on(e,t){"mode"==e?this.onModeChange=t:(this.squire.addEventListener(e,t),this.plain.addEventListener(e,t))}execCommand(e,t){if("insertSignature"==e)if((t=Object.assign({clearCache:!1,isHtml:!1,insertBefore:!1,signature:""},t)).clearCache)this._prev_txt_sig=null;else try{const e=t.isHtml?s(t.signature):t.signature;if("plain"===this.mode){let n=this.plain.value,o=this._prev_txt_sig;o&&(n=n.replace(o,"").trim()),this.plain.value=t.insertBefore?"\n\n"+e+"\n\n"+n:n+"\n\n"+e}else{const e=this.squire.getRoot(),n=o("br"),r=o("div");r.className="rl-signature",r.innerHTML=t.isHtml?t.signature:a(t.signature),e.querySelectorAll("div.rl-signature").forEach(e=>e.remove()),t.insertBefore?e.prepend(r):e.append(r),r.before(n),r.before(n.cloneNode())}this._prev_txt_sig=e}catch(e){console.error(e)}}getData(){return"source"==this.mode?this.plain.value:i(this.squire.getHTML())}setData(e){const t=this.squire;t.setHTML(i(e));const n=t.getRoot(),o=t.getSelection();o.setStart(n,0),o.setEnd(n,0),t.setSelection(o)}getPlainData(){return this.plain.value}setPlainData(e){this.plain.value=e}blur(){this.squire.blur()}focus(){"plain"==this.mode?(this.plain.focus(),this.plain.setSelectionRange(0,0)):this.squire.focus()}}})(document);
