(e=>{Array.prototype.unique=function(){return this.filter((e,t,n)=>n.indexOf(e)===t)},Array.prototype.validUnique=function(e){return this.filter((t,n,o)=>(e?e(t):t)&&o.indexOf(t)===n)};let t={LT:{hour:"numeric",minute:"numeric"},LLL:{dateStyle:"long",timeStyle:"short"}};Date.prototype.format=function(n,o,i){"string"==typeof n&&(t[n]?n=t[n]:(console.log("Date.format("+n+")"),n={})),i&&(n.hourCycle=i);let r=e.documentElement;return this.toLocaleString(r.dataset.dateLang||r.lang,n)},Element.prototype.closestWithin=function(e,t){const n=this.closest(e);return n&&n!==t&&t.contains(n)?n:null},Element.fromHTML=t=>{const n=e.createElement("template");return n.innerHTML=t.trim(),n.content.firstChild},RegExp.escape||(RegExp.escape=e=>String(e).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")),Function.prototype.debounce||(Function.prototype.debounce=function(e){let t,n=this;return function(...o){t&&clearTimeout(t),t=setTimeout(()=>{n.apply(this,o),t=0},e)}}),Function.prototype.throttle||(Function.prototype.throttle=function(e){let t,n=this;return function(...o){t=t||setTimeout(()=>{n.apply(this,o),t=0},e)}})})(document),(e=>{let t=navigator.userAgent.toLowerCase();if(t.includes("mobile")&&t.includes("gecko/")){let t,n,o,i,r,s,a,l,c={passive:!1,capture:!1},h="move",u="all",f={};class DataTransfer{get dropEffect(){return h}set dropEffect(e){h=e}get effectAllowed(){return u}set effectAllowed(e){u=e}get files(){return[]}get items(){return[]}get types(){return Object.keys(f)}clearData(e){null!=e?delete f[e]:f={}}getData(e){return f[e]||""}setData(e,t){f[e]=t}constructor(){this.setDragImage=g}}const p=t=>e.documentElement.classList.toggle("firefox-drag",t),g=(e,t,n)=>{l?.remove(),e&&(l=e.cloneNode(!0),k(e,l),l._x=t??e.clientWidth/2,l._y=n??e.clientHeight/2)},m=()=>{n&&(clearInterval(a),l?.remove(),o&&E(s,"dragend",n),l=n=s=r=t=a=null,o=i=!1,p(!1))},v=e=>({x:(e=e.touches?e.touches[0]:e).clientX,y:e.clientY}),C=e=>{n&&(i&&"touchcancel"!==e.type&&E(s,"drop",r),m())},y=t=>{let n=e.elementFromPoint(t.x,t.y);for(;n&&"none"==getComputedStyle(n).pointerEvents;)n=n.parentElement;return n},S=e=>{requestAnimationFrame(()=>{l&&(l.style.left=Math.round(e.x-l._x)+"px",l.style.top=Math.round(e.y-l._y)+"px")})},k=(e,t)=>{if(["id","class","style","draggable"].forEach(e=>t.removeAttribute(e)),e instanceof HTMLCanvasElement){let n=e,o=t;o.width=n.width,o.height=n.height,o.getContext("2d").drawImage(n,0,0)}let n=getComputedStyle(e);Object.entries(n).forEach(([e,n])=>e.includes("transition")||(t.style[e]=n)),t.style.pointerEvents="none";let o=e.children.length;for(;o--;)k(e.children[o],t.children[o])},E=(e,o,i)=>{if(e&&i){let r=new Event(o,{bubbles:!0,cancelable:!0});r.button=0,r.buttons=1,["altKey","ctrlKey","metaKey","shiftKey"].forEach(t=>r[t]=e[t]);let s=e.touches?e.touches[0]:e;return["pageX","pageY","clientX","clientY","screenX","screenY","offsetX","offsetY"].forEach(e=>r[e]=s[e]),n&&(r.dataTransfer=t),i.dispatchEvent(r)}return!1};e.addEventListener("touchstart",i=>{m(),i&&!i.defaultPrevented&&i.touches&&i.touches.length<2&&(n=i.target.closest("[draggable]"),n&&(s=i,a=setTimeout(()=>{if(t=new DataTransfer,o=E(i,"dragstart",n)){p(!0);let t=v(i);l||g(n);let o=l.style;o.top=o.left="-9999px",o.position="fixed",o.pointerEvents="none",o.zIndex="999999999",S(t),e.body.append(l),E(i,"dragenter",y(t))}else m()},1e3)))},c),e.addEventListener("touchmove",e=>{if(o){let t=v(e),n=y(t);s=e,n!=r&&(E(e,"dragleave",r),E(e,"dragenter",n),r=n),S(t),i=!E(e,"dragover",n)}else m()},c),e.addEventListener("touchend",C),e.addEventListener("touchcancel",C)}})(document),(e=>{let t={},n="all";const o=document,i=/Mac OS X/.test(navigator.userAgent)?"meta":"ctrl",r={all:{}},s=e=>Array.isArray(e)?e:e.split(/\s*,\s*/),a=(e,t)=>{try{e.defaultPrevented||!1!==t(e)||(e.preventDefault(),e.stopPropagation())}catch(e){console.error(e)}},l={on:()=>o.addEventListener("keydown",c),off:()=>o.removeEventListener("keydown",c),add:(e,t,n,o)=>{null==o&&(o=n,n="all"),s(n).forEach(n=>{r[n]||(r[n]={}),s(e).forEach(e=>{e=e.toLowerCase(),r[n][e]||(r[n][e]={}),t=s(t).map(e=>"meta"==e?i:e).unique().sort().join("+"),r[n][e][t]||(r[n][e][t]=[]),r[n][e][t].push(o)})})},setScope:e=>{n=e||"all",t=r[n]||{},console.log("Shortcuts scope set to: "+n)},getScope:()=>n,getMetaKey:()=>"meta"===i?"⌘":"Ctrl"},c=e=>{let o=(e.key||"").toLowerCase().replace(" ","space"),i=["alt","ctrl","meta","shift"].filter(t=>e[t+"Key"]).join("+");t[o]?.[i]?.forEach(t=>a(e,t)),!e.defaultPrevented&&"all"!==n&&r.all[o]?.[i]?.forEach(t=>a(e,t))};e.shortcuts=l,l.on()})(this),(e=>{const t=/#(.*)$/,n=/^[#/]+/,o=/^\/+/g,i=e=>e?.replace(o,"")||"",r=()=>{var e=t.exec(location.href);return e?.[1]?decodeURIComponent(e[1]):""},s=e=>{if(h!==e){var t=h;h=e,l(i(e),i(t))}},a=(e,t)=>{(e=e?"/"+e.replace(n,""):e)!==h&&(s(e),e===h&&(e="#"+encodeURI(e),t?location.replace(e):location.hash=e))},l=(...e)=>c.active&&u.forEach(t=>t(...e)),c={clear:()=>{u=[],c.active=!0},active:!0,add:e=>u.push(e),init:()=>l(i(h)),setHash:e=>a(e),replaceHash:e=>a(e,!0)};var h=r(),u=[];addEventListener("hashchange",()=>s(r())),e.hasher=c})(this),(()=>{const e=e=>"function"==typeof e;this.Crossroads=class Crossroads{constructor(){this._routes=[]}addRoute(e,t){var n=new Route(e,t,this);return this._routes.push(n),n}parse(e){e=e||"";for(var t,n=0,o=this._routes,i=o.length;i--;)t=o[i],n&&!t.greedy||!t.match(e)||(t.callback?.(...t._getParamsArray(e)),++n)}};class Route{constructor(t,n,o){var i=t instanceof RegExp;Object.assign(this,{greedy:!1,rules:{},_router:o,_pattern:t,_paramsIds:i?null:v(a,t),_optionalParamsIds:i?null:v(s,t),_matchRegexp:i?t:y(t),callback:e(n)?n:null})}match(t){var n=this._getParamsObject(t);return this._matchRegexp.test(t)&&0==Object.entries(this.rules).filter(([o,i])=>{var r=n[o],s=!1;return"normalize_"===o||null==r&&this._optionalParamsIds?.includes(o)?s=!0:i instanceof RegExp?s=i.test(r):Array.isArray(i)?s=i.includes(r):e(i)&&(s=i(r,t,n)),!s}).length}_getParamsObject(e){var t=C(e,this._matchRegexp)||[],n=t.length;if(this._paramsIds)for(;n--;)t[this._paramsIds[n]]=t[n];return t}_getParamsArray(t){var n=this.rules.normalize_;return e(n)?n(t,this._getParamsObject(t)):C(t,this._matchRegexp)}}const t=/[\\.+*?^$[\](){}/'#]/g,n=/\/$/g,o=/([:}]|\w(?=\/))\/?(:)/g,i=/([:}])\/?(\{)/g,r=/\{([^}]+)\}/g,s=/:([^:]+):/g,a=/(?:\{|:)([^}:]+)(?:\}|:)/g,l="__CR_RP__",c="__CR_OP__",h="__CR_RS__",u="__CR_OS__",f=new RegExp(l,"g"),p=new RegExp(c,"g"),g=new RegExp(u,"g"),m=new RegExp(h,"g"),v=(e,t)=>{for(var n,o=[];n=e.exec(t);)o.push(n[1]);return o},C=(e,t)=>{var n=t.exec(e);return n?.shift(),n},y=e=>new RegExp("^"+(e?e.replace(n,"").replace(o,"$1"+u+"$2").replace(i,"$1"+h+"$2").replace(s,c).replace(r,l).replace(t,"\\$&").replace(g,"\\/?").replace(m,"\\/").replace(p,"([^\\/]+)?/?").replace(f,"([^\\/]+)"):"")+"/?$")})(),(e=>{const t=e=>void 0!==e,n=(e,t,n)=>{if(e?.length){let i,r=0,s=!1;[...e].forEach(e=>{e&&(n&&n<++r?s||(s=!0):(i=o(e),i&&t(i)))})}},o=e=>e.size?{fileName:(e.name||"").replace(/^.*\/([^/]*)$/,"$1"),size:e.size,file:e}:null,i=e=>e.dataTransfer.types.includes("Files");class Queue extends Array{push(e,...t){super.push([e,t]),this.call()}call(){if(!this.running){let e;for(this.running=!0;e=this.shift();)e[0](...e[1]);this.running=!1}}}class Jua{constructor(t){let o,r=t.clickElement;const s=this,a=()=>{o&&clearTimeout(o),o=0};var l,c;s.oEvents={onSelect:null,onStart:null,onComplete:null,onProgress:null,onDragEnter:null,onDragLeave:null,onBodyDragEnter:null,onBodyDragLeave:null},s.oXhrs={},s.oUids={},s.options=Object.assign({action:"",name:"uploader",limit:0},t||{}),s.oQueue=new Queue,r&&(r.style.position="relative",r.style.overflow="hidden","inline"===r.style.display&&(r.style.display="inline-block"),s.generateNewInput(r)),r=t.dragAndDropElement,r&&(l=e,c={dragover:e=>{i(e)&&(a(),r.contains(e.target)?(e.dataTransfer.dropEffect="copy",e.stopPropagation()):e.dataTransfer.dropEffect="none",e.preventDefault())},dragenter:e=>{i(e)&&(a(),e.preventDefault(),s.runEvent("onBodyDragEnter",e),r.contains(e.target)&&(a(),s.runEvent("onDragEnter",r,e)))},dragleave:t=>{if(i(t)){let i=e.elementFromPoint(t.clientX,t.clientY);i&&r.contains(i)||s.runEvent("onDragLeave",r,t),n=()=>s.runEvent("onBodyDragLeave",t),a(),o=setTimeout(n,200)}var n},drop:e=>{i(e)&&(a(),e.preventDefault(),r.contains(e.target)&&n(e.files||e.dataTransfer.files,e=>{e&&s.addFile(e)},s.options.limit)),s.runEvent("onDragLeave",e),s.runEvent("onBodyDragLeave",e)}},Object.entries(c).forEach(([e,t])=>l.addEventListener(e,t)))}on(e,t){return this.oEvents[e]=t,this}runEvent(e,...t){this.oEvents[e]?.apply(null,t)}getEvent(e){return this.oEvents[e]||null}addFile(e){const t="jua-uid-"+Jua.randomId(16)+"-"+Date.now().toString(),n=this.getEvent("onSelect");!e||n&&!1===n(t,e)?this.cancel(t):(this.oUids[t]=!0,this.oQueue.push((...e)=>this.uploadTask(...e),t,e))}uploadTask(e,n){if(!1===this.oUids[e]||!n||!n.file)return!1;try{const o=this,i=new XMLHttpRequest,r=new FormData,s=this.options.action,a=this.getEvent("onStart"),l=this.getEvent("onProgress");return i.open("POST",s,!0),l&&i.upload&&(i.upload.onprogress=n=>{n&&n.lengthComputable&&t(n.loaded)&&t(n.total)&&l(e,n.loaded,n.total)}),i.onreadystatechange=()=>{if(4===i.readyState){delete o.oXhrs[e];let t=!1,n=null;if(200===i.status)try{n=JSON.parse(i.responseText),t=!0}catch(e){console.error(e)}this.getEvent("onComplete")(e,t,n)}},a&&a(e),r.append(this.options.name,n.file),i.send(r),this.oXhrs[e]=i,!0}catch(e){console.error(e)}return!1}generateNewInput(t){if(t){const o=this,i=o.options.limit,r=e.createElement("input"),s=()=>r.click();r.type="file",r.tabIndex=-1,r.style.display="none",r.multiple=1!=i,t.addEventListener("click",s),r.addEventListener("input",()=>{const e=e=>{o.addFile(e),setTimeout(()=>{r.remove(),t.removeEventListener("click",s),o.generateNewInput(t)},10)};r.files?.length?n(r.files,e,i):e({fileName:r.value.split(/\\\//).pop(),size:null,file:null})})}}cancel(e){if(this.oUids[e]=!1,this.oXhrs[e]){try{this.oXhrs[e].abort&&this.oXhrs[e].abort()}catch(e){console.error(e)}delete this.oXhrs[e]}}}Jua.randomId=e=>{let t=new Uint8Array((e||32)/2);return crypto.getRandomValues(t),t.map(e=>e.toString(16).padStart(2,"0")).join("")},this.Jua=Jua})(document),(e=>{const t=e=>e.focus?e.focus():e.setActive(),n=e=>"ArrowUp"===e.key||"ArrowDown"===e.key;this.BSN={Dropdown:function(o){let i,r=[];const s=this,a=o.parentNode,l=e=>{const t=e.target;"#"===(t.href||t.parentNode?.href)?.slice(-1)&&e.preventDefault()},c=e=>{i?.classList.toggle("show",e),a.classList.toggle("show",e),o.setAttribute("aria-expanded",e),o.open=e,e?o.removeEventListener("click",f):setTimeout(()=>o.addEventListener("click",f),1)},h=()=>{const t=(o.open?"add":"remove")+"EventListener";e[t]("click",u),e[t]("keydown",p),e[t]("keyup",g),e[t]("focus",u)},u=e=>{const t=e.target;(i.contains(t)||o.contains(t))&&"focus"===e.type||(s.hide(),l(e))},f=e=>{s.show(),l(e)},p=e=>n(e)&&e.preventDefault(),g=i=>{if("Escape"===i.key)s.toggle();else if(n(i)){let n=e.activeElement,s=n===o,l=s?0:r.indexOf(n);a.contains(n)?(s||(l="ArrowUp"===i.key?l>1?l-1:0:l<r.length-1?l+1:l),r[l]&&t(r[l])):console.log("activeElement not in menu")}};s.show=()=>{i=a.querySelector(".dropdown-menu"),r=[...i.querySelectorAll("A")].filter(e=>"none"!=e.parentNode.style.display),!("tabindex"in i)&&i.setAttribute("tabindex","0"),c(!0),setTimeout(()=>{t(i.getElementsByTagName("INPUT")[0]||o),h()},1)},s.hide=()=>{c(!1),h(),t(o)},s.toggle=()=>o.open?s.hide():s.show(),c(!1),o.Dropdown=s}}})(document),(e=>{function t(e,t){return e===t&&e!==Object(e)}function n(e,t){t?.dispose?.()}function o(e,t){var n=this.Mb,o=n[u];o.X||(this.Na&&this.wa[t]?(n.lb(t,e,this.wa[t]),this.wa[t]=null,--this.Na):o.v[t]||n.lb(t,e,o.A?{S:e}:n.Db(e)),e.ea&&e.Hb())}var i=e.document;const r={W:(e,t)=>{e=e.split(".");for(var n=r,o=0,i=e.length-1;o<i;o++)n=n[e[o]];n[e[i]]=t},g:{extend:(e,t)=>t?Object.assign(e,t):e,K:(e,t)=>e&&Object.entries(e).forEach(e=>t(e[0],e[1])),Ra:e=>[...e.childNodes].forEach(e=>r.removeNode(e)),Xb:e=>{e=[...e];var t=(e[0]?.ownerDocument||i).createElement("div");return e.forEach(e=>t.append(r.ia(e))),t},va:(e,t)=>Array.prototype.map.call(e,t?e=>r.ia(e.cloneNode(!0)):e=>e.cloneNode(!0)),qa:(e,t)=>{r.g.Ra(e),t&&e.append(...t)},ya:(e,t)=>{if(e.length){for(t=8===t.nodeType&&t.parentNode||t;e.length&&e[0].parentNode!==t;)e.splice(0,1);for(;1<e.length&&e[e.length-1].parentNode!==t;)--e.length;if(1<e.length){t=e[0];var n=e[e.length-1];for(e.length=0;t!==n;)e.push(t),t=t.nextSibling;e.push(n)}}return e},Cb:e=>null==e?"":e.trim?e.trim():e.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,""),Qa:e=>e.ownerDocument.documentElement.contains(1!==e.nodeType?e.parentNode:e),Eb:(e,t)=>{if(!e?.nodeType)throw Error("element must be a DOM node when calling triggerEvent");e.dispatchEvent(new Event(t))},h:e=>r.V(e)?e():e,$a:(e,t)=>e.textContent=r.g.h(t)}};r.W("unwrap",r.g.h),(()=>{let e=0,t="__ko__"+Date.now(),n=new WeakMap;r.g.l={get:(e,t)=>(n.get(e)||{})[t],set:(e,t,o)=>(n.has(e)?n.get(e)[t]=o:n.set(e,{[t]:o}),o),Sa(e,t,n){return this.get(e,t)||this.set(e,t,n)},clear:e=>n.delete(e),Z:()=>e+++t}})(),r.g.N=(()=>{var e=r.g.l.Z(),t={1:1,8:1,9:1},n={1:1,9:1};const o=(t,n)=>{var o=r.g.l.get(t,e);return n&&!o&&(o=new Set,r.g.l.set(t,e,o)),o},i=e=>{var t=o(e);t&&new Set(t).forEach(t=>t(e)),r.g.l.clear(e),n[e.nodeType]&&s(e.childNodes,!0)},s=(e,t)=>{for(var n,o=[],r=0;r<e.length;r++)if((!t||8===e[r].nodeType)&&(i(o[o.length]=n=e[r]),e[r]!==n))for(;r--&&!o.includes(e[r]););};return{ha:(e,t)=>{if("function"!=typeof t)throw Error("Callback must be a function");o(e,1).add(t)},Za:(t,n)=>{var i=o(t);i&&(i.delete(n),i.size||r.g.l.set(t,e,null))},ia:e=>(r.u.I(()=>{t[e.nodeType]&&(i(e),n[e.nodeType]&&s(e.getElementsByTagName("*")))}),e),removeNode:e=>{r.ia(e),e.parentNode&&e.parentNode.removeChild(e)}}})(),r.ia=r.g.N.ia,r.removeNode=r.g.N.removeNode,r.W("addDisposeCallback",r.g.N.ha),r.extenders={debounce:(e,t)=>e.Ea(e=>function(e,t){var n;return()=>{clearTimeout(n),n=setTimeout(e,t)}}(e,t)),rateLimit:(e,t)=>e.Ea(e=>function(e,t){var n;return()=>{n||(n=setTimeout(()=>{n=0,e()},t))}}(e,t)),notify:(e,n)=>{e.la="always"==n?null:t}};class fa{constructor(e,t,n){this.S=e,this.fb=t,this.Aa=n,this.Ia=!1,this.H=this.da=null}dispose(){this.Ia||(this.H&&r.g.N.Za(this.da,this.H),this.Ia=!0,this.Aa(),this.S=this.fb=this.Aa=this.da=this.H=null)}o(e){this.da=e,r.g.N.ha(e,this.H=this.dispose.bind(this))}}r.P=function(){Object.setPrototypeOf(this,s),s.init(this)};var s={init:e=>{e.R=new Map,e.R.set("change",new Set),e.kb=1},subscribe:function(e,t,n){var o=this;n=n||"change";var i=new fa(o,t?e.bind(t):e,()=>{o.R.get(n).delete(i),o.Ja?.(n)});return o.Ka?.(n),o.R.has(n)||o.R.set(n,new Set),o.R.get(n).add(i),i},B(e,t){if("change"===(t=t||"change")&&this.Fa(),this.oa(t)){t="change"===t&&this.Fb||new Set(this.R.get(t));try{r.u.ob(),t.forEach(t=>{t.Ia||t.fb(e)})}finally{r.u.end()}}},za(){return this.kb},Sb(e){return this.za()!==e},Fa(){++this.kb},Ea(e){var t,n,o,i,s,a=this,l=r.V(a);a.sa||(a.sa=a.B,a.B=(e,t)=>{t&&"change"!==t?"beforeChange"===t?a.hb(e):a.sa(e,t):a.ib(e)});var c=e(()=>{a.ea=!1,l&&i===a&&(i=a.gb?a.gb():a());var e=n||s&&a.Ca(o,i);s=n=t=!1,e&&a.sa(o=i)});a.ib=(e,n)=>{n&&a.ea||(s=!n),a.Fb=new Set(a.R.get("change")),a.ea=t=!0,i=e,c()},a.hb=e=>{t||(o=e,a.sa(e,"beforeChange"))},a.jb=()=>{s=!0},a.Hb=()=>{a.Ca(o,a.L(!0))&&(n=!0)}},oa(e){return(this.R.get(e)||[]).size},Ca(e,t){return!this.la||!this.la(e,t)},toString:()=>"[object Object]",extend:function(e){var t=this;return e&&r.g.K(e,(e,n)=>{"function"==typeof(e=r.extenders[e])&&(t=e(t,n)||t)}),t}};r.P.fn=Object.setPrototypeOf(s,Function.prototype),r.Wb=e=>"function"==typeof e?.subscribe&&"function"==typeof e.B,(()=>{let e,t=[],n=0;r.u={ob:n=>{t.push(e),e=n},end:()=>e=t.pop(),Ab:t=>{if(e){if(!r.Wb(t))throw Error("Only subscribable things can act as dependencies");e.Kb.call(e.Lb,t,t.Gb||(t.Gb=++n))}},I(n,o,i){try{return t.push(e),e=void 0,n.apply(o,i||[])}finally{e=t.pop()}},na:()=>e?.m.na(),Da:()=>e?.Da,m:()=>e?.m}})();const a=Symbol("_latestValue");r.$=e=>{function t(){return 0<arguments.length?(t.Ca(t[a],arguments[0])&&(t.eb(),t[a]=arguments[0],t.valueHasMutated()),this):(r.u.Ab(t),t[a])}return t[a]=e,Object.defineProperty(t,"length",{get:()=>t[a]?.length}),r.P.fn.init(t),Object.setPrototypeOf(t,l)};var l={toJSON:function(){let e=this[a];return e?.toJSON?.()||e},la:t,L(){return this[a]},valueHasMutated:function(){this.B(this[a],"spectate"),this.B(this[a])},eb(){this.B(this[a],"beforeChange")}};Object.setPrototypeOf(l,r.P.fn);var c=r.$.$b="__ko_proto__";l[c]=r.$,r.V=e=>{if((e="function"==typeof e&&e[c])&&e!==l[c]&&e!==r.m.fn[c])throw Error("Invalid object that looks like an observable; possibly from another Knockout instance");return!!e},r.wb=e=>"function"==typeof e&&(e[c]===l[c]||e[c]===r.m.fn[c]&&e.Tb),r.W("observable",r.$),r.W("isObservable",r.V),r.W("observable.fn",l),r.observableArray=e=>{if(e=e||[],!Array.isArray(e))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return Object.setPrototypeOf(r.$(e),r.observableArray.fn).extend({trackArrayChanges:!0})};const h=Symbol("IS_OBSERVABLE_ARRAY");r.observableArray.fn=Object.setPrototypeOf({[h]:1,remove:function(e){for(var t=this.L(),n=!1,o="function"!=typeof e||r.V(e)?t=>t===e:e,i=t.length;i--;){var s=t[i];if(o(s)){if(t[i]!==s)throw Error("Array modified during remove; cannot remove item");n||this.eb(),n=!0,t.splice(i,1)}}n&&this.valueHasMutated()}},r.$.fn),Object.getOwnPropertyNames(Array.prototype).forEach(e=>{"function"==typeof Array.prototype[e]&&"constructor"!=e&&("copyWithin fill pop push reverse shift sort splice unshift".split(" ").includes(e)?r.observableArray.fn[e]=function(...t){var n=this.L();return this.eb(),this.qb(n,e,t),t=n[e](...t),this.valueHasMutated(),t===n?this:t}:r.observableArray.fn[e]=function(...t){return this()[e](...t)})}),r.isObservableArray=e=>!(!e||!e[h]),r.extenders.trackArrayChanges=(e,t)=>{function n(){if(c){var t=[].concat(e.L()||[]);if(e.oa("arrayChange")){(!l||1<c)&&(l=r.g.rb(s,t,e.La));var n=l}s=t,l=null,c=0,n?.length&&e.B(n,"arrayChange")}}if(e.La={},"object"==typeof t&&r.g.extend(e.La,t),e.La.sparse=!0,!e.qb){var o,i,s,a=!1,l=null,c=0,h=e.Ka,u=e.Ja;e.Ka=t=>{h?.call(e,t),"arrayChange"===t&&(a?n():(a=!0,i=e.subscribe(()=>++c,null,"spectate"),s=[].concat(e.L()||[]),l=null,o=e.subscribe(n)))},e.Ja=t=>{u?.call(e,t),"arrayChange"!==t||e.oa("arrayChange")||(o?.dispose(),i?.dispose(),i=o=null,a=!1,s=void 0)},e.qb=(e,t,n)=>{if(a&&!c){var o=[],i=e.length,s=n.length,h=0,u=(e,t,n)=>o[o.length]={status:e,value:t,index:n};switch(t){case"push":h=i;case"unshift":for(e=0;e<s;++e)u("added",n[e],h+e);break;case"pop":h=i-1;case"shift":i&&u("deleted",e[h],h);break;case"splice":h=Math.min(Math.max(0,0>n[0]?i+n[0]:n[0]),i),i=1===s?i:Math.min(h+(n[1]||0),i),s=h+s-2,t=Math.max(i,s);for(var f=[],p=[],g=2;h<t;++h,++g)h<i&&p.push(u("deleted",e[h],h)),h<s&&f.push(u("added",n[g],h));r.g.ub(p,f);break;default:return}l=o}}}};var u=Symbol("_state");r.m=(e,t)=>{function n(){if(0<arguments.length){if("function"!=typeof o)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return o(...arguments),this}return i.X||r.u.Ab(n),(i.U||i.A&&n.pa())&&n.T(),i.J}if("object"==typeof e?t=e:(t=t||{},e&&(t.read=e)),"function"!=typeof t.read)throw Error("Pass a function that returns the value of the ko.computed");var o=t.write,i={J:void 0,Y:!0,U:!0,Ba:!1,bb:!1,X:!1,Ya:!1,A:!1,zb:t.read,o:t.o||null,ja:t.ja,Pa:null,v:{},G:0,cc:null};return n[u]=i,n.Tb="function"==typeof o,r.P.fn.init(n),Object.setPrototypeOf(n,f),t.pure&&(i.Ya=!0,i.A=!0,r.g.extend(n,p)),i.o&&(i.bb=!0,i.o.nodeType||(i.o=null)),i.A||n.T(),i.o&&n.isActive()&&r.g.N.ha(i.o,i.Pa=()=>{n.dispose()}),n};var f={la:t,na(){return this[u].G},Qb(){var e=[];return r.g.K(this[u].v,(t,n)=>e[n.fa]=n.S),e},Ta(e){if(!this[u].G)return!1;var t=this.Qb();return t.includes(e)||!!t.find(t=>t.Ta&&t.Ta(e))},lb(e,t,n){if(this[u].Ya&&t===this)throw Error("A 'pure' computed must not be called recursively");this[u].v[e]=n,n.fa=this[u].G++,n.ga=t.za()},pa(){var e,t=this[u].v;for(e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var n=t[e];if(this.ra&&n.S.ea||n.S.Sb(n.ga))return!0}},ec(){this[u].Ba||this.ra?.(!1)},isActive(){var e=this[u];return e.U||0<e.G},fc(){this.ea?this[u].U&&(this[u].Y=!0):this.tb()},Db(e){return e.subscribe(this.tb,this)},tb(){this.ra?this.ra(!0):this.T(!0)},T(e){var t=this[u],n=t.ja,o=!1;if(!t.Ba&&!t.X){if(t.o&&!r.g.Qa(t.o)||n?.()){if(!t.bb)return void this.dispose()}else t.bb=!1;try{t.Ba=!0,o=this.Ob(e)}finally{t.Ba=!1}return o}},Ob(e){var t=this[u],i=t.Ya?void 0:!t.G,s={Mb:this,wa:t.v,Na:t.G};r.u.ob({Lb:s,Kb:o,m:this,Da:i}),t.v={},t.G=0;e:{try{var a=t.zb();break e}finally{r.u.end(),s.Na&&!t.A&&r.g.K(s.wa,n),t.Y=t.U=!1}a=void 0}return t.G?s=this.Ca(t.J,a):(this.dispose(),s=!0),s&&(t.A?this.Fa():this.B(t.J,"beforeChange"),t.J=a,this.B(t.J,"spectate"),!t.A&&e&&this.B(t.J),this.jb&&this.jb()),i&&this.B(t.J,"awake"),s},L(e){var t=this[u];return(t.U&&(e||!t.G)||t.A&&this.pa())&&this.T(),t.J},Ea(e){var t=this;r.P.fn.Ea.call(t,e),t.gb=()=>(t[u].A||(t[u].Y?t.T():t[u].U=!1),t[u].J),t.ra=e=>{t.hb(t[u].J),t[u].U=!0,e&&(t[u].Y=!0),t.ib(t,!e)}},dispose:function(){var e=this[u];!e.A&&e.v&&r.g.K(e.v,(e,t)=>t.dispose?.()),e.o&&e.Pa&&r.g.N.Za(e.o,e.Pa),e.v=void 0,e.G=0,e.X=!0,e.Y=!1,e.U=!1,e.A=!1,e.o=void 0,e.ja=void 0,e.zb=void 0}},p={Ka(e){var t=this,n=t[u];if(!n.X&&n.A&&"change"==e){if(n.A=!1,n.Y||t.pa())n.v=null,n.G=0,t.T()&&t.Fa();else{var o=[];r.g.K(n.v,(e,t)=>o[t.fa]=e),o.forEach((e,o)=>{var i=n.v[e],r=t.Db(i.S);r.fa=o,r.ga=i.ga,n.v[e]=r}),t.pa()&&t.T()&&t.Fa()}n.X||t.B(n.J,"awake")}},Ja(e){var t=this[u];t.X||"change"!=e||this.oa("change")||(r.g.K(t.v,(e,n)=>{n.dispose&&(t.v[e]={S:n.S,fa:n.fa,ga:n.ga},n.dispose())}),t.A=!0,this.B(void 0,"asleep"))},za(){var e=this[u];return e.A&&(e.Y||this.pa())&&this.T(),r.P.fn.za.call(this)}};Object.setPrototypeOf(f,r.P.fn);var g,m,v,C=r.$.$b;f[C]=r.m,r.m.fn=f,r.W("computed",r.m),r.isComputed=e=>"function"==typeof e&&e[C]===f[C],r.yb=e=>"function"==typeof e?r.m(e,{pure:!0}):(e={...e,pure:!0},r.m(e)),r.C={M:e=>{switch(e.nodeName){case"OPTION":return!0===e.__ko__hasDomDataOptionValue__?r.g.l.get(e,r.i.options.Xa):e.value;case"SELECT":return 0<=e.selectedIndex?r.C.M(e.options[e.selectedIndex]):void 0;default:return e.value}},Ga:(e,t)=>{switch(e.nodeName){case"OPTION":"string"==typeof t?(r.g.l.set(e,r.i.options.Xa,void 0),delete e.__ko__hasDomDataOptionValue__,e.value=t):(r.g.l.set(e,r.i.options.Xa,t),e.__ko__hasDomDataOptionValue__=!0,e.value="number"==typeof t?t:"");break;case"SELECT":for(var n,o=-1,i=""===(t??""),s=e.options.length;s--;)if((n=r.C.M(e.options[s]))==t||""===n&&i){o=s;break}(0<=o||i&&1<e.size)&&(e.selectedIndex=o);break;default:e.value=t??""}}},r.ma=(g=RegExp("\"(?:\\\\.|[^\"])*\"|'(?:\\\\.|[^'])*'|`(?:\\\\.|[^`])*`|/\\*(?:[^*]|\\*+[^*/])*\\*+/|//.*\n|/(?:\\\\.|[^/])+/w*|[^\\s:,/][^,\"'`{}()/:[\\]]*[^\\s,\"'`{}()/:[\\]]|[^\\s]","g"),m=/[\])"'A-Za-z0-9_$]+$/,v={in:1,return:1,typeof:1},{Zb:e=>{123===(e=r.g.Cb(e)).charCodeAt(0)&&(e=e.slice(1,-1));var t=[],n=(e+="\n,").match(g),o=[],i=0;if(1<n.length){for(var s,a=0;s=n[a++];){var l=s.charCodeAt(0);if(44===l){if(0>=i){c&&o.length&&t.push("'"+c+"':()=>("+o.join("")+")");var c=i=0;o=[];continue}}else if(58===l){if(!i&&!c&&1===o.length){c=o.pop();continue}}else{if(47===l&&1<s.length&&(47===s.charCodeAt(1)||42===s.charCodeAt(1)))continue;47===l&&a&&1<s.length?(l=n[a-1].match(m))&&!v[l[0]]&&(n=(e=e.slice(e.indexOf(s)+1)).match(g),a=-1,s="/"):40===l||123===l||91===l?++i:41===l||125===l||93===l?--i:c||o.length||34!==l&&39!==l||(s=s.slice(1,-1))}o.push(s)}if(0<i)throw Error("Unbalanced parentheses, braces, or brackets")}return t.push("'$data':()=>$data"),t.join(",")},dc:(e,t)=>-1<e.findIndex(e=>e.key==t),Ha:(e,t,n,o,i,s)=>{t&&r.V(t)?!r.wb(t)||s&&t.L()===i||t(i):(console.log(`"${o}" should contain observable in ${e.outerHTML.replace(/>.+/,">")}`),n.get("$data")[o]=i)}}),(()=>{function e(e){return 8==e.nodeType&&o.test(e.nodeValue)}function t(e){return 8==e.nodeType&&i.test(e.nodeValue)}function n(n,o){for(var i=n,a=1,l=[];i=i.nextSibling;){if(t(i)&&(r.g.l.set(i,s,!0),! --a))return l;l.push(i),e(i)&&++a}if(!o)throw Error("Cannot find closing comment tag to match: "+n.nodeValue);return null}var o=/^\s*ko(?:\s+([\s\S]+))?\s*$/,i=/^\s*\/ko\s*$/,s="__ko_matchedEndComment__";r.s={aa:{},childNodes:t=>e(t)?n(t):t.childNodes,ka:t=>{e(t)?(t=n(t))&&[...t].forEach(e=>r.removeNode(e)):r.g.Ra(t)},qa:(t,n)=>{e(t)?(r.s.ka(t),t.after(...n)):r.g.qa(t,n)},Vb:(t,n,o)=>{o?o.after(n):e(t)?t.nextSibling.before(n):t.prepend(n)},firstChild:n=>{if(e(n))return!(n=n.nextSibling)||t(n)?null:n;let o=n.firstChild;if(o&&t(o))throw Error("Found invalid end comment, as the first child of "+n);return o},nextSibling:o=>{if(e(o)){var i=n(o,void 0);o=i?(i.length?i[i.length-1]:o).nextSibling:null}if((i=o.nextSibling)&&t(i)){if(t(i)&&!r.g.l.get(i,s))throw Error("Found end comment without a matching opening comment, as child of "+o);return null}return i},Rb:e,bc:e=>(e=e.nodeValue.match(o))?e[1]:null}})();const y=new Map;r.pb=new class{Yb(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind");case 8:return r.s.Rb(e)}return!1}Pb(e,t){if(e=(e=>{switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return r.s.bc(e)}return null})(e))try{let n=y.get(e);return n||(n=new Function("$context","with($context){return{"+r.ma.Zb(e)+"}}"),y.set(e,n)),n(t=new Proxy(t,{has:()=>!0,get:(e,t)=>e[t]||e.$data[t]}))}catch(t){throw t.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+t.message,t}return null}};const S=Symbol("_subscribable"),k=Symbol("_ancestorBindingInfo"),E=Symbol("_dataDependency"),_={},w=r.g.l.Z();r.i={},r.ba=class{constructor(e,t,n,o){var i=this,s=e===_,a=s?void 0:e,l="function"==typeof a&&!r.V(a),c=o?.dataDependency;if(e=()=>{var e=l?a():a;return e=r.g.h(e),t?(r.g.extend(i,t),k in t&&(i[k]=t[k])):i.$root=e,i[S]=h,s?e=i.$data:i.$data=e,n?.(i,t,e),t?.[S]&&!r.u.m().Ta(t[S])&&t[S](),c&&(i[E]=c),i.$data},o?.exportDependencies)e();else{var h=r.yb(e);h.L(),h.isActive()?h.la=null:i[S]=void 0}}createChildContext(e,t){return new r.ba(e,this,(e,n)=>{e.$parent=n.$data,t.extend?.(e)},t)}extend(e,t){return new r.ba(_,this,t=>r.g.extend(t,"function"==typeof e?e(t):e),t)}};const N=e=>{e=r.g.l.get(e,w);var t=e?.D;t&&(e.D=null,t.xb())};class ma{constructor(e,t,n){this.H=e,this.da=t,this.ua=new Set,this.F=!1,t.D||r.g.N.ha(e,N),n?.D&&(n.D.ua.add(e),this.Aa=n)}xb(){this.Aa?.D?.Nb(this.H)}Nb(e){this.ua.delete(e),this.ua.size||this.sb?.()}sb(){this.F=!0,this.da.D&&!this.ua.size&&(this.da.D=null,r.g.N.Za(this.H,N),r.j.notify(this.H,r.j.ca),this.xb())}}r.j={F:"childrenComplete",ca:"descendantsComplete",subscribe:(e,t,n,o,i)=>{var s=r.g.l.Sa(e,w,{});return s.xa||(s.xa=new r.P),i?.notifyImmediately&&s.Wa[t]&&r.u.I(n,o,[e]),s.xa.subscribe(n,o,t)},notify:(e,t)=>{var n=r.g.l.get(e,w);if(n&&(n.Wa[t]=!0,n.xa?.B(e,t),t==r.j.F))if(n.D)n.D.sb();else if(void 0===n.D&&n.xa?.oa(r.j.ca))throw Error("descendantsComplete event not supported for bindings on this node")},ab:(e,t)=>{var n=r.g.l.Sa(e,w,{});return n.D||(n.D=new ma(e,n,t[k])),t[k]==n?t:t.extend(e=>{e[k]=n})}};const x=(e,t)=>{for(var n,o=r.s.firstChild(t);n=o;)o=r.s.nextSibling(n),T(e,n);r.j.notify(t,r.j.F)},T=(e,t)=>{var n=e;(1===t.nodeType||r.pb.Yb(t))&&(n=L(t,null,e)),n&&!t.matches?.("SCRIPT,TEXTAREA,TEMPLATE")&&x(n,t)},L=(e,t,n)=>{var o=r.g.l.Sa(e,w,{}),i=o.Ib;if(!t){if(i)throw Error("You cannot apply bindings multiple times to the same element.");o.Ib=!0}if(i||(o.context=n),o.Wa||(o.Wa={}),t&&"function"!=typeof t)var s=t;else{var a=r.m(()=>((s=t?t(n,e):r.pb.Pb(e,n))&&(n[S]?.(),n[E]?.()),s),{o:e});s&&a.isActive()||(a=null)}var l,c=n;if(s){var h=a?e=>()=>a()[e]():e=>s[e],u={get:e=>s[e]&&h(e)(),has:e=>e in s};r.j.F in s&&r.j.subscribe(e,r.j.F,()=>{var t=s[r.j.F]();if(t){var n=r.s.childNodes(e);n.length&&t(n,r.dataFor(n[0]))}}),r.j.ca in s&&(c=r.j.ab(e,n),r.j.subscribe(e,r.j.ca,()=>{var t=s[r.j.ca]();t&&r.s.firstChild(e)&&t(e)})),(e=>{var t=[],n={},o=[],i=s=>{if(!n[s]){var a=r.i[s];a&&(a.after&&(o.push(s),a.after.forEach(t=>{if(e[t]){if(o.includes(t))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+o.join(", "));i(t)}}),o.length--),t.push({key:s,vb:a})),n[s]=!0}};return r.g.K(e,i),t})(s).forEach(t=>{var n=t.vb.init,o=t.vb.update,i=t.key;if(8===e.nodeType&&!r.s.aa[i])throw Error("The binding '"+i+"' cannot be used with comment nodes");try{"function"==typeof n&&r.u.I(()=>{var t=n(e,h(i),u,c.$data,c);if(t&&t.controlsDescendantBindings){if(void 0!==l)throw Error("Multiple bindings ("+l+" and "+i+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");l=i}}),"function"==typeof o&&r.m(()=>o(e,h(i),u,c.$data,c),{o:e})}catch(e){throw e.message='Unable to process binding "'+i+": "+s[i]+'"\nMessage: '+e.message,e}})}return void 0===l&&c};r.ac=e=>r.g.l.get(e,w)?.context;const A=e=>e&&e instanceof r.ba?e:new r.ba(e);r.applyBindingAccessorsToNode=(e,t,n)=>L(e,t,A(n)),r.nb=(e,t)=>{1!==t.nodeType&&8!==t.nodeType||x(A(e),t)},r.Jb=(e,t)=>T(A(e),t),r.dataFor=e=>([1,8].includes(e?.nodeType)&&r.ac(e))?.$data,r.W("bindingHandlers",r.i),(()=>{var e=Object.create(null),t=new Map;r.components={get:(n,o)=>{if(t.has(n))o(t.get(n));else{var i=e[n];i?i.subscribe(o):((i=e[n]=new r.P).subscribe(o),s(n,o=>{t.set(n,o),delete e[n],i.B(o)}))}},register:(e,t)=>{if(!t)throw Error("Invalid configuration for "+e);if(n[e])throw Error("Component "+e+" is already registered");n[e]=t}};var n=Object.create(null),o=(e,t)=>{throw Error(`Component '${e}': ${t}`)},s=(e,t)=>{var s={},a=n[e]||{},l=a.template;if(a=a.viewModel,l){l.element||o(e,"Unknown template value: "+l),l=l.element;var c=i.getElementById(l);c||o(e,"Cannot find element with ID "+l),c.matches("TEMPLATE")||o(e,"Template Source Element not a <template>"),s.template=r.g.va(c.content.childNodes)}a&&("function"!=typeof a.createViewModel&&o(e,"Unknown viewModel value: "+a),s.createViewModel=a.createViewModel),t(s.template&&s.createViewModel?s:null)}})(),(()=>{var e=0;r.i.component={init:(t,n,o,i,s)=>{var a,l,c=()=>{var e=a&&a.dispose;"function"==typeof e&&e.call(a),l=a=null};return r.s.ka(t),r.g.N.ha(t,c),r.m(()=>{var o=r.g.h(n());if("string"!=typeof o){var i=r.g.h(o.params);o=r.g.h(o.name)}if(!o)throw Error("No component name specified");var h=r.j.ab(t,s),u=l=++e;r.components.get(o,e=>{if(l===u){if(c(),!e)throw Error("Unknown component '"+o+"'");var n=e.template;if(!n)throw Error("Component '"+o+"' has no template");r.s.qa(t,r.g.va(n)),a=e.createViewModel(i,{element:t}),r.nb(h.createChildContext(a,{}),t)}})},{o:t}),{controlsDescendantBindings:!0}}},r.s.aa.component=!0})(),r.i.attr={update:(e,t)=>{t=r.g.h(t())||{},r.g.K(t,function(t,n){n=r.g.h(n);var o=t.indexOf(":");o="lookupNamespaceURI"in e&&0<o&&e.lookupNamespaceURI(t.slice(0,o)),!1===n||null==n?o?e.removeAttributeNS(o,t):e.removeAttribute(t):(n=n.toString(),o?e.setAttributeNS(o,t,n):e.setAttribute(t,n))})}},r.i.checked={after:["value","attr"],init:function(e,t,n){var o="checkbox"==e.type,i="radio"==e.type;if(o||i){const f=r.yb(()=>n.has("checkedValue")?r.g.h(n.get("checkedValue")):h?n.has("value")?r.g.h(n.get("value")):e.value:void 0);var s=()=>{if(!r.u.Da()){var s=e.checked,a=f();if(s||!i&&!r.u.na()){var h=r.u.I(t);if(l){var p=c?h.L():h,g=u;u=a,g!==a?s&&(p.push(a),p.remove(g)):s?p.push(a):p.remove(a),c&&r.wb(h)&&h(p)}else o&&(void 0===a?a=s:s||(a=void 0)),r.ma.Ha(e,h,n,"checked",a,!0)}}},a=t(),l=o&&r.g.h(a)instanceof Array,c=!(l&&a.push&&a.splice),h=i||l,u=l?f():void 0;r.m(s,null,{o:e}),e.addEventListener("click",s),r.m(()=>{var n=r.g.h(t()),i=f();l?(e.checked=n.includes(i),u=i):e.checked=o&&void 0===i?!!n:f()===n},null,{o:e}),a=void 0}}},r.i.checkedValue={update:function(e,t){e.value=r.g.h(t())}};var O=(e,t,n)=>t&&t.split(/\s+/).forEach(t=>e.classList.toggle(t,n));r.i.css={update:(e,t)=>{"object"==typeof(t=r.g.h(t()))?r.g.K(t,(t,n)=>{n=r.g.h(n),O(e,t,!!n)}):(t=r.g.Cb(t),O(e,e.__ko__cssValue,!1),e.__ko__cssValue=t,O(e,t,!0))}},r.i.enable={update:(e,t)=>{(t=r.g.h(t()))&&e.disabled?e.removeAttribute("disabled"):t||e.disabled||(e.disabled=!0)}},r.i.disable={update:(e,t)=>r.i.enable.update(e,()=>!r.g.h(t()))},r.i.event={init:function(e,t,n,o,i){r.g.K(t()||{},n=>{"string"==typeof n&&e.addEventListener(n,(...e)=>{var r=t()[n];if(r)try{o=i.$data;var s=r.apply(o,[o,...e])}finally{!0!==s&&e[0].preventDefault()}})})}};const D=e=>()=>{var t=e(),n=r.V(t)?t.L():t;return!n||Array.isArray(n)?{foreach:t}:(r.g.h(t),{foreach:n.data})};r.i.foreach={init:(e,t)=>r.i.template.init(e,D(t)),update:(e,t,n,o,i)=>r.i.template.update(e,D(t),n,o,i)},r.s.aa.foreach=!0,r.i.hasfocus={init:(e,t,n)=>{var o=o=>{e.__ko_hasfocusUpdating=!0,o=e.ownerDocument.activeElement===e,r.ma.Ha(e,t(),n,"hasfocus",o,!0),e.__ko_hasfocusLastValue=o,e.__ko_hasfocusUpdating=!1},i=o.bind(null,!0);o=o.bind(null,!1),e.addEventListener("focus",i),e.addEventListener("focusin",i),e.addEventListener("blur",o),e.addEventListener("focusout",o),e.__ko_hasfocusLastValue=!1},update:(e,t)=>{t=!!r.g.h(t()),e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===t||(t?e.focus():e.blur())}},r.i.html={init:()=>({controlsDescendantBindings:!0}),update:(e,t)=>{if(r.g.Ra(e),null!=(t=r.g.h(t()))){const n=i.createElement("template");n.innerHTML="string"!=typeof t?t.toString():t,e.appendChild(n.content)}}},(()=>{function e(e,t,n){r.i[e]={init:(e,o,i,s,a)=>{var l,c={};t&&(c={exportDependencies:!0});var h=i.has(r.j.ca);return r.m(()=>{var i=r.g.h(o()),s=!n!=!i,u=!l;if(h&&(a=r.j.ab(e,a)),s){c.dataDependency=r.u.m();var f=t?a.createChildContext("function"==typeof i?i:o,c):r.u.na()?a.extend(null,c):a}u&&r.u.na()&&(l=r.g.va(r.s.childNodes(e),!0)),s?(u||r.s.qa(e,r.g.va(l)),r.nb(f,e)):(r.s.ka(e),r.j.notify(e,r.j.F))},{o:e}),{controlsDescendantBindings:!0}}},r.s.aa[e]=!0}e("if"),e("ifnot",!1,!0),e("with",!0)})();var R={};r.i.options={init:e=>{if(!e.matches("SELECT"))throw Error("options binding applies only to SELECT elements");let t=e.length;for(;t--;)e.remove(t);return{controlsDescendantBindings:!0}},update:(e,t,n)=>{var o=e.multiple,i=0!=e.length&&o?e.scrollTop:null,s=r.g.h(t()),a=[];t=()=>Array.from(e.options).filter(e=>e.selected);var l=(e,t,n)=>{var o=typeof t;return"function"==o?t(e):"string"==o?e[t]:n},c=(t,n)=>{a.length&&(t=a.includes(r.C.M(n[0])),n[0].selected=t,u&&!t&&r.u.I(r.g.Eb,null,[e,"change"]))};if(o?a=t().map(r.C.M):0<=e.selectedIndex&&a.push(r.C.M(e.options[e.selectedIndex])),s){Array.isArray(s)||(s=[s]);var h=s.filter(e=>e??1)}var u=!1;s=c,n.has("optionsAfterRender")&&"function"==typeof n.get("optionsAfterRender")&&(s=(e,t)=>{c(e,t),r.u.I(n.get("optionsAfterRender"),null,[t[0],e!==R?e:void 0])}),r.g.Bb(e,h,(t,o,i)=>(i.length&&(a=i[0].selected?[r.C.M(i[0])]:[],u=!0),o=e.ownerDocument.createElement("option"),t===R?(r.g.$a(o),r.C.Ga(o,void 0)):(i=l(t,n.get("optionsValue"),t),r.C.Ga(o,r.g.h(i)),t=l(t,n.get("optionsText"),i),r.g.$a(o,t)),[o]),{},s),h=a.length,(o?h&&t().length<h:h&&0<=e.selectedIndex?r.C.M(e.options[e.selectedIndex])!==a[0]:h||0<=e.selectedIndex)&&r.u.I(r.g.Eb,null,[e,"change"]),r.u.Da()&&r.j.notify(e,r.j.F),i&&20<Math.abs(i-e.scrollTop)&&(e.scrollTop=i)}},r.i.options.Xa=r.g.l.Z(),r.i.style={update:(e,t)=>{r.g.K(r.g.h(t()||{}),(t,n)=>{if(null!=(n=r.g.h(n))&&!1!==n||(n=""),/^--/.test(t))e.style.setProperty(t,n);else{t=t.replace(/-(\w)/g,(e,t)=>t.toUpperCase());var o=e.style[t];e.style[t]=n,n===o||e.style[t]!=o||isNaN(n)||(e.style[t]=n+"px")}})}},r.i.submit={init:(e,t,n,o,i)=>{if("function"!=typeof t())throw Error("The value for a submit binding must be a function");e.addEventListener("submit",n=>{var o=t();try{var r=o.call(i.$data,e)}finally{!0!==r&&n.preventDefault()}})}},r.i.text={init:()=>({controlsDescendantBindings:!0}),update:(e,t)=>{8===e.nodeType&&(e.text||e.after(e.text=i.createTextNode("")),e=e.text),r.g.$a(e,t())}},r.s.aa.text=!0,r.i.textInput={init:(e,t,n)=>{var o,i,s=e.value,a=()=>{clearTimeout(o),i=o=void 0;var a=e.value;e.checkValidity()&&s!==a&&(s=a,r.ma.Ha(e,t(),n,"textInput",a))},l=()=>{var n=r.g.h(t())??"";void 0!==i&&n===i?setTimeout(l,4):e.value!==n&&(e.value=n,s=e.value)};e.addEventListener("input",a),e.addEventListener("change",a),r.m(l,{o:e})}},r.i.value={init:(e,t,n)=>{var o=e.matches("SELECT"),i=e.matches("INPUT");if(!i||"checkbox"!=e.type&&"radio"!=e.type){var s=new Set,a=n.get("valueUpdate"),l=null,c=()=>{l=null;var o=t(),i=r.C.M(e);r.ma.Ha(e,o,n,"value",i)};a&&("string"==typeof a?s.add(a):a.forEach(e=>s.add(e)),s.delete("change")),s.forEach(t=>{var n=c;(t||"").startsWith("after")&&(n=()=>{l=r.C.M(e),setTimeout(c,0)},t=t.slice(5)),e.addEventListener(t,n)});var h,u=i&&"file"==e.type?()=>{var n=r.g.h(t());null==n||""===n?e.value="":r.u.I(c)}:()=>{var n=r.g.h(t()),i=r.C.M(e);null!==l&&n===l?setTimeout(u,0):n===i&&void 0!==i||(o?(r.C.Ga(e,n),n!==r.C.M(e)&&r.u.I(c)):r.C.Ga(e,n))};if(o)r.j.subscribe(e,r.j.F,()=>{h?n.get("valueAllowUnset")?u():c():(e.addEventListener("change",c),h=r.m(u,{o:e}))},null,{notifyImmediately:!0});else e.addEventListener("change",c),r.m(u,{o:e})}else r.applyBindingAccessorsToNode(e,{checkedValue:t})},update:()=>{}},r.i.visible={update:(e,t)=>{t=r.g.h(t());var n="none"!=e.style.display;t&&!n?e.style.display="":n&&!t&&(e.style.display="none")}},r.i.hidden={update:(e,t)=>e.hidden=!!r.g.h(t())},function(e){r.i[e]={init:function(t,n,o,i,s){return r.i.event.init.call(this,t,()=>({[e]:n()}),o,i,s)}}}("click"),(()=>{let e=r.g.l.Z();class b{constructor(e){this.Oa=e}Va(...t){let n=this.Oa;if(!t.length)return r.g.l.get(n,e)||(11===this.H?n.content:1===this.H?n:void 0);r.g.l.set(n,e,t[0])}}r.cb={Oa:class d extends b{constructor(e){super(e),e&&(this.H=e.matches("TEMPLATE")&&e.content?e.content.nodeType:1)}},mb:b}})(),(()=>{const e=(e,t)=>{if(e.length){var n=e[0],o=n.parentNode;((e,t,n)=>{var o;for(t=r.s.nextSibling(t);e&&(o=e)!==t;)n(o,e=r.s.nextSibling(o))})(n,e[e.length-1],e=>(1===e.nodeType||8===e.nodeType)&&r.Jb(t,e)),r.g.ya(e,o)}},t=(t,n,o,s)=>{var a=(t&&(t.nodeType?t:0<t.length?t[0]:null)||o||{}).ownerDocument;if("string"==typeof o){if(!(a=(a=a||i).getElementById(o)))throw Error("Cannot find template with ID "+o);o=new r.cb.Oa(a)}else{if(![1,8].includes(o.nodeType))throw Error("Unknown template type: "+o);o=new r.cb.mb(o)}if(o=(o=o.Va?o.Va():null)?[...o.cloneNode(!0).childNodes]:null,!Array.isArray(o)||0<o.length&&"number"!=typeof o[0].nodeType)throw Error("Template engine must return an array of DOM nodes");return n&&(r.s.qa(t,o),e(o,s),r.j.notify(t,r.j.F)),o},n=(e,t,n)=>r.V(e)?e():"function"==typeof e?e(t,n):e,o=r.g.l.Z();r.i.template={init:(e,t)=>{if("string"==typeof(t=r.g.h(t()))||"name"in t)r.s.ka(e);else{if(!(t=r.s.childNodes(e)).length)throw Error("Anonymous template defined, but no template content was provided");t=r.g.Xb(t),new r.cb.mb(e).Va(t)}return{controlsDescendantBindings:!0}},update:(i,s,a,l,c)=>{l=s(),a=null,"string"==typeof(s=r.g.h(l))?s={}:l="name"in s?s.name:i;var h=!!l;"foreach"in s?a=((o,i,s,a,l)=>{var c,h=(e,i)=>(c=l.createChildContext(e,{extend:e=>e.$index=i}),e=n(o,e,c),t(a,!1,e,c)),u=(t,n)=>{e(n,c),c=null},f=(e,t)=>{r.u.I(r.g.Bb,null,[a,e,h,s,u,t]),r.j.notify(a,r.j.F)};if(r.isObservableArray(i)){f(i.L());var p=i.subscribe(e=>{f(i(),e)},null,"arrayChange");return p.o(a),p}return r.m(()=>{var e=r.g.h(i)||[];Array.isArray(e)||(e=[e]),f(e)},{o:a})})(l,h&&s.foreach||[],s,i,c):h?(a=c,"data"in s&&(a=c.createChildContext(s.data,{exportDependencies:!0})),a=((e,o,i,s)=>{if(i=i||{},s){var a=s.nodeType?s:0<s.length?s[0]:null;return r.m(()=>{var i=o instanceof r.ba?o:new r.ba(o,null,null,{exportDependencies:!0}),a=n(e,i.$data,i);t(s,!0,a,i)},{ja:()=>!a||!r.g.Qa(a),o:a})}console.log("no targetNodeOrNodeArray")})(l,a,s,i)):r.s.ka(i),c=a,r.g.l.get(i,o)?.dispose?.(),r.g.l.set(i,o,!c||c.isActive&&!c.isActive()?void 0:c)}},r.s.aa.template=!0})(),r.g.ub=(e,t,n)=>{var o,i=0,r=t.length;r&&e.every(e=>(0<=(o=t.findIndex(t=>e.value===t.value))&&(e.moved=t[o].index,t[o].moved=e.index,t.splice(o,1),i=o=0,--r),i+=r,r&&(!n||i<n)))},r.g.rb=(()=>{var e=(e,t,n,o,i)=>{for(var s,a,l,c,h=Math.min,u=Math.max,f=[],p=-1,g=e.length,m=t.length,v=m-g||1,C=g+m+1;++p<=g;)for(l=a,f.push(a=[]),c=h(m,p+v),s=u(0,p-1);s<=c;s++)a[s]=s?p?e[p-1]===t[s-1]?l[s-1]:h(l[s]||C,a[s-1]||C)+1:s+1:p+1;for(h=[],u=[],v=[],p=g,s=m;p||s;)m=f[p][s]-1,s&&m===f[p][s-1]?u.push(h[h.length]={status:n,value:t[--s],index:s}):p&&m===f[p-1][s]?v.push(h[h.length]={status:o,value:e[--p],index:p}):(--s,--p,i.sparse||h.push({status:"retained",value:t[s]}));return r.g.ub(v,u,10*g),h.reverse()};return(t,n,o)=>(n=n||[],(t=t||[]).length<n.length?e(t,n,"added","deleted",o):e(n,t,"deleted","added",o))})(),(()=>{var e=r.g.l.Z(),t=r.g.l.Z();r.g.Bb=(n,o,i,s,a,l)=>{o=o||[],Array.isArray(o)||(o=[o]);var c,h=r.g.l.get(n,e),u=[],f=0,p=0,g=[],m=[],v=e=>{c={ta:e,Ua:r.$(p++)},u.push(c)},C=e=>{(c=h[e]).Ua(p++),r.g.ya(c.O,n),u.push(c)};if(h){let e,t;for((!l||h&&h._countWaitingForRemove)&&(l=r.g.rb(Array.prototype.map.call(h,e=>e.ta),o,{sparse:!0})),l.forEach(o=>{switch(e=o.moved,t=o.index,o.status){case"deleted":for(;f<t;)C(f++);void 0===e&&((c=h[f]).Ma&&(c.Ma.dispose(),c.Ma=void 0),r.g.ya(c.O,n).length&&c&&g.push.apply(g,c.O)),f++;break;case"added":for(;p<t;)C(f++);void 0!==e?(m.push(u.length),C(e)):v(o.value)}});p<o.length;)C(f++);u._countWaitingForRemove=0}else o.forEach(v);r.g.l.set(n,e,u),g.forEach(r.removeNode);var y=e=>{r.s.Vb(n,e,S),S=e};if(l=n.ownerDocument.activeElement,m.length)for(;null!=(o=m.shift());){for(c=u[o];o--;)if(s=u[o].O,s?.length){var S=s[s.length-1];break}c.O.forEach(y)}u.forEach(e=>{e.O||r.g.extend(e,function(e,t,n,o,i){var s=[],a=r.m(()=>{var a=t(n,i,r.g.ya(s,e))||[];if(0<s.length){var l=s.nodeType?[s]:s;if(0<l.length){var c=l[0],h=c.parentNode;a.forEach(e=>h.insertBefore(e,c)),l.forEach(e=>r.removeNode(e))}o&&r.u.I(o,null,[n,a,i])}s.length=0,s.push(...a)},{o:e,ja:()=>!!s.find(r.g.Qa)});return{O:s,Ma:a.isActive()?a:void 0}}(n,i,e.ta,a,e.Ua)),e.O.forEach(y),!e.Ub&&a&&(a(e.ta,e.O,e.Ua),e.Ub=!0,S=e.O[e.O.length-1])}),n.ownerDocument.activeElement!=l&&l?.focus(),[].forEach(e=>e&&(e.ta=t))}})(),e.ko=r})(this),(()=>{var e=NodeFilter.FILTER_ACCEPT;TreeWalker.prototype.previousPONode=function(){const t=this.root;let n,o=this.currentNode;for(;;){for(n=o.lastChild;!n&&o&&o!==t;)n=o.previousSibling,n||(o=o.parentNode);if(!n)return null;const i=n.nodeType;if((i===Node.ELEMENT_NODE?NodeFilter.SHOW_ELEMENT:i===Node.TEXT_NODE?NodeFilter.SHOW_TEXT:0)&this.whatToShow&&e===this.filter.acceptNode(n))return this.currentNode=n,n;o=n}};var t=(t,n,o)=>document.createTreeWalker(t,n,{acceptNode:t=>!o||o(t)?e:NodeFilter.FILTER_SKIP}),n="​",o=navigator.userAgent,i=/Mac OS X/.test(o),r=/Windows NT/.test(o),s=/iP(?:ad|hone)/.test(o)||i&&!!navigator.maxTouchPoints,a=(/Android/.test(o),i||s?"Meta-":"Ctrl-"),l=/WebKit\//.test(o),c=/[^ \t\r\n]/,h=/^(?:#text|A(?:BBR|CRONYM)?|B(?:R|D[IO])?|C(?:ITE|ODE)|D(?:ATA|EL|FN)|EM|FONT|HR|I(?:MG|NS)?|KBD|Q|R(?:P|T|UBY)|S(?:AMP|MALL|PAN|TR(?:IKE|ONG)|U[BP])?|TIME|U|VAR|WBR)$/,u=new Set(["BR","HR","IMG"]),f=new WeakMap,p=e=>u.has(e.nodeName),g=e=>{switch(e.nodeType){case 3:return 1;case 1:case 11:if(f.has(e))return f.get(e);break;default:return 0}let t;return t=Array.from(e.childNodes).every(m)?h.test(e.nodeName)?1:2:3,f.set(e,t),t},m=e=>1===g(e),v=e=>2===g(e),C=e=>3===g(e),y=(e,t,n)=>{const o=document.createElement(e);return t instanceof Array&&(n=t,t=null),O(o,t),n&&o.append(...n),o},S=(e,t)=>!p(e)&&(e.nodeType===t.nodeType&&e.nodeName===t.nodeName&&(!(e instanceof HTMLElement&&t instanceof HTMLElement)||"A"!==e.nodeName&&e.className===t.className&&e.style.cssText===t.style.cssText)),k=(e,t,n)=>{if(e.nodeName!==t)return!1;for(const t in n)if(!("getAttribute"in e)||e.getAttribute(t)!==n[t])return!1;return!0},E=(e,t,n,o)=>{for(;e&&e!==t;){if(k(e,n,o))return e;e=e.parentNode}return null},_=(e,t)=>{let n=e.childNodes;for(;t&&e instanceof Element;)n=(e=n[t-1]).childNodes,t=n.length;return e},w=(e,t)=>{let n=e;if(n instanceof Element){const e=n.childNodes;if(t<e.length)n=e[t];else{for(;n&&!n.nextSibling;)n=n.parentNode;n&&(n=n.nextSibling)}}return n},N=e=>e instanceof Element||e instanceof DocumentFragment?e.childNodes.length:e instanceof CharacterData?e.length:0,x=e=>{const t=document.createDocumentFragment();return t.append(...e.childNodes),t},T=e=>(e.parentNode?.removeChild(e),e),L=(e,t)=>e.parentNode?.replaceChild(t,e),A=(e,t,n)=>(e=(e&&!e.closest?e.parentElement:e)?.closest(n),e&&t.contains(e)?e:null),O=(e,t)=>{t&&Object.entries(t).forEach(([t,n])=>{null==n?e.removeAttribute(t):"style"===t&&"object"==typeof n?Object.entries(n).forEach(([t,n])=>e.style[t]=n):e.setAttribute(t,n)})},D=e=>e instanceof Element?"BR"===e.nodeName:c.test(e.data),R=e=>{let n=e.parentNode;for(;m(n);)n=n.parentNode;const o=t(n,5,D);return o.currentNode=e,!!o.nextNode()},B=(e,o)=>{const i=t(e,4);let r,s;for(;r=i.nextNode();)for(;(s=r.data.indexOf(n))>-1&&(!o||r.parentNode!==o);){if(1===r.length){let e=r,t=e.parentNode;for(;t&&(t.removeChild(e),i.currentNode=t,m(t)&&!N(t));)e=t,t=e.parentNode;break}r.deleteData(s,1)}},I=(e,t,n)=>{if(n)return e.intersectsNode(t);{const n=document.createRange();n.selectNode(t);const o=e.compareBoundaryPoints(0,n)<1,i=e.compareBoundaryPoints(2,n)>-1;return o&&i}},M=e=>{let{startContainer:t,startOffset:n,endContainer:o,endOffset:i}=e;for(;!(t instanceof Text);){let e=t.childNodes[n];if(!e||p(e)){if(n&&(e=t.childNodes[n-1],e instanceof Text)){let o,i=e;for(;!i.length&&(o=i.previousSibling)&&o instanceof Text;)i.remove(),i=o;t=i,n=i.length}break}t=e,n=0}if(i)for(;!(o instanceof Text);){const e=o.childNodes[i-1];if(!e||p(e)){if(e&&"BR"===e.nodeName&&!R(e)){--i;continue}break}o=e,i=N(o)}else for(;!(o instanceof Text);){const e=o.firstChild;if(!e||p(e))break;o=e}e.setStart(t,n),e.setEnd(o,i)},P=(e,t,n,o)=>{let i,r=e.startContainer,s=e.startOffset,a=e.endContainer,l=e.endOffset;for(t||(t=e.commonAncestorContainer),n||(n=t);!s&&r!==t&&r!==o;)i=r.parentNode,s=Array.from(i.childNodes).indexOf(r),r=i;for(;a!==n&&a!==o&&(3!==a.nodeType&&a.childNodes[l]&&"BR"===a.childNodes[l].nodeName&&!R(a.childNodes[l])&&++l,l===N(a));)i=a.parentNode,l=Array.from(i.childNodes).indexOf(a)+1,a=i;e.setStart(r,s),e.setEnd(a,l)},U=(e,t,n)=>{let o=A(e.endContainer,n,t);if(o&&(o=o.parentNode)){const t=e.cloneRange();P(t,o,o,n),t.endContainer===o&&(e.setStart(t.endContainer,t.endOffset),e.setEnd(t.endContainer,t.endOffset))}return e},H={"font-weight":{regexp:/^bold|^700/i,replace:()=>y("B")},"font-style":{regexp:/^italic/i,replace:()=>y("I")},"font-family":{regexp:c,replace:(e,t)=>y("SPAN",{class:e.fontFamily,style:"font-family:"+t})},"font-size":{regexp:c,replace:(e,t)=>y("SPAN",{class:e.fontSize,style:"font-size:"+t})},"text-decoration":{regexp:/^underline/i,replace:()=>y("U")}},F=e=>(t,n)=>{const o=y(e),i=t.attributes;for(let e=0,t=i.length;e<t;++e){const t=i[e];o.setAttribute(t.name,t.value)}return n.replaceChild(o,t),o.append(x(t)),o},j={1:"x-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large","-1":"smaller","+1":"larger"},V={STRONG:F("B"),EM:F("I"),INS:F("U"),STRIKE:F("S"),SPAN:(e,t,n)=>{const o=e.style;let i,r;for(const t in H){const s=H[t],a=o.getPropertyValue(t);if(a&&s.regexp.test(a)){const o=s.replace(n.classNames,a);if(o.nodeName===e.nodeName&&o.className===e.className)continue;r||(r=o),i&&i.append(o),i=o,e.style.removeProperty(t)}}return r&&i&&(i.append(x(e)),e.style.cssText?e.append(r):L(e,r)),i||e},FONT:(e,t,n)=>{const o=e,i=o.face,r=o.size;let s=o.color,a=y("SPAN"),l=a.style;return a.style.cssText=e.style.cssText,i&&(l.fontFamily=i),r&&(l.fontSize=j[r]),s&&/^#?([\dA-F]{3}){1,2}$/i.test(s)&&("#"!==s.charAt(0)&&(s="#"+s),l.color=s),L(e,a),a.append(x(e)),a},TT:(e,t,n)=>{const o=y("SPAN",{class:n.classNames.fontFamily,style:'font-family:menlo,consolas,"courier new",monospace'});return L(e,o),o.append(x(e)),o}},$=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|COL(?:GROUP)?|UL)$/,q=new Set(["HEAD","META","STYLE"]),W=(e,n,o)=>{const i=e.childNodes;let r=e;for(;m(r);)r=r.parentNode;t(r,5);let s=i.length;for(;s--;){let t=i[s];const r=t.nodeName;if(t instanceof HTMLElement){const i=t.childNodes.length;if(V[r])t=V[r](t,e,n);else{if(q.has(r)){t.remove();continue}if(!$.test(r)&&!m(t)){s+=i,L(t,x(t));continue}}i&&W(t,n,o||"PRE"===r)}}return e},z=e=>{const t=e.childNodes;let n=t.length;for(;n--;){const o=t[n];o instanceof Element&&!p(o)?(z(o),m(o)&&!o.firstChild&&e.removeChild(o)):o instanceof Text&&!o.length&&e.removeChild(o)}},K=e=>{const t=e.querySelectorAll("BR:last-child");let n=t.length;for(;n--;){const e=t[n],o=e.parentElement;!e.nextSibling&&1===o.children.length&&o.textContent.trim().length&&e.remove()}},G=e=>e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;"),Z=e=>(!(e instanceof Element||e instanceof DocumentFragment)||m(e)||e.children.length||e.textContent.length||e.appendChild(y("BR")),e),Q=e=>{let t=null;return[...e.childNodes].forEach(n=>{m(n)?(t||(t=y("DIV")),t.append(n)):t&&((t.children.length||t.textContent.trim().length)&&e.insertBefore(t,n),t=null)}),t&&e.append(t),e},X=(e,t,n,o)=>{if(e instanceof Text&&e!==n){if("number"!=typeof t)throw new Error("Offset must be a number to split text node!");if(!e.parentNode)throw new Error("Cannot split text node with no parent!");return X(e.parentNode,e.splitText(t),n,o)}let i="number"==typeof t?t<e.childNodes.length?e.childNodes[t]:null:t;const r=e.parentNode;if(!(r&&e!==n&&e instanceof Element))return i;const s=e.cloneNode(!1);for(;i;){const e=i.nextSibling;s.append(i),i=e}return e instanceof HTMLOListElement&&A(e,o,"BLOCKQUOTE")&&(s.start=(+e.start||1)+e.childNodes.length-1),Z(e),Z(s),e.after(s),X(r,s,n,o)},Y=(e,t)=>{const n=e.childNodes;let o=n.length;const i=[];for(;o--;){const r=n[o],s=o?n[o-1]:null;if(s&&m(r)&&S(r,s))t.startContainer===r&&(t.startContainer=s,t.startOffset+=N(s)),t.endContainer===r&&(t.endContainer=s,t.endOffset+=N(s)),t.startContainer===e&&(t.startOffset>o?--t.startOffset:t.startOffset===o&&(t.startContainer=s,t.startOffset=N(s))),t.endContainer===e&&(t.endOffset>o?--t.endOffset:t.endOffset===o&&(t.endContainer=s,t.endOffset=N(s))),T(r),r instanceof Text?s.appendData(r.data):i.push(x(r));else if(r instanceof Element){let e;for(;e=i.pop();)r.append(e);Y(r,t)}}},J=(e,t)=>{const n=e instanceof Text?e.parentNode:e;if(n instanceof Element){const e={startContainer:t.startContainer,startOffset:t.startOffset,endContainer:t.endContainer,endOffset:t.endOffset};Y(n,e),t.setStart(e.startContainer,e.startOffset),t.setEnd(e.endContainer,e.endOffset)}},ee=(e,t,n,o)=>{let i,r,s=t;for(;(i=s.parentNode)&&i!==o&&i instanceof Element&&1===i.childNodes.length;)s=i;T(s),r=e.childNodes.length;const a=e.lastChild;a&&"BR"===a.nodeName&&(a.remove(),--r),e.append(x(t)),n.setStart(e,r),n.collapse(!0),J(e,n)},te=(e,t)=>{const n=e.previousSibling,o=e.firstChild,i="LI"===e.nodeName;if(!i||o&&/^[OU]L$/.test(o.nodeName))if(n&&S(n,e)){if(!C(n)){if(!i)return;const e=y("DIV");e.append(x(n)),n.append(e)}T(e);const r=!C(e);n.append(x(e)),r&&Q(n),o&&te(o,t)}else if(i){const t=y("DIV");e.insertBefore(t,o),Z(t)}},ne=(e,n)=>{const o=t(n,1,v);return o.currentNode=e,o},oe=(e,t)=>{const n=ne(e,t).previousNode();return n!==t?n:null},ie=(e,t)=>{const n=ne(e,t).nextNode();return n!==t?n:null},re=e=>!e.textContent&&!e.querySelector("IMG"),se=(e,t)=>{const n=e.startContainer;let o;if(m(n))o=oe(n,t);else if(n!==t&&n instanceof HTMLElement&&v(n))o=n;else{const i=_(n,e.startOffset);o=ie(i,t)}return o&&I(e,o,!0)?o:null},ae=(e,t)=>{const n=e.endContainer;let o;if(m(n))o=oe(n,t);else if(n!==t&&n instanceof HTMLElement&&v(n))o=n;else{let i=w(n,e.endOffset);if(!i||!t.contains(i)){let e;for(i=t;e=i.lastChild;)i=e}o=oe(i,t)}return o&&I(e,o,!0)?o:null},le=e=>e instanceof Text?c.test(e.data):"IMG"===e.nodeName,ce=(e,o)=>{const i=e.startContainer,r=e.startOffset;let s;if(i instanceof Text){const e=i.data;for(let t=r;t>0;--t)if(e.charAt(t-1)!==n)return!1;s=i}else if(s=w(i,r),s&&!o.contains(s)&&(s=null),!s&&(s=_(i,r),s instanceof Text&&s.length))return!1;const a=se(e,o);if(!a)return!1;const l=t(a,5,le);return l.currentNode=s,!l.previousNode()},de=(e,o)=>{const i=e.endContainer,r=e.endOffset;let s;if(i instanceof Text){const e=i.data,t=e.length;for(let o=r;o<t;++o)if(e.charAt(o)!==n)return!1;s=i}else s=_(i,r);const a=ae(e,o);if(!a)return!1;const l=t(a,5,le);return l.currentNode=s,!l.nextNode()};function he(e,t,n,o){const i=document.createRange();return i.setStart(e,t),n&&"number"==typeof o?i.setEnd(n,o):i.setEnd(e,t),i}var ue=(e,t)=>{let n,{startContainer:o,startOffset:i,endContainer:r,endOffset:s}=e;if(o instanceof Text){const t=o.parentNode;if(n=t.childNodes,i===o.length)i=Array.from(n).indexOf(o)+1,e.collapsed&&(r=t,s=i);else{if(i){const e=o.splitText(i);r===o?(s-=i,r=e):r===t&&++s,o=e}i=Array.from(n).indexOf(o)}o=t}else n=o.childNodes;const a=n.length;i===a?o.append(t):o.insertBefore(t,n[i]),o===r&&(s+=n.length-a),e.setStart(o,i),e.setEnd(r,s)},fe=(e,t,n)=>{const o=document.createDocumentFragment();if(e.collapsed)return o;t||(t=e.commonAncestorContainer),t instanceof Text&&(t=t.parentNode);const i=e.startContainer,r=e.startOffset;let s=X(e.endContainer,e.endOffset,t,n),a=0,l=X(i,r,t,n);for(;l&&l!==s;){const e=l.nextSibling;o.append(l),l=e}return l=s&&s.previousSibling,l&&l instanceof Text&&s instanceof Text&&(a=l.length,l.appendData(s.data),T(s),s=l),e.setStart(i,r),s?e.setEnd(s,a):e.setEnd(t,t.childNodes.length),Z(t),o},pe=(e,t,n)=>{let o;for(e.currentNode=n;o=e[t]();){if(o instanceof Text||p(o))return o;if(!m(o))return null}return null},ge=(e,n)=>{const o=se(e,n);let i=ae(e,n);const r=o!==i;o&&i&&(M(e),P(e,o,i,n));const s=fe(e,null,n);M(e),r&&(i=ae(e,n),o&&i&&o!==i&&ee(o,i,e,n)),o&&Z(o);const a=n.firstChild;a&&"BR"!==a.nodeName||(Z(n),n.firstChild&&e.selectNodeContents(n.firstChild)),e.collapse(!0);const l=e.startContainer,c=e.startOffset,h=t(n,5);let u=l,f=c;u instanceof Text&&f!==u.length||(u=pe(h,"nextNode",u),f=0);let p=l,g=c-1;p instanceof Text&&-1!==g||(p=pe(h,"previousPONode",u||(l instanceof Text?l:l.childNodes[c]||l)),p instanceof Text&&(g=p.length));let m=null,v=0;return u instanceof Text&&" "===u.data.charAt(f)&&ce(e,n)?(m=u,v=f):p instanceof Text&&" "===p.data.charAt(g)&&(u instanceof Text&&" "===u.data.charAt(f)||de(e,n))&&(m=p,v=g),m&&m.replaceData(v,1," "),e.setStart(l,c),e.collapse(!0),s},me=n=>{if(n.collapsed)return"";const o=n.startContainer,i=n.endContainer,r=t(n.commonAncestorContainer,5,e=>I(n,e,!0));r.currentNode=o;let s,a=o,l="",c=!1;for((a instanceof Element||a instanceof Text)&&e===r.filter.acceptNode(a)||(a=r.nextNode());a;)a instanceof Text?(s=a.data,s&&/\S/.test(s)&&(a===i&&(s=s.slice(0,n.endOffset)),a===o&&(s=s.slice(n.startOffset)),l+=s,c=!0)):("BR"===a.nodeName||c&&!m(a))&&(l+="\n",c=!1),a=r.nextNode();return l=l.replace(/ /g," "),l},ve=(Array.prototype.indexOf,(e,t,n,o,i,s,a)=>{const l=e.clipboardData;if(!l)return!1;let c=s?"":me(t);const h=se(t,n);let u,f=n;h===ae(t,n)&&h?.contains(t.commonAncestorContainer)&&(f=h),o?u=ge(t,n):(t=t.cloneRange(),M(t),P(t,f,f,n),u=t.cloneContents());let p,g=t.commonAncestorContainer;for(g instanceof Text&&(g=g.parentNode);g&&g!==f;){const e=g.cloneNode(!1);e.append(u),u=e,g=g.parentNode}if(1===u.childNodes.length&&u.childNodes[0]instanceof Text)c=u.childNodes[0].data.replace(/ /g," "),a=!0;else{const e=y("DIV");e.append(u),p=e.innerHTML,i&&(p=i(p))}return s&&void 0!==p&&(c=s(p)),r&&(c=c.replace(/\r?\n/g,"\r\n")),!a&&p&&c!==p&&(p="\x3c!-- squire --\x3e"+p,l.setData("text/html",p)),l.setData("text/plain",c),e.preventDefault(),!0}),be=function(e){const t=this.getSelection(),n=this._root;if(t.collapsed)return void e.preventDefault();this.saveUndoState(t);ve(e,t,n,!0,this._config.willCutCopy,this._config.toPlainText,!1)||setTimeout(()=>{try{this._ensureBottomLine()}catch(e){this._config.didError(e)}},0),this.setSelection(t)},Ce=function(e){ve(e,this.getSelection(),this._root,!1,this._config.willCutCopy,this._config.toPlainText,!1)},ye=function(e){this._isShiftDown=e.shiftKey},Se=function(e){const t=e.clipboardData,n=t.items,o=this._isShiftDown;let i=!1,r=!1,s=null,a=null,l=n.length;for(;l--;){const e=n[l],t=e.type;"text/html"===t?a=e:"text/plain"===t||"text/uri-list"===t?s=e:"text/rtf"===t?i=!0:/^image\/.*/.test(t)&&(r=!0)}if(r&&(!i||!a))return e.preventDefault(),void this.fireEvent("pasteImage",{clipboardData:t});e.preventDefault(),!a||o&&s?s&&s.getAsString(e=>{let t=!1;const n=this.getSelection();if(!n.collapsed&&c.test(n.toString())){const n=this.linkRegExp.exec(e);t=!!n&&n[0].length===e.length}t?this.makeLink(e):this.insertPlainText(e,!0)}):a.getAsString(e=>{this.insertHTML(e,!0)})},ke=function(e){if(!e.dataTransfer)return;const t=e.dataTransfer.types;let n=t.length,o=!1,i=!1;for(;n--;)switch(t[n]){case"text/plain":o=!0;break;case"text/html":i=!0;break;default:return}(i||o&&this.saveUndoState)&&this.saveUndoState()},Ee=(e,t)=>{try{t||(t=e.getSelection());let o=t.startContainer;o instanceof Text&&(o=o.parentNode);let i=o;for(;m(i)&&(!i.textContent||i.textContent===n);)o=i,i=o.parentNode;o!==i&&(t.setStart(i,Array.from(i.childNodes).indexOf(o)),t.collapse(!0),i.removeChild(o),v(i)||(i=oe(i,e._root)||e._root),Z(i),M(t)),o===e._root&&(o=o.firstChild)&&"BR"===o.nodeName&&T(o),e._ensureBottomLine(),e.setSelection(t),e._updatePath(t,!0)}catch(t){e._config.didError(t)}},_e=(e,t)=>{let n;for(;(n=e.parentNode)&&n!==t&&!n.isContentEditable;)e=n;T(e)},we=(e,t,n)=>{if(A(t,e._root,"A"))return;const o=t.data||"",i=Math.max(o.lastIndexOf(" ",n-1),o.lastIndexOf(" ",n-1))+1,r=o.slice(i,n),s=e.linkRegExp.exec(r);if(s){const n=e.getSelection();e._docWasChanged(),e._recordUndoState(n),e._getRangeAndRemoveBookmark(n);const r=i+s.index,a=r+s[0].length,l=n.startContainer===t,c=n.startOffset-a;r&&(t=t.splitText(r));const h=e._config.tagAttributes.a,u=y("A",Object.assign({href:s[1]?/^(?:ht|f)tps?:/i.test(s[1])?s[1]:"http://"+s[1]:"mailto:"+s[0]},h));u.textContent=o.slice(r,a),t.parentNode.insertBefore(u,t),t.data=o.slice(a),l&&(n.setStart(t,c),n.setEnd(t,c)),e.setSelection(n)}},Ne=function(e){if(e.defaultPrevented||e.isComposing)return;let t=e.key,n="";const o=e.code;/^Digit\d$/.test(o)&&(t=o.slice(-1)),"Backspace"!==t&&"Delete"!==t&&(e.altKey&&(n+="Alt-"),e.ctrlKey&&(n+="Ctrl-"),e.metaKey&&(n+="Meta-"),e.shiftKey&&(n+="Shift-")),r&&e.shiftKey&&"Delete"===t&&(n+="Shift-"),t=n+t;const i=this.getSelection();this._keyHandlers[t]?this._keyHandlers[t](this,e,i):i.collapsed||e.ctrlKey||e.metaKey||1!==t.length||(this.saveUndoState(i),ge(i,this._root),this._ensureBottomLine(),this.setSelection(i),this._updatePath(i,!0))},xe={Backspace:(e,t,n)=>{const o=e._root;if(e._removeZWS(),e.saveUndoState(n),n.collapsed)if(ce(n,o)){t.preventDefault();const i=se(n,o);if(!i)return;let r=i;Q(r.parentNode);const s=oe(r,o);if(s){if(!s.isContentEditable)return void _e(s,o);for(ee(s,r,n,o),r=s.parentNode;r!==o&&!r.nextSibling;)r=r.parentNode;r!==o&&(r=r.nextSibling)&&te(r,o),e.setSelection(n)}else if(r){if(A(r,o,"UL")||A(r,o,"OL"))return void e.decreaseListLevel(n);if(A(r,o,"BLOCKQUOTE"))return void e.removeQuote(n);e.setSelection(n),e._updatePath(n,!0)}}else{M(n);const o=n.startContainer,i=n.startOffset,r=o.parentNode;o instanceof Text&&r instanceof HTMLAnchorElement&&i&&r.href.includes(o.data)?(o.deleteData(i-1,1),e.setSelection(n),e.removeLink(),t.preventDefault()):(e.setSelection(n),setTimeout(()=>{Ee(e)},0))}else t.preventDefault(),ge(n,o),Ee(e,n)},Delete:(e,t,n)=>{const o=e._root;let i,r,s,a,l,c;if(e._removeZWS(),e.saveUndoState(n),n.collapsed)if(de(n,o)){if(t.preventDefault(),i=se(n,o),!i)return;if(Q(i.parentNode),r=ie(i,o),r){if(!r.isContentEditable)return void _e(r,o);for(ee(i,r,n,o),r=i.parentNode;r!==o&&!r.nextSibling;)r=r.parentNode;r!==o&&(r=r.nextSibling)&&te(r,o),e.setSelection(n),e._updatePath(n,!0)}}else{if(s=n.cloneRange(),P(n,o,o,o),a=n.endContainer,l=n.endOffset,a instanceof Element&&(c=a.childNodes[l],c&&"IMG"===c.nodeName))return t.preventDefault(),T(c),M(n),void Ee(e,n);e.setSelection(s),setTimeout(()=>{Ee(e)},0)}else t.preventDefault(),ge(n,o),Ee(e,n)},Tab:(e,t,n)=>{const o=e._root;e._removeZWS(),n.collapsed&&ce(n,o)&&A(n.startContainer,o,"UL,OL,BLOCKQUOTE")&&e.changeIndentationLevel("increase")&&t.preventDefault()},"Shift-Tab":(e,t,n)=>{const o=e._root;e._removeZWS(),n.collapsed&&ce(n,o)&&decreaseLevel(e,n,n.startContainer)&&t.preventDefault()}," ":(e,o,i)=>{let r;const s=e._root;if(e._recordUndoState(i),e._getRangeAndRemoveBookmark(i),i.collapsed){if(de(i,s)){const r=se(i,s);if(r&&"PRE"!==r.nodeName){const s=r.textContent?.trimEnd().replace(n,"");if("*"===s||"1."===s){o.preventDefault(),e.insertPlainText(" ",!1),e._docWasChanged(),e.saveUndoState(i);const n=t(r,4);let a;for(;a=n.nextNode();)T(a);return void("*"===s?e.makeUnorderedList():e.makeOrderedList())}}}}else ge(i,s),e._ensureBottomLine(),e.setSelection(i),e._updatePath(i,!0);if(r=i.endContainer,i.endOffset===N(r))do{if("A"===r.nodeName){i.setStartAfter(r);break}}while(!r.nextSibling&&(r=r.parentNode)&&r!==s);if(e._config.addLinks){const t=i.cloneRange();M(t);const n=t.startContainer,o=t.startOffset;setTimeout(()=>{we(e,n,o)},0)}e.setSelection(i)},ArrowLeft(e){e._removeZWS()},ArrowRight(e,t,n){e._removeZWS();const o=e.getRoot();if(de(n,o)){M(n);let i=n.endContainer;do{if("CODE"===i.nodeName){let o=i.nextSibling;if(!(o instanceof Text)){const e=document.createTextNode(" ");i.parentNode.insertBefore(e,o),o=e}n.setStart(o,1),e.setSelection(n),t.preventDefault();break}}while(!i.nextSibling&&(i=i.parentNode)&&i!==o)}}};i||s||(xe.PageUp=e=>{e.moveCursorToStart()},xe.PageDown=e=>{e.moveCursorToEnd()});var Te=(e,t)=>(t=t||null,(n,o)=>{o.preventDefault();const i=n.getSelection();n.hasFormat(e,null,i)?n.changeFormat(null,{tag:e},i):n.changeFormat({tag:e},t,i)});xe[a+"b"]=Te("B"),xe[a+"i"]=Te("I"),xe[a+"u"]=Te("U"),xe[a+"Shift-7"]=Te("S"),xe[a+"Shift-5"]=Te("SUB",{tag:"SUP"}),xe[a+"Shift-6"]=Te("SUP",{tag:"SUB"}),xe[a+"Shift-8"]=(e,t)=>{t.preventDefault();const n=e.getPath();/(?:^|>)UL/.test(n)?e.removeList():e.makeUnorderedList()},xe[a+"Shift-9"]=(e,t)=>{t.preventDefault();const n=e.getPath();/(?:^|>)OL/.test(n)?e.removeList():e.makeOrderedList()},xe[a+"["]=(e,t)=>{t.preventDefault();const n=e.getPath();/(?:^|>)BLOCKQUOTE/.test(n)||!/(?:^|>)[OU]L/.test(n)?e.decreaseQuoteLevel():e.decreaseListLevel()},xe[a+"]"]=(e,t)=>{t.preventDefault();const n=e.getPath();/(?:^|>)BLOCKQUOTE/.test(n)||!/(?:^|>)[OU]L/.test(n)?e.increaseQuoteLevel():e.increaseListLevel()},xe[a+"d"]=(e,t)=>{t.preventDefault(),e.toggleCode()},xe[a+"z"]=(e,t)=>{t.preventDefault(),e.undo()},xe[a+"y"]=xe[a+"Shift-z"]=xe[a+"Shift-Z"]=(e,t)=>{t.preventDefault(),e.redo()};window.Squire=class{constructor(e,t){this.customEvents=new Set(["pathChange","select","input","pasteImage","undoStateChange"]),this.startSelectionId="squire-selection-start",this.endSelectionId="squire-selection-end",this.linkRegExp=/\b(?:((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.]|[a-z0-9][a-z0-9.\-]*[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:[^\s?&`!()\[\]{};:'".,<>«»“”‘’]|\([^\s()<>]+\)))|([\w\-.%+]+@(?:[\w\-]+\.)+[a-z]{2,}\b(?:[?][^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+(?:&[^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+)*)?))/i,this.tagAfterSplit={DT:"DD",DD:"DT",LI:"LI",PRE:"PRE"},this._root=e,this._config=this._makeConfig(t),this._isFocused=!1,this._lastSelection=he(e,0),this._willRestoreSelection=!1,this._mayHaveZWS=!1,this._lastAnchorNode=null,this._lastFocusNode=null,this._path="",this._events=new Map,this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0,this._isInUndoState=!1,this._ignoreChange=!1,this._ignoreAllChanges=!1,this.addEventListener("selectionchange",this._updatePathOnEvent),this.addEventListener("blur",this._enableRestoreSelection),this.addEventListener("mousedown",this._disableRestoreSelection),this.addEventListener("touchstart",this._disableRestoreSelection),this.addEventListener("focus",this._restoreSelection),this.addEventListener("blur",this._removeZWS),this._isShiftDown=!1,this.addEventListener("cut",be),this.addEventListener("copy",Ce),this.addEventListener("paste",Se),this.addEventListener("drop",ke),this.addEventListener("keydown",ye),this.addEventListener("keyup",ye),this.addEventListener("keydown",Ne),this._keyHandlers=Object.create(xe);const n=new MutationObserver(()=>this._docWasChanged());n.observe(e,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._mutation=n,e.setAttribute("contenteditable","true"),this.addEventListener("beforeinput",this._beforeInput),this.setHTML("")}destroy(){this._events.forEach((e,t)=>{this.removeEventListener(t)}),this._mutation.disconnect(),this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0}_makeConfig(e){const t={blockTag:"DIV",classNames:{color:"color",fontFamily:"font",fontSize:"size",highlight:"highlight"},undo:{documentSizeThreshold:-1,undoLimit:-1},addLinks:!0,willCutCopy:null,toPlainText:null,sanitizeToDOMFragment:e=>{const t=DOMPurify.sanitize(e,{ALLOW_UNKNOWN_PROTOCOLS:!0,WHOLE_DOCUMENT:!1,RETURN_DOM:!0,RETURN_DOM_FRAGMENT:!0,FORCE_BODY:!1});return t?document.importNode(t,!0):document.createDocumentFragment()},didError:e=>console.log(e)};return e&&(Object.assign(t,e),t.blockTag=t.blockTag.toUpperCase()),t}setKeyHandler(e,t){return this._keyHandlers[e]=t,this}_beforeInput(e){switch(e.inputType){case"insertLineBreak":e.preventDefault(),this.splitBlock(!0);break;case"insertParagraph":e.preventDefault(),this.splitBlock(!1);break;case"insertOrderedList":e.preventDefault(),this.makeOrderedList();break;case"insertUnoderedList":e.preventDefault(),this.makeUnorderedList();break;case"historyUndo":e.preventDefault(),this.undo();break;case"historyRedo":e.preventDefault(),this.redo();break;case"formatBold":e.preventDefault(),this.bold();break;case"formaItalic":e.preventDefault(),this.italic();break;case"formatUnderline":e.preventDefault(),this.underline();break;case"formatStrikeThrough":e.preventDefault(),this.strikethrough();break;case"formatSuperscript":e.preventDefault(),this.superscript();break;case"formatSubscript":e.preventDefault(),this.subscript();break;case"formatJustifyFull":case"formatJustifyCenter":case"formatJustifyRight":case"formatJustifyLeft":{e.preventDefault();let t=e.inputType.slice(13).toLowerCase();"full"===t&&(t="justify"),this.setTextAlignment(t);break}case"formatRemove":e.preventDefault(),this.setStyle();break;case"formatSetBlockTextDirection":{e.preventDefault();let t=e.data;"null"===t&&(t=null),this.setTextDirection(t);break}case"formatBackColor":e.preventDefault(),this.setStyle({backgroundColor:e.data});break;case"formatFontColor":e.preventDefault(),this.setStyle({color:e.data});break;case"formatFontName":e.preventDefault(),this.setStyle({fontFamily:e.data})}}handleEvent(e){this.fireEvent(e.type,e)}fireEvent(e,t){let n=this._events.get(e);if(/^(?:focus|blur)/.test(e)){const t=this._root===document.activeElement;if("focus"===e){if(!t||this._isFocused)return this;this._isFocused=!0}else{if(t||!this._isFocused)return this;this._isFocused=!1}}if(n){const o=t instanceof Event?t:new CustomEvent(e,{detail:t});n=n.slice();for(const e of n)try{"handleEvent"in e?e.handleEvent(o):e.call(this,o)}catch(e){this._config.didError(e)}}return this}addEventListener(e,t){let n=this._events.get(e),o=this._root;return n||(n=[],this._events.set(e,n),this.customEvents.has(e)||("selectionchange"===e&&(o=document),o.addEventListener(e,this,!0))),n.push(t),this}removeEventListener(e,t){const n=this._events.get(e);let o=this._root;if(n){if(t){let e=n.length;for(;e--;)n[e]===t&&n.splice(e,1)}else n.length=0;n.length||(this._events.delete(e),this.customEvents.has(e)||("selectionchange"===e&&(o=document),o.removeEventListener(e,this,!0)))}return this}focus(){return this._root.focus({preventScroll:!0}),this}blur(){return this._root.blur(),this}_enableRestoreSelection(){this._willRestoreSelection=!0}_disableRestoreSelection(){this._willRestoreSelection=!1}_restoreSelection(){this._willRestoreSelection&&this.setSelection(this._lastSelection)}_removeZWS(){this._mayHaveZWS&&(B(this._root),this._mayHaveZWS=!1)}_saveRangeToBookmark(e){let t,n=y("INPUT",{id:this.startSelectionId,type:"hidden"}),o=y("INPUT",{id:this.endSelectionId,type:"hidden"});ue(e,n),e.collapse(!1),ue(e,o),n.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_PRECEDING&&(n.id=this.endSelectionId,o.id=this.startSelectionId,t=n,n=o,o=t),e.setStartAfter(n),e.setEndBefore(o)}_getRangeAndRemoveBookmark(e){const t=this._root,n=t.querySelector("#"+this.startSelectionId),o=t.querySelector("#"+this.endSelectionId);if(n&&o){let t=n.parentNode,i=o.parentNode;const r=Array.from(t.childNodes).indexOf(n);let s=Array.from(i.childNodes).indexOf(o);t===i&&--s,n.remove(),o.remove(),e||(e=document.createRange()),e.setStart(t,r),e.setEnd(i,s),J(t,e),t!==i&&J(i,e),e.collapsed&&(t=e.startContainer,t instanceof Text&&(i=t.childNodes[e.startOffset],i&&i instanceof Text||(i=t.childNodes[e.startOffset-1]),i&&i instanceof Text&&(e.setStart(i,0),e.collapse(!0))))}return e||null}getSelection(){const e=window.getSelection(),t=this._root;let n=null;if(this._isFocused&&e&&e.rangeCount){n=e.getRangeAt(0).cloneRange();const t=n.startContainer,o=n.endContainer;t&&p(t)&&n.setStartBefore(t),o&&p(o)&&n.setEndBefore(o)}return n&&t.contains(n.commonAncestorContainer)?this._lastSelection=n:(n=this._lastSelection,document.contains(n.commonAncestorContainer)||(n=null)),n||he(t.firstElementChild||t,0)}setSelection(e){if(this._lastSelection=e,this._isFocused){const t=window.getSelection();t&&("setBaseAndExtent"in Selection.prototype?t.setBaseAndExtent(e.startContainer,e.startOffset,e.endContainer,e.endOffset):(t.removeAllRanges(),t.addRange(e)))}else this._enableRestoreSelection();return this}_moveCursorTo(e){const t=this._root,n=he(t,e?0:t.childNodes.length);return M(n),this.setSelection(n),this}moveCursorToStart(){return this._moveCursorTo(!0)}moveCursorToEnd(){return this._moveCursorTo(!1)}getCursorPosition(){const e=this.getSelection();let t=e.getBoundingClientRect();if(t&&!t.top){this._ignoreChange=!0;const o=y("SPAN");o.textContent=n,ue(e,o),t=o.getBoundingClientRect();const i=o.parentNode;i.removeChild(o),J(i,e)}return t}getPath(){return this._path}_updatePathOnEvent(){this._isFocused&&this._updatePath(this.getSelection())}_updatePath(e,t){const n=e.startContainer,o=e.endContainer;let i;(t||n!==this._lastAnchorNode||o!==this._lastFocusNode)&&(this._lastAnchorNode=n,this._lastFocusNode=o,i=n&&o?n===o?this._getPath(o):"(selection)":"",this._path===i&&n===o||(this._path=i,this.fireEvent("pathChange",{path:i}))),this.fireEvent(e.collapsed?"cursor":"select",{range:e})}_getPath(e){const t=this._root,n=this._config;let o="";if(e&&e!==t){const t=e.parentNode;if(o=t?this._getPath(t):"",e instanceof HTMLElement){const t=e.id,i=e.classList,r=Array.from(i).sort(),s=e.dir,a=n.classNames;o+=(o?">":"")+e.nodeName,t&&(o+="#"+t),r.length&&(o+=".",o+=r.join(".")),s&&(o+="[dir="+s+"]"),i.contains(a.highlight)&&(o+="[backgroundColor="+e.style.backgroundColor.replace(/ /g,"")+"]"),i.contains(a.color)&&(o+="[color="+e.style.color.replace(/ /g,"")+"]"),i.contains(a.fontFamily)&&(o+="[fontFamily="+e.style.fontFamily.replace(/ /g,"")+"]"),i.contains(a.fontSize)&&(o+="[fontSize="+e.style.fontSize+"]")}}return o}modifyDocument(e){const t=this._mutation;return t&&(t.takeRecords().length&&this._docWasChanged(),t.disconnect()),this._ignoreAllChanges=!0,e(),this._ignoreAllChanges=!1,t&&(t.observe(this._root,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._ignoreChange=!1),this}_docWasChanged(){f=new WeakMap,this._mayHaveZWS=!0,this._ignoreAllChanges||(this._ignoreChange?this._ignoreChange=!1:(this._isInUndoState&&(this._isInUndoState=!1,this.fireEvent("undoStateChange",{canUndo:!0,canRedo:!1})),this.fireEvent("input")))}_recordUndoState(e,t){const n=this._isInUndoState;if(!n||t){let o=this._undoIndex+1;const i=this._undoStack,r=this._config.undo,s=r.documentSizeThreshold,a=r.undoLimit;if(o<this._undoStackLength&&(i.length=this._undoStackLength=o),e&&this._saveRangeToBookmark(e),n)return this;const l=this._getRawHTML();t&&--o,s>-1&&2*l.length>s&&a>-1&&o>a&&(i.splice(0,o-a),o=a,this._undoStackLength=a),i[o]=l,this._undoIndex=o,++this._undoStackLength,this._isInUndoState=!0}return this}saveUndoState(e){return e||(e=this.getSelection()),this._recordUndoState(e,this._isInUndoState),this._getRangeAndRemoveBookmark(e),this}undo(){if(0!==this._undoIndex||!this._isInUndoState){this._recordUndoState(this.getSelection(),!1),--this._undoIndex,this._setRawHTML(this._undoStack[this._undoIndex]);const e=this._getRangeAndRemoveBookmark();e&&this.setSelection(e),this._isInUndoState=!0,this.fireEvent("undoStateChange",{canUndo:0!==this._undoIndex,canRedo:!0}),this.fireEvent("input")}return this.focus()}redo(){const e=this._undoIndex,t=this._undoStackLength;if(e+1<t&&this._isInUndoState){++this._undoIndex,this._setRawHTML(this._undoStack[this._undoIndex]);const n=this._getRangeAndRemoveBookmark();n&&this.setSelection(n),this.fireEvent("undoStateChange",{canUndo:!0,canRedo:e+2<t}),this.fireEvent("input")}return this.focus()}getRoot(){return this._root}_getRawHTML(){return this._root.innerHTML}_setRawHTML(e){if(void 0!==e){const t=this._root;let n=t;t.innerHTML=e;do{Z(n)}while(n=ie(n,t));this._ignoreChange=!0}return this}getHTML(e){let t;e&&(t=this.getSelection(),this._saveRangeToBookmark(t));const n=this._getRawHTML().replace(/\u200B/g,"");return e&&this._getRangeAndRemoveBookmark(t),n}setHTML(e){const t=this._config.sanitizeToDOMFragment(e,this),n=this._root;W(t,this._config),K(t),Q(t);let o=t,i=o.firstChild;if(i&&"BR"!==i.nodeName)for(;o=ie(o,n);)Z(o);else{const e=this.createDefaultBlock();i?o.replaceChild(e,i):o.append(e)}for(this._ignoreChange=!0;i=n.lastChild;)n.removeChild(i);n.append(t),this._undoIndex=-1,this._undoStack.length=0,this._undoStackLength=0,this._isInUndoState=!1;const r=this._getRangeAndRemoveBookmark()||he(n.firstElementChild||n,0);return this.saveUndoState(r),this.setSelection(r),this._updatePath(r,!0),this}insertHTML(e,t){const n=this._config;let o=n.sanitizeToDOMFragment(e,this);const i=this.getSelection();this.saveUndoState(i);try{const r=this._root;n.addLinks&&this.addDetectedLinks(o,o),W(o,this._config),K(o),z(o),o.normalize();let s=o;for(;s=ie(s,o);)Z(s);let a=!0;if(t){const t=new CustomEvent("willPaste",{cancelable:!0,detail:{html:e,fragment:o}});this.fireEvent("willPaste",t),o=t.detail.fragment,a=!t.defaultPrevented}a&&(((e,t,n)=>{const o=t.firstChild&&m(t.firstChild);let i;for(Q(t),i=t;i=ie(i,n);)Z(i);e.collapsed||ge(e,n),M(e),e.collapse(!1);const r=A(e.endContainer,n,"BLOCKQUOTE")||n;let s=se(e,n),a=null;const l=ie(t,t),c=!o&&!!s&&re(s);if(s&&l&&!c&&!A(l,t,"PRE")&&!A(l,t,"TABLE")){P(e,s,s,n),e.collapse(!0);let t=e.endContainer,o=e.endOffset;if(K(s),m(t)){const e=X(t,o,oe(t,n)||n,n);t=e.parentNode,o=Array.from(t.childNodes).indexOf(e)}if(o!==N(t))for(a=document.createDocumentFragment();i=t.childNodes[o];)a.append(i);ee(t,l,e,n),o=Array.from(t.parentNode.childNodes).indexOf(t)+1,t=t.parentNode,e.setEnd(t,o)}if(N(t)){c&&s&&(e.setEndBefore(s),e.collapse(!1),T(s)),P(e,r,r,n);let o=X(e.endContainer,e.endOffset,r,n);const i=o?o.previousSibling:r.lastChild;r.insertBefore(t,o),o?e.setEndBefore(o):e.setEnd(r,N(r)),s=ae(e,n),M(e);const a=e.endContainer,l=e.endOffset;o&&C(o)&&te(o,n),o=i&&i.nextSibling,o&&C(o)&&te(o,n),e.setEnd(a,l)}if(a&&s){const t=e.cloneRange();Z(a),ee(s,a,t,n),e.setEnd(t.endContainer,t.endOffset)}M(e)})(i,o,r),i.collapse(!1),U(i,"A",r),this._ensureBottomLine()),this.setSelection(i),this._updatePath(i,!0),t&&this.focus()}catch(e){this._config.didError(e)}return this}insertElement(e,t){if(t||(t=this.getSelection()),t.collapse(!0),m(e))ue(t,e),t.setStartAfter(e);else{const n=this._root,o=se(t,n);let i=o||n,r=null;for(;i!==n&&!i.nextSibling;)i=i.parentNode;if(i!==n){const e=i.parentNode;r=X(e,i.nextSibling,n,n)}o&&re(o)&&T(o),n.insertBefore(e,r);const s=this.createDefaultBlock();n.insertBefore(s,r),t.setStart(s,0),t.setEnd(s,0),M(t)}return this.focus(),this.setSelection(t),this._updatePath(t),this}insertImage(e,t){const n=y("IMG",Object.assign({src:e},t));return this.insertElement(n),n}insertPlainText(e,t){const n=this.getSelection();if(n.collapsed&&A(n.startContainer,this._root,"PRE")){const o=n.startContainer;let i,r=n.startOffset;if(o&&o instanceof Text)i=o;else{const e=document.createTextNode("");o.insertBefore(e,o.childNodes[r]),i=e,r=0}let s=!0;if(t){const t=new CustomEvent("willPaste",{cancelable:!0,detail:{text:e}});this.fireEvent("willPaste",t),e=t.detail.text,s=!t.defaultPrevented}return s&&(i.insertData(r,e),n.setStart(i,r+e.length),n.collapse(!0)),this.setSelection(n),this}const o=e.split("\n"),i=this._config.blockTag,r="</"+i+">",s="<"+i+">";for(let e=0,t=o.length;e<t;++e){let t=o[e];t=G(t).replace(/ (?=(?: |$))/g,"&nbsp;"),e&&(t=s+(t||"<BR>")+r),o[e]=t}return this.insertHTML(o.join(""),t)}getSelectedText(e){return me(e||this.getSelection())}getFontInfo(e){const t={color:void 0,backgroundColor:void 0,fontFamily:void 0,fontSize:void 0};e||(e=this.getSelection()),M(e);let n=0,o=e.commonAncestorContainer;if(e.collapsed||o instanceof Text)for(o instanceof Text&&(o=o.parentNode);n<4&&o;){const e=o.style;if(e){const o=e.color;!t.color&&o&&(t.color=o,++n);const i=e.backgroundColor;!t.backgroundColor&&i&&(t.backgroundColor=i,++n);const r=e.fontFamily;!t.fontFamily&&r&&(t.fontFamily=r,++n);const s=e.fontSize;!t.fontSize&&s&&(t.fontSize=s,++n)}o=o.parentNode}return t}hasFormat(e,n,o){e=e.toUpperCase(),n||(n={}),o||(o=this.getSelection()),!o.collapsed&&o.startContainer instanceof Text&&o.startOffset===o.startContainer.length&&o.startContainer.nextSibling&&o.setStartBefore(o.startContainer.nextSibling),!o.collapsed&&o.endContainer instanceof Text&&0===o.endOffset&&o.endContainer.previousSibling&&o.setEndAfter(o.endContainer.previousSibling);const i=this._root,r=o.commonAncestorContainer;if(E(r,i,e,n))return!0;if(r instanceof Text)return!1;const s=t(r,4,e=>I(o,e,!0));let a,l=!1;for(;a=s.nextNode();){if(!E(a,i,e,n))return!1;l=!0}return l}changeFormat(e,t,n,o){return n||(n=this.getSelection()),this.saveUndoState(n),t&&(n=this._removeFormat(t.tag.toUpperCase(),t.attributes||{},n,o)),e&&(n=this._addFormat(e.tag.toUpperCase(),e.attributes||{},n)),this.setSelection(n),this._updatePath(n,!0),this.focus()}_addFormat(n,o,i){const r=this._root;if(i.collapsed){const e=Z(y(n,o));ue(i,e);const t=e.firstChild||e,r=t instanceof Text?t.length:0;i.setStart(t,r),i.collapse(!0);let s=e;for(;m(s);)s=s.parentNode;B(s,e)}else{const s=t(i.commonAncestorContainer,5,e=>(e instanceof Text||"BR"===e.nodeName||"IMG"===e.nodeName)&&I(i,e,!0));let{startContainer:a,startOffset:l,endContainer:c,endOffset:h}=i;if(s.currentNode=a,!((a instanceof Element||a instanceof Text)&&e===s.filter.acceptNode(a))){const e=s.nextNode();if(!e)return i;a=e,l=0}do{let e=s.currentNode;if(!E(e,r,n,o)){e===c&&e.length>h&&e.splitText(h),e===a&&l&&(e=e.splitText(l),c===a?(c=e,h-=l):c===a.parentNode&&++h,a=e,l=0);const t=y(n,o);L(e,t),t.append(e)}}while(s.nextNode());i=he(a,l,c,h)}return i}_removeFormat(e,t,o,i){let r;this._saveRangeToBookmark(o),o.collapsed&&(r=l?document.createTextNode(n):document.createTextNode(""),ue(o,r));let s=o.commonAncestorContainer;for(;m(s);)s=s.parentNode;const a=o.startContainer,c=o.startOffset,h=o.endContainer,u=o.endOffset,f=[],p=(e,t)=>{if(I(o,e,!1))return;let n,i;if(I(o,e,!0))if(e instanceof Text)e===h&&u!==e.length&&f.push([t,e.splitText(u)]),e===a&&c&&(e.splitText(c),f.push([t,e]));else for(n=e.firstChild;n;n=i)i=n.nextSibling,p(n,t);else e instanceof HTMLInputElement||e instanceof Text&&!e.data||f.push([t,e])},g=Array.from(s.getElementsByTagName(e)).filter(n=>I(o,n,!0)&&k(n,e,t));if(i||g.forEach(e=>p(e,e)),f.forEach(([e,t])=>{e=e.cloneNode(!1),L(t,e),e.append(t)}),g.forEach(e=>L(e,x(e))),l&&r){r=r.parentNode;let e=r;for(;e&&m(e);)e=e.parentNode;e&&B(e,r)}return this._getRangeAndRemoveBookmark(o),r&&o.collapse(!1),J(s,o),o}bold(){this.toggleTag("B")}italic(){this.toggleTag("I")}underline(){this.toggleTag("U")}strikethrough(){this.toggleTag("S")}subscript(){this.toggleTag("SUB","SUP")}superscript(){this.toggleTag("SUP","SUB")}makeLink(e,t){const n=this.getSelection();if(n.collapsed){let t=e.indexOf(":")+1;if(t)for(;"/"===e[t];)++t;ue(n,document.createTextNode(e.slice(t)))}return t=Object.assign({href:e},t),this.changeFormat({tag:"A",attributes:t},{tag:"A"},n)}removeLink(){return this.changeFormat(null,{tag:"A"},this.getSelection(),!0)}addDetectedLinks(e,n){const o=t(e,4,e=>!A(e,n||this._root,"A")),i=this.linkRegExp;let r;for(;r=o.nextNode();){const e=r.parentNode;let t,n=r.data;for(;t=i.exec(n);){const o=t.index,i=o+t[0].length;o&&e.insertBefore(document.createTextNode(n.slice(0,o)),r);const s=y("A",{href:t[1]?/^(?:ht|f)tps?:/i.test(t[1])?t[1]:"http://"+t[1]:"mailto:"+t[0]});s.textContent=n.slice(o,i),e.insertBefore(s,r),r.data=n=n.slice(i)}}return this}_ensureBottomLine(){const e=this._root,t=e.lastElementChild;t&&t.nodeName===this._config.blockTag&&v(t)||e.append(this.createDefaultBlock())}createDefaultBlock(e){const t=this._config;return Z(y(t.blockTag,null,e))}splitBlock(e,t){t||(t=this.getSelection());const o=this._root;let i,r,s,a;if(this._recordUndoState(t),this._removeZWS(),this._getRangeAndRemoveBookmark(t),t.collapsed||ge(t,o),this._config.addLinks){M(t);const e=t.startContainer,n=t.startOffset;setTimeout(()=>{we(this,e,n)},0)}if(i=se(t,o),i&&(r=A(i,o,"PRE"))){M(t),s=t.startContainer;const n=t.startOffset;return s instanceof Text||(s=document.createTextNode(""),r.insertBefore(s,r.firstChild)),!e&&s instanceof Text&&("\n"===s.data.charAt(n-1)||ce(t,o))&&("\n"===s.data.charAt(n)||de(t,o))?(s.deleteData(n&&n-1,n?2:1),a=X(s,n&&n-1,o,o),s=a.previousSibling,s.textContent||T(s),s=this.createDefaultBlock(),a.parentNode.insertBefore(s,a),a.textContent||T(a),t.setStart(s,0)):(s.insertData(n,"\n"),Z(r),s.length===n+1?t.setStartAfter(s):t.setStart(s,n+1)),t.collapse(!0),this.setSelection(t),this._updatePath(t,!0),this._docWasChanged(),this}if(!i||e||/^T[HD]$/.test(i.nodeName))return U(t,"A",o),ue(t,y("BR")),t.collapse(!1),this.setSelection(t),this._updatePath(t,!0),this;if((r=A(i,o,"LI"))&&(i=r),re(i)){if(A(i,o,"UL")||A(i,o,"OL"))return this.decreaseListLevel(t),this;if(A(i,o,"BLOCKQUOTE"))return this.replaceWithBlankLine(t),this}s=t.startContainer;const l=t.startOffset;let c=this.tagAfterSplit[i.nodeName]||this._config.blockTag;for(a=X(s,l,i.parentNode,this._root),k(a,c)||(i=y(c),a.dir&&(i.dir=a.dir),L(a,i),i.append(x(a)),a=i),B(i),z(i),Z(i);a instanceof Element;){let e,t=a.firstChild;if("A"===a.nodeName&&(!a.textContent||a.textContent===n)){t=document.createTextNode(""),L(a,t),a=t;break}for(;t&&t instanceof Text&&!t.length&&(e=t.nextSibling,e&&"BR"!==e.nodeName);)T(t),t=e;if(!t||"BR"===t.nodeName||t instanceof Text)break;a=t}return t=he(a,0),this.setSelection(t),this._updatePath(t,!0),this}forEachBlock(e,t,n){n||(n=this.getSelection()),t&&this.saveUndoState(n);const o=this._root;let i=se(n,o);const r=ae(n,o);if(i&&r)do{if(e(i)||i===r)break}while(i=ie(i,o));return t&&(this.setSelection(n),this._updatePath(n,!0)),this}modifyBlocks(e,t){t||(t=this.getSelection()),this._recordUndoState(t,this._isInUndoState);const n=this._root;((e,t)=>{const n=se(e,t),o=ae(e,t);let i;n&&o&&(i=n.parentNode,e.setStart(i,Array.from(i.childNodes).indexOf(n)),i=o.parentNode,e.setEnd(i,Array.from(i.childNodes).indexOf(o)+1))})(t,n),P(t,n,n,n);const o=fe(t,n,n);if(!t.collapsed){let e=t.endContainer;if(e===n)t.collapse(!1);else{for(;e.parentNode!==n;)e=e.parentNode;t.setStartBefore(e),t.collapse(!0)}}return ue(t,e.call(this,o)),t.endOffset<t.endContainer.childNodes.length&&te(t.endContainer.childNodes[t.endOffset],n),te(t.startContainer.childNodes[t.startOffset],n),this._getRangeAndRemoveBookmark(t),this.setSelection(t),this._updatePath(t,!0),this}setTextAlignment(e){return this.forEachBlock(t=>{const n=t.className.split(/\s+/).filter(e=>!!e&&!/^align/.test(e)).join(" ");e?(t.className=n+" align-"+e,t.style.textAlign=e):(t.className=n,t.style.textAlign="")},!0),this.focus()}setTextDirection(e){return this.forEachBlock(t=>{e?t.dir=e:t.removeAttribute("dir")},!0),this.focus()}_getListSelection(e,t){let n=e.commonAncestorContainer,o=e.startContainer,i=e.endContainer;for(;n&&n!==t&&!/^[OU]L$/.test(n.nodeName);)n=n.parentNode;if(!n||n===t)return null;for(o===n&&(o=o.childNodes[e.startOffset]),i===n&&(i=i.childNodes[e.endOffset]);o&&o.parentNode!==n;)o=o.parentNode;for(;i&&i.parentNode!==n;)i=i.parentNode;return[n,o,i]}increaseListLevel(e){e||(e=this.getSelection());const t=this._root,n=this._getListSelection(e,t);if(!n)return this.focus();let[o,i,r]=n;if(!i||i===o.firstChild)return this.focus();this._recordUndoState(e,this._isInUndoState);const s=o.nodeName;let a,l=i.previousSibling;l.nodeName!==s&&(l=y(s),o.insertBefore(l,i));do{a=i===r?null:i.nextSibling,l.append(i)}while(i=a);return a=l.nextSibling,a&&te(a,t),this._getRangeAndRemoveBookmark(e),this.setSelection(e),this._updatePath(e,!0),this.focus()}decreaseListLevel(e){e||(e=this.getSelection());const t=this._root,n=this._getListSelection(e,t);if(!n)return this.focus();let o,[i,r,s]=n;r||(r=i.firstChild),s||(s=i.lastChild),this._recordUndoState(e,this._isInUndoState);let a=null;if(r){let e=i.parentNode;if(a=s.nextSibling?X(i,s.nextSibling,e,t):i.nextSibling,e!==t&&"LI"===e.nodeName){for(e=e.parentNode;a;)o=a.nextSibling,s.append(a),a=o;a=i.parentNode.nextSibling}const n=!/^[OU]L$/.test(e.nodeName);do{o=r===s?null:r.nextSibling,i.removeChild(r),n&&"LI"===r.nodeName&&(r=this.createDefaultBlock([x(r)])),e.insertBefore(r,a)}while(r=o)}return i.firstChild||T(i),a&&te(a,t),this._getRangeAndRemoveBookmark(e),this.setSelection(e),this._updatePath(e,!0),this.focus()}_makeList(e,t){const n=ne(e,this._root);let o;for(;o=n.nextNode();)if(o.parentNode instanceof HTMLLIElement&&(o=o.parentNode,n.currentNode=o.lastChild),o instanceof HTMLLIElement){o=o.parentNode;const e=o.nodeName;e!==t&&/^[OU]L$/.test(e)&&L(o,y(t,null,[x(o)]))}else{const e=y("LI");o.dir&&(e.dir=o.dir);const i=o.previousSibling;i&&i.nodeName===t?(i.append(e),T(o)):L(o,y(t,null,[e])),e.append(x(o)),n.currentNode=e}return e}makeUnorderedList(){return this.modifyBlocks(e=>this._makeList(e,"UL")),this.focus()}makeOrderedList(){return this.modifyBlocks(e=>this._makeList(e,"OL")),this.focus()}removeList(){return this.modifyBlocks(e=>{const t=e.querySelectorAll("UL, OL"),n=e.querySelectorAll("LI");this._root;for(let e=0,n=t.length;e<n;++e){const n=t[e],o=x(n);Q(o),L(n,o)}for(let e=0,t=n.length;e<t;++e){const t=n[e];v(t)?L(t,this.createDefaultBlock([x(t)])):(Q(t),L(t,x(t)))}return e}),this.focus()}increaseQuoteLevel(e){return this.modifyBlocks(e=>y("BLOCKQUOTE",null,[e]),e),this.focus()}decreaseQuoteLevel(e){return this.modifyBlocks(e=>(Array.from(e.querySelectorAll("blockquote")).filter(t=>!A(t.parentNode,e,"BLOCKQUOTE")).forEach(e=>{L(e,x(e))}),e),e),this.focus()}removeQuote(e){return this.modifyBlocks(e=>(Array.from(e.querySelectorAll("blockquote")).forEach(e=>{L(e,x(e))}),e),e),this.focus()}replaceWithBlankLine(e){return this.modifyBlocks(()=>this.createDefaultBlock([y("INPUT",{id:this.startSelectionId,type:"hidden"}),y("INPUT",{id:this.endSelectionId,type:"hidden"})]),e),this.focus()}code(){const e=this.getSelection();return e.collapsed||C(e.commonAncestorContainer)?(this.modifyBlocks(e=>{const n=this._root,o=document.createDocumentFragment(),i=ne(e,n);let r;for(;r=i.nextNode();){let e=r.querySelectorAll("BR");const t=[];let n=e.length;for(let o=0;o<n;++o)t[o]=R(e[o]);for(;n--;){const o=e[n];t[n]?L(o,document.createTextNode("\n")):T(o)}for(e=r.querySelectorAll("CODE"),n=e.length;n--;)L(e[n],x(e[n]));o.childNodes.length&&o.append(document.createTextNode("\n")),o.append(x(r))}const s=t(o,4);for(;r=s.nextNode();)r.data=r.data.replace(/ /g," ");return o.normalize(),Z(y("PRE",null,[o]))},e),this.focus()):this.changeFormat({tag:"CODE",attributes:null},null,e),this}removeCode(){const e=this.getSelection(),n=e.commonAncestorContainer;return A(n,this._root,"PRE")?(this.modifyBlocks(e=>{this._root;const n=e.querySelectorAll("PRE");let o=n.length;for(;o--;){const e=n[o],i=t(e,4);let r;for(;r=i.nextNode();){let e=r.data;e=e.replace(/ (?= )/g," ");const t=document.createDocumentFragment();let n;for(;(n=e.indexOf("\n"))>-1;)t.append(document.createTextNode(e.slice(0,n))),t.append(y("BR")),e=e.slice(n+1);r.parentNode.insertBefore(t,r),r.data=e}Q(e),L(e,x(e))}return e},e),this.focus()):this.changeFormat(null,{tag:"CODE"},e),this}toggleCode(){return this.hasFormat("PRE")||this.hasFormat("CODE")?this.removeCode():this.code(),this}changeIndentationLevel(e){let t=this.getSelectionClosest("UL,OL,BLOCKQUOTE");if(t||"increase"===e)return this[(e+=t&&"BLOCKQUOTE"!==t.nodeName?"List":"Quote")+"Level"]()}getSelectionClosest(e){return A(this.getSelection().commonAncestorContainer,this._root,e)}setAttribute(e,t){let n=this.getSelection(),o=n?.startContainer||{},i=n?.endContainer||{};if("dir"==e||o instanceof Text&&0===n.startOffset&&o===i&&i.length===n.endOffset)this._recordUndoState(n),O(o.parentNode,{[e]:t}),this._docWasChanged();else if(null==t){this._recordUndoState(n);let o=A(n.commonAncestorContainer,this._root,"*");n.collapsed?O(o,{[e]:t}):o.querySelectorAll("*").forEach(n=>O(n,{[e]:t})),this._docWasChanged()}else this.changeFormat({tag:"SPAN",attributes:{[e]:t}},null,n);return this.focus()}setStyle(e){this.setAttribute("style",e)}toggleTag(e,t){let n=this.getSelection();this.hasFormat(e,null,n)?this.changeFormat(null,{tag:e},n):this.changeFormat({tag:e},t?{tag:t}:null,n)}setRange(e){this.setSelection(e),this._updatePath(e,!0)}setConfig(e){return this._config=mergeObjects({addLinks:!0},e,!0),this}}})(),(()=>{"use strict";const e=2147483647,t=36,n=/^xn--/,o=/[^\0-\x7F]/,i=/[\x2E\u3002\uFF0E\uFF61]/g,r={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},s=Math.floor,a=String.fromCharCode,l=e=>{throw new RangeError(r[e])},c=(e,t)=>{const n=(e||"").split("@");return n.push(n.pop().split(i).map(e=>t(e)).join(".")),n.join("@")},h=e=>e>=48&&e<58?e-48+26:e>=65&&e<91?e-65:e>=97&&e<123?e-97:t,u=(e,t)=>e+22+75*(e<26)-((0!=t)<<5),f=(e,n,o)=>{let i=0;for(e=o?s(e/700):e>>1,e+=s(e/n);e>455;i+=t)e=s(e/35);return s(i+36*e/(e+38))};window.IDN={version:"2.3.1",toUnicode:o=>c(o,o=>n.test(o)?(n=>{const o=[],i=n.length;let r=0,a=128,c=72,u=n.lastIndexOf("-");u<0&&(u=0);for(let e=0;e<u;++e)n.charCodeAt(e)>=128&&l("not-basic"),o.push(n.charCodeAt(e));for(let p=u>0?u+1:0;p<i;){const u=r;for(let o=1,a=t;;a+=t){p>=i&&l("invalid-input");const u=h(n.charCodeAt(p++));u>=t&&l("invalid-input"),u>s((e-r)/o)&&l("overflow"),r+=u*o;const f=a<=c?1:a>=c+26?26:a-c;if(u<f)break;const g=t-f;o>s(e/g)&&l("overflow"),o*=g}const g=o.length+1;c=f(r-u,g,0==u),s(r/g)>e-a&&l("overflow"),a+=s(r/g),r%=g,o.splice(r++,0,a)}return String.fromCodePoint(...o)})(o.slice(4).toLowerCase()):o),toASCII:n=>c(n,n=>(o.test(n)?"xn--"+(n=>{const o=[];n=(e=>{const t=[];let n=0;const o=e.length;for(;n<o;){const i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<o){const o=e.charCodeAt(n++);56320==(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t})(n);const i=n.length;let r=128,c=0,h=72;for(const e of n)e<128&&o.push(a(e));const p=o.length;let g=p;for(p&&o.push("-");g<i;){let i=e;for(const e of n)e>=r&&e<i&&(i=e);const m=g+1;i-r>s((e-c)/m)&&l("overflow"),c+=(i-r)*m,r=i;for(const i of n)if(i<r&&++c>e&&l("overflow"),i===r){let e=c;for(let n=t;;n+=t){const i=n<=h?1:n>=h+26?26:n-h;if(e<i)break;const r=e-i,l=t-i;o.push(a(u(i+r%l,0))),e=s(r/l)}o.push(a(u(e,0))),h=f(c,m,g===p),c=0,++g}++c,++r}return o.join("")})(n):n).toLowerCase())}})();const TurndownService=(()=>{const e=(e,t)=>Array(t+1).join(e),t=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"],n=e=>s(e,t),o=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"],i=e=>s(e,o),r=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"],s=(e,t)=>t.indexOf(e.nodeName)>=0,a=(e,t)=>e.getElementsByTagName&&t.some(t=>e.getElementsByTagName(t).length),l={paragraph:{filter:"p",replacement:e=>"\n\n"+e+"\n\n"},lineBreak:{filter:"br",replacement:(e,t,n)=>n.br+"\n"},heading:{filter:["h1","h2","h3","h4","h5","h6"],replacement:(t,n,o)=>{var i=Number(n.nodeName.charAt(1));return"setext"===o.headingStyle&&i<3?"\n\n"+t+"\n"+e(1===i?"=":"-",t.length)+"\n\n":"\n\n"+e("#",i)+" "+t+"\n\n"}},blockquote:{filter:"blockquote",replacement:e=>"\n\n"+(e=(e=e.replace(/^\n+|\n+$/g,"")).replace(/^/gm,"> "))+"\n\n"},list:{filter:["ul","ol"],replacement:(e,t)=>{var n=t.parentNode;return"LI"===n.nodeName&&n.lastElementChild===t?"\n"+e:"\n\n"+e+"\n\n"}},listItem:{filter:"li",replacement:(e,t,n)=>{e=e.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");var o=n.bulletListMarker+"   ",i=t.parentNode;if("OL"===i.nodeName){var r=i.getAttribute("start"),s=Array.prototype.indexOf.call(i.children,t);o=(r?Number(r)+s:s+1)+".  "}return o+e+(t.nextSibling&&!/\n$/.test(e)?"\n":"")}},indentedCodeBlock:{filter:(e,t)=>"indented"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName,replacement:(e,t)=>"\n\n    "+t.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"},fencedCodeBlock:{filter:(e,t)=>"fenced"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName,replacement:(t,n,o)=>{for(var i,r=((n.firstChild.getAttribute("class")||"").match(/language-(\S+)/)||[null,""])[1],s=n.firstChild.textContent,a=o.fence.charAt(0),l=3,c=new RegExp("^"+a+"{3,}","gm");i=c.exec(s);)i[0].length>=l&&(l=i[0].length+1);var h=e(a,l);return"\n\n"+h+r+"\n"+s.replace(/\n$/,"")+"\n"+h+"\n\n"}},horizontalRule:{filter:"hr",replacement:(e,t,n)=>"\n\n"+n.hr+"\n\n"},inlineLink:{filter:(e,t)=>"inlined"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href"),replacement:(e,t)=>{var n=t.getAttribute("href");n&&(n=n.replace(/([()])/g,"\\$1"));var o=c(t.getAttribute("title"));return o&&(o=' "'+o.replace(/"/g,'\\"')+'"'),"["+e+"]("+n+o+")"}},referenceLink:{filter:(e,t)=>"referenced"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href"),replacement(e,t,n){var o,i,r=t.getAttribute("href"),s=c(t.getAttribute("title"));switch(s&&(s=' "'+s+'"'),n.linkReferenceStyle){case"collapsed":o="["+e+"][]",i="["+e+"]: "+r+s;break;case"shortcut":o="["+e+"]",i="["+e+"]: "+r+s;break;default:var a=this.references.length+1;o="["+e+"]["+a+"]",i="["+a+"]: "+r+s}return this.references.push(i),o},references:[],append(){var e="";return this.references.length&&(e="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),e}},emphasis:{filter:["em","i"],replacement:(e,t,n)=>e.trim()?n.emDelimiter+e+n.emDelimiter:""},strong:{filter:["strong","b"],replacement:(e,t,n)=>e.trim()?n.strongDelimiter+e+n.strongDelimiter:""},code:{filter:e=>{var t=e.previousSibling||e.nextSibling,n="PRE"===e.parentNode.nodeName&&!t;return"CODE"===e.nodeName&&!n},replacement:e=>{if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",n="`",o=e.match(/`+/gm)||[];-1!==o.indexOf(n);)n+="`";return n+t+e+t+n}},image:{filter:"img",replacement:(e,t)=>{var n=c(t.getAttribute("alt")),o=t.getAttribute("src")||"",i=c(t.getAttribute("title"));return o?"!["+n+"]("+o+(i?' "'+i+'"':"")+")":""}},style:{filter:"style",replacement:()=>""}},c=e=>e?e.replace(/(\n+\s*)+/g,"\n"):"";class Rules{constructor(e){for(var t in this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[],e.rules)this.array.push(e.rules[t])}add(e,t){this.array.unshift(t)}keep(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})}remove(e){this._remove.unshift({filter:e,replacement:()=>""})}forNode(e){return e.isBlank?this.blankRule:h(this.array,e,this.options)||h(this._keep,e,this.options)||h(this._remove,e,this.options)||this.defaultRule}forEach(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}}const h=(e,t,n)=>{for(var o=0;o<e.length;o++){var i=e[o];if(u(i,t,n))return i}},u=(e,t,n)=>{var o=e.filter;if("string"==typeof o)return o===t.nodeName.toLowerCase();if(Array.isArray(o))return o.indexOf(t.nodeName.toLowerCase())>-1;if("function"==typeof o)return!!o.call(e,t,n);throw new TypeError("`filter` needs to be a string, array, or function")},f=e=>{var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t},p=(e,t,n)=>e&&e.parentNode===t||n(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode,g=(e,t)=>{var o;"string"==typeof e?o=v().parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html").getElementById("turndown-root"):o=e.cloneNode(!0);return(e=>{var t=e.element,n=e.isBlock,o=e.isVoid,i=e.isPre||(e=>"PRE"===e.nodeName);if(t.firstChild&&!i(t)){for(var r=null,s=!1,a=null,l=p(a,t,i);l!==t;){if(3===l.nodeType||4===l.nodeType){var c=l.data.replace(/[ \r\n\t]+/g," ");if(r&&!/ $/.test(r.data)||s||" "!==c[0]||(c=c.substr(1)),!c){l=f(l);continue}l.data=c,r=l}else{if(1!==l.nodeType){l=f(l);continue}n(l)||"BR"===l.nodeName?(r&&(r.data=r.data.replace(/ $/,"")),r=null,s=!1):o(l)||i(l)?(r=null,s=!0):r&&(s=!1)}var h=p(a,l,i);a=l,l=h}r&&(r.data=r.data.replace(/ $/,""),r.data||f(r))}})({element:o,isBlock:n,isVoid:i,isPre:t.preformattedCode?C:null}),o};var m;const v=()=>m=m||new DOMParser,C=e=>"PRE"===e.nodeName||"CODE"===e.nodeName,y=e=>!i(e)&&!(e=>s(e,r))(e)&&/^\s*$/i.test(e.textContent)&&!(e=>a(e,o))(e)&&!(e=>a(e,r))(e),S=(e,t)=>{if(e.isBlock||t.preformattedCode&&e.isCode)return{leading:"",trailing:""};var n=k(e.textContent);return n.leadingAscii&&E("left",e,t)&&(n.leading=n.leadingNonAscii),n.trailingAscii&&E("right",e,t)&&(n.trailing=n.trailingNonAscii),{leading:n.leading,trailing:n.trailing}},k=e=>{var t=e.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:t[1],leadingAscii:t[2],leadingNonAscii:t[3],trailing:t[4],trailingNonAscii:t[5],trailingAscii:t[6]}},E=(e,t,o)=>{var i,r,s;return"left"===e?(i=t.previousSibling,r=/ $/):(i=t.nextSibling,r=/^ /),i&&(3===i.nodeType?s=r.test(i.nodeValue):o.preformattedCode&&"CODE"===i.nodeName?s=!1:1!==i.nodeType||n(i)||(s=r.test(i.textContent))),s},_=Array.prototype.reduce,w=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];const N=(e,t)=>{var n=(e=>{for(var t=e.length;t>0&&"\n"===e[t-1];)t--;return e.substring(0,t)})(e),o=t.replace(/^\n*/,""),i=Math.max(e.length-n.length,t.length-o.length);return n+"\n\n".substring(0,i)+o},x=e=>null!=e&&("string"==typeof e||e.nodeType&&(1===e.nodeType||9===e.nodeType||11===e.nodeType));return class TurndownService{constructor(e){this.options=Object.assign({rules:l,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:(e,t)=>t.isBlock?"\n\n":"",keepReplacement:(e,t)=>t.isBlock?"\n\n"+t.outerHTML+"\n\n":t.outerHTML,defaultReplacement:(e,t)=>t.isBlock?"\n\n"+e+"\n\n":e},e),this.rules=new Rules(this.options)}turndown(e){if(!x(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(""===e)return"";var t=this.process(g(e,this.options));return this.postProcess(t)}use(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else{if("function"!=typeof e)throw new TypeError("plugin must be a Function or an Array of Functions");e(this)}return this}addRule(e,t){return this.rules.add(e,t),this}keep(e){return this.rules.keep(e),this}remove(e){return this.rules.remove(e),this}escape(e){return w.reduce((e,t)=>e.replace(t[0],t[1]),e)}process(e){var t=this;return _.call(e.childNodes,(e,o)=>{var i="";return 3===(o=((e,t)=>(e.isBlock=n(e),e.isCode="CODE"===e.nodeName||e.parentNode.isCode,e.isBlank=y(e),e.flankingWhitespace=S(e,t),e))(o,t.options)).nodeType?i=o.isCode?o.nodeValue:t.escape(o.nodeValue):1===o.nodeType&&(i=t.replacementForNode(o)),N(e,i)},"")}postProcess(e){var t=this;return this.rules.forEach(n=>{"function"==typeof n.append&&(e=N(e,n.append(t.options)))}),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}replacementForNode(e){var t=this.rules.forNode(e),n=this.process(e),o=e.flankingWhitespace;return(o.leading||o.trailing)&&(n=n.trim()),o.leading+t.replacement(n,e,this.options)+o.trailing}}})();(e=>{const t=(e,t)=>rl.i18n(e)||t,n=shortcuts.getMetaKey()+" + ",o=t=>e.createElement(t),i=o("template"),r=e=>e.trim().replace(/^(<div>\s*<br\s*\/?>\s*<\/div>)+/,"").trim(),s=e=>rl.Utils.htmlToPlain(e).trim(),a=e=>rl.Utils.plainToHtml(e),l=(e,t)=>Object.values(e).forEach(t),c={sanitizeToDOMFragment:(e,t)=>(e=(e||"").replace(/<\/?(BODY|HTML)[^>]*>/gi,"").replace(/<!--[^>]+-->/g,"").replace(/<span[^>]*>\s*<\/span>/gi,"").trim(),i.innerHTML=t?rl.Utils.cleanHtml(e).html:e,i.content)};this.SquireUI=class SquireUI{constructor(i){const r=o("input"),s=e=>t=>{r.style.left=t.offsetLeft+t.parentNode.offsetLeft+"px",r.style.width=t.offsetWidth+"px",r.value="",r.onchange=()=>g.setStyle({[e]:r.value}),setTimeout(()=>r.click(),1)},a={mode:{plain:{select:[[t("SETTINGS_GENERAL/EDITOR_HTML"),"wysiwyg"],[t("SETTINGS_GENERAL/EDITOR_PLAIN"),"plain"]],cmd:e=>this.setMode("plain"==e.value?"plain":"wysiwyg")}},font:{fontFamily:{select:{"sans-serif":{Arial:"'Nimbus Sans L', 'Liberation sans', 'Arial Unicode MS', Arial, Helvetica, Garuda, Utkal, FreeSans, sans-serif",Tahoma:"'Luxi Sans', Tahoma, Loma, Geneva, Meera, sans-serif",Trebuchet:"'DejaVu Sans Condensed', Trebuchet, 'Trebuchet MS', sans-serif",Lucida:"'Lucida Sans Unicode', 'Lucida Sans', 'DejaVu Sans', 'Bitstream Vera Sans', 'DejaVu LGC Sans', sans-serif",Verdana:"'DejaVu Sans', Verdana, Geneva, 'Bitstream Vera Sans', 'DejaVu LGC Sans', sans-serif"},monospace:{Courier:"'Liberation Mono', 'Courier New', FreeMono, Courier, monospace",Lucida:"'DejaVu Sans Mono', 'DejaVu LGC Sans Mono', 'Bitstream Vera Sans Mono', 'Lucida Console', Monaco, monospace"},sans:{Times:"'Nimbus Roman No9 L', 'Times New Roman', Times, FreeSerif, serif",Palatino:"'Bitstream Charter', 'Palatino Linotype', Palatino, Palladio, 'URW Palladio L', 'Book Antiqua', Times, serif",Georgia:"'URW Palladio L', Georgia, Times, serif"}},cmd:e=>g.setStyle({fontFamily:e.value})},fontSize:{select:[["Размер",""],"11pt","13pt","16pt","20pt","24pt","30pt"],defaultValueIndex:0,cmd:e=>g.setStyle({fontSize:e.value})}},colors:{backgroundColor:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#clip0_8409_45302)">\n<g clip-path="url(#clip1_8409_45302)">\n<path d="M1.75 4H7.75M1.75 8H14.25M1.75 12H7.75" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M9.75 12L12.5603 3.56921C12.621 3.38687 12.879 3.38687 12.9397 3.56921L15.75 12" stroke="black" stroke-width="1.5" stroke-linecap="round"/>\n</g>\n</g>\n<defs>\n<clipPath id="clip0_8409_45302">\n<rect width="16" height="16" fill="white" transform="translate(0.75)"/>\n</clipPath>\n<clipPath id="clip1_8409_45302">\n<rect width="16" height="16" fill="white" transform="translate(0.75)"/>\n</clipPath>\n</defs>\n</svg>\n',cmd:s("backgroundColor")},textColor:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#clip0_8409_45314)">\n<path d="M6.875 8H9.875" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M3.09375 13.249H13.6279" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M5.375 11L8.18526 2.56921C8.24604 2.38687 8.50396 2.38687 8.56474 2.56921L11.375 11" stroke="black" stroke-width="1.5" stroke-linecap="round"/>\n</g>\n<defs>\n<clipPath id="clip0_8409_45314">\n<rect width="16" height="16" fill="white" transform="translate(0.375)"/>\n</clipPath>\n</defs>\n</svg>\n',cmd:s("color")}},inline:{bold:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#clip0_8610_19644)">\n<g clip-path="url(#clip1_8610_19644)">\n<path d="M5.08594 2.28125H9.33594C9.8982 2.28145 10.4489 2.44126 10.9238 2.74219C11.3988 3.04315 11.7783 3.47312 12.0186 3.98145C12.2588 4.48986 12.3502 5.05617 12.2812 5.61426C12.2123 6.17233 11.9857 6.6992 11.6289 7.13379L11.6055 7.16309L11.6387 7.18066C12.2638 7.52523 12.756 8.06841 13.0391 8.72363C13.3221 9.37903 13.3799 10.1103 13.2021 10.8018C13.0244 11.493 12.6215 12.1054 12.0576 12.543C11.4935 12.9805 10.7998 13.2184 10.0859 13.2188H5.08594C4.89531 13.2188 4.71292 13.1426 4.57812 13.0078C4.44333 12.873 4.36719 12.6906 4.36719 12.5V3C4.36719 2.80938 4.44333 2.62698 4.57812 2.49219C4.71292 2.3574 4.89531 2.28125 5.08594 2.28125ZM5.80469 11.7812H10.0859C10.5584 11.7812 11.0117 11.5938 11.3457 11.2598C11.6798 10.9257 11.8672 10.4724 11.8672 10C11.8672 9.52758 11.6798 9.07428 11.3457 8.74023C11.0117 8.40618 10.5584 8.21875 10.0859 8.21875H5.80469V11.7812ZM5.80469 6.78125H9.33594C9.74205 6.78125 10.1318 6.62017 10.4189 6.33301C10.7061 6.04584 10.8672 5.65611 10.8672 5.25C10.8672 4.84389 10.7061 4.45416 10.4189 4.16699C10.1318 3.87983 9.74205 3.71875 9.33594 3.71875H5.80469V6.78125Z" fill="black" stroke="black" stroke-width="0.0625"/>\n</g>\n</g>\n<defs>\n<clipPath id="clip0_8610_19644">\n<rect width="16" height="16" fill="white" transform="translate(0.0859375)"/>\n</clipPath>\n<clipPath id="clip1_8610_19644">\n<rect width="16" height="16" fill="white" transform="translate(0.0859375)"/>\n</clipPath>\n</defs>\n</svg>\n',cmd:()=>this.doAction("bold"),key:"B",matches:"B,STRONG"},italic:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#clip0_8610_33226)">\n<g clip-path="url(#clip1_8610_33226)">\n<path d="M6.08594 13L10.5859 3" stroke="black" stroke-width="1.5" stroke-linecap="round"/>\n<path d="M8.08594 3H12.5859" stroke="black" stroke-width="1.5" stroke-linecap="round"/>\n<path d="M4.08594 13H8.58594" stroke="black" stroke-width="1.5" stroke-linecap="round"/>\n</g>\n</g>\n<defs>\n<clipPath id="clip0_8610_33226">\n<rect width="16" height="16" fill="white" transform="translate(0.0859375)"/>\n</clipPath>\n<clipPath id="clip1_8610_33226">\n<rect width="16" height="16" fill="white" transform="translate(0.0859375)"/>\n</clipPath>\n</defs>\n</svg>\n',cmd:()=>this.doAction("italic"),key:"I",matches:"I"},underline:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#clip0_8610_35440)">\n<path d="M3.80022 2.42871V8.643C3.80022 9.67537 4.25175 10.313 5.05548 10.9158C5.85921 11.5186 6.9493 11.8573 8.08594 11.8573C9.22258 11.8573 10.3127 11.5186 11.1164 10.9158C11.9201 10.313 12.3717 9.49548 12.3717 8.643V2.42871M2.08594 14.4287H14.0859" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</g>\n<defs>\n<clipPath id="clip0_8610_35440">\n<rect width="16" height="16" fill="white" transform="translate(0.0859375)"/>\n</clipPath>\n</defs>\n</svg>',cmd:()=>this.doAction("underline"),key:"U",matches:"U"},strike:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M2.08594 8.00086H14.0859M11.5145 3.28657C11.3202 2.90939 10.8747 2.57655 10.2515 2.34286C9.62832 2.10916 8.86454 1.98854 8.08594 2.00086H7.22879C6.43315 2.00086 5.67008 2.31693 5.10747 2.87954C4.54487 3.44215 4.22879 4.20521 4.22879 5.00086C4.22879 5.79651 4.54487 6.55957 5.10747 7.12218C5.67008 7.68479 6.43315 8.00086 7.22879 8.00086H8.94308C9.73873 8.00086 10.5018 8.31693 11.0644 8.87954C11.627 9.44215 11.9431 10.2052 11.9431 11.0009C11.9431 11.7965 11.627 12.5596 11.0644 13.1222C10.5018 13.6848 9.73873 14.0009 8.94308 14.0009H7.65737C6.87877 14.0132 6.11499 13.8926 5.49179 13.6589C4.8686 13.4252 4.42315 13.0923 4.22879 12.7151" stroke="black" stroke-width="1.71429" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',cmd:()=>this.doAction("strikethrough"),key:"Shift + 7",matches:"S"},sub:{html:'<img src="/themes/forbion/images/sub.png" style="width: 17px; height: 17px;">',cmd:()=>this.doAction("subscript"),key:"Shift + 5",matches:"SUB"},sup:{html:'<img src="/themes/forbion/images/sup.png" style="width: 17px; height: 17px;">',cmd:()=>this.doAction("superscript"),key:"Shift + 6",matches:"SUP"}},block:{ol:{html:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#clip0_8610_9125)">\n<path d="M3.5 6V2L2 3.5" stroke="black" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M8 4L15 4" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M2 10.2206C2 8.5246 4 8.66312 4 10.2206C4 11.3966 2.64 12.3584 2 13C2 13 3.5 13 4.5 13" stroke="black" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M8 11H15" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</g>\n<defs>\n<clipPath id="clip0_8610_9125">\n<rect width="16" height="16" fill="white"/>\n</clipPath>\n</defs>\n</svg>\n',cmd:()=>this.doList("OL"),key:"Shift + 8",matches:"OL"},ul:{html:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#clip0_8610_40737)">\n<circle cx="2" cy="4" r="1" fill="black"/>\n<path d="M5 4L14 4L5 4Z" fill="black"/>\n<path d="M5 4L14 4" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n<circle cx="2" cy="8" r="1" fill="black"/>\n<path d="M5 8L14 8" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n<circle cx="2" cy="12" r="1" fill="black"/>\n<path d="M5 12L14 12" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</g>\n<defs>\n<clipPath id="clip0_8610_40737">\n<rect width="16" height="16" fill="white"/>\n</clipPath>\n</defs>\n</svg>\n',cmd:()=>this.doList("UL"),key:"Shift + 9",matches:"UL"},quote:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M4.75 3.78125H6.8125C7.086 3.78125 7.3486 3.88961 7.54199 4.08301C7.73539 4.2764 7.84375 4.539 7.84375 4.8125V8.9375C7.84375 9.95149 7.57769 10.7639 7.08496 11.3818C6.5915 12.0005 5.84596 12.4549 4.83398 12.708L4.83105 12.709C4.78717 12.7203 4.74116 12.7232 4.69629 12.7168C4.6515 12.7104 4.60824 12.695 4.56934 12.6719C4.53039 12.6487 4.49679 12.6174 4.46973 12.5811C4.44277 12.5448 4.42313 12.5038 4.41211 12.46C4.40109 12.416 4.39855 12.37 4.40527 12.3252C4.41201 12.2803 4.42772 12.2371 4.45117 12.1982C4.47461 12.1595 4.50549 12.1254 4.54199 12.0986C4.57851 12.0719 4.62008 12.0527 4.66406 12.042H4.66602C5.4773 11.8391 6.11221 11.4952 6.54004 10.9629C6.96912 10.4289 7.15625 9.74732 7.15625 8.9375V7.90625H4.75L4.65332 7.90137C4.42835 7.88028 4.21584 7.78569 4.04883 7.63086C3.88194 7.4761 3.77147 7.27141 3.7334 7.04883L3.72168 6.95215L3.71875 6.86328V4.8125C3.71875 4.539 3.82711 4.2764 4.02051 4.08301C4.2139 3.88961 4.4765 3.78125 4.75 3.78125ZM10.9375 3.78125H13C13.2735 3.78125 13.5361 3.88961 13.7295 4.08301C13.9229 4.2764 14.0312 4.539 14.0312 4.8125V8.9375C14.0312 9.95149 13.7652 10.7639 13.2725 11.3818C12.779 12.0005 12.0335 12.4549 11.0215 12.708L11.0186 12.709C10.9747 12.7203 10.9287 12.7232 10.8838 12.7168C10.839 12.7104 10.7957 12.695 10.7568 12.6719C10.7179 12.6487 10.6843 12.6174 10.6572 12.5811C10.6303 12.5448 10.6106 12.5038 10.5996 12.46C10.5886 12.416 10.586 12.37 10.5928 12.3252C10.5995 12.2803 10.6152 12.2371 10.6387 12.1982C10.6621 12.1595 10.693 12.1254 10.7295 12.0986C10.766 12.0719 10.8076 12.0527 10.8516 12.042H10.8535C11.6648 11.8391 12.2997 11.4952 12.7275 10.9629C13.1566 10.4289 13.3438 9.74732 13.3438 8.9375V7.90625H10.9375L10.8408 7.90137C10.6158 7.88028 10.4033 7.78569 10.2363 7.63086C10.0694 7.4761 9.95897 7.27141 9.9209 7.04883L9.90918 6.95215L9.90625 6.86328V4.8125C9.90625 4.539 10.0146 4.2764 10.208 4.08301C10.4014 3.88961 10.664 3.78125 10.9375 3.78125Z" fill="black" stroke="black" stroke-width="0.6875"/>\n</svg>\n',cmd:()=>{let e=g.getSelectionClosest("UL,OL,BLOCKQUOTE")?.nodeName;"BLOCKQUOTE"==e?g.decreaseQuoteLevel():g.increaseQuoteLevel()},matches:"BLOCKQUOTE"},indentDecrease:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M13.8346 4H9.16797M13.8346 8H7.83464M13.8346 12H9.16797M5.83464 5.33333L3.16797 8L5.83464 10.6667" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',cmd:()=>g.changeIndentationLevel("decrease"),key:"]"},indentIncrease:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M13.4596 4H6.1263M13.4596 8H8.79297M13.4596 12H6.1263M2.79297 5.33333L5.45964 8L2.79297 10.6667" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',cmd:()=>g.changeIndentationLevel("increase"),key:"["}},targets:{link:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#clip0_8610_29689)">\n<g clip-path="url(#clip1_8610_29689)">\n<path d="M5.95 7.8H11.55M6.65 5H4.55C3.80739 5 3.0952 5.295 2.5701 5.8201C2.045 6.3452 1.75 7.05739 1.75 7.8C1.75 8.54261 2.045 9.2548 2.5701 9.7799C3.0952 10.305 3.80739 10.6 4.55 10.6H6.65M10.85 5H12.95C13.6926 5 14.4048 5.295 14.9299 5.8201C15.455 6.3452 15.75 7.05739 15.75 7.8C15.75 8.54261 15.455 9.2548 14.9299 9.7799C14.4048 10.305 13.6926 10.6 12.95 10.6H10.85" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</g>\n</g>\n<defs>\n<clipPath id="clip0_8610_29689">\n<rect width="16" height="16" fill="white" transform="translate(0.75)"/>\n</clipPath>\n<clipPath id="clip1_8610_29689">\n<rect width="16" height="16" fill="white" transform="translate(0.75)"/>\n</clipPath>\n</defs>\n</svg>\n',cmd:()=>{let e=g.getSelectionClosest("A"),t=prompt("Link",e?.href||"https://");null!=t&&(t.length?g.makeLink(t):e&&g.removeLink())},matches:"A"},imageUrl:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M10.7083 4.88889H10.7161M1.375 3.33333C1.375 2.7145 1.62083 2.121 2.05842 1.68342C2.496 1.24583 3.0895 1 3.70833 1H13.0417C13.6605 1 14.254 1.24583 14.6916 1.68342C15.1292 2.121 15.375 2.7145 15.375 3.33333V12.6667C15.375 13.2855 15.1292 13.879 14.6916 14.3166C14.254 14.7542 13.6605 15 13.0417 15H3.70833C3.0895 15 2.496 14.7542 2.05842 14.3166C1.62083 13.879 1.375 13.2855 1.375 12.6667V3.33333Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M1.375 11.111L5.26389 7.22209C5.98567 6.52753 6.87544 6.52753 7.59722 7.22209L11.4861 11.111" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M9.92969 9.55553L10.7075 8.77775C11.4292 8.0832 12.319 8.0832 13.0408 8.77775L15.3741 11.1111" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',cmd:()=>{let e=g.getSelectionClosest("IMG"),t=prompt("Image",e?.src||"https://");t?.length?g.insertImage(t):e?.remove()},matches:"IMG"},imageUpload:{html:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M15 4.72274V12.6619C15 13.4009 14.4009 14 13.6619 14H2.33813C1.5991 14 1 13.4009 1 12.6619L1 3.33812C1 2.5991 1.5991 2 2.33813 2H8.17409C8.55792 2 8.92327 2.16483 9.17728 2.45259L9.60049 2.93203C9.8545 3.21979 10.2199 3.38462 10.6037 3.38462H13.6619C14.4009 3.38462 15 3.98371 15 4.72274Z" stroke="black" stroke-width="1.5"/>\n<path d="M1 8.74989V12.6619C1 13.4009 1.5991 14 2.33813 14H13.6619C14.4009 14 15 13.4009 15 12.6619V7.33812C15 6.5991 14.4009 6 13.6619 6H6.86607C6.52921 6 6.20475 6.12705 5.95745 6.35578L5.20044 7.05598C4.95315 7.28472 4.62868 7.41176 4.29183 7.41176H2.33812C1.5991 7.41176 1 8.01086 1 8.74989Z" stroke="black" stroke-width="1.5"/>\n</svg>\n',cmd:()=>p.click(),matches:"IMG"}},changes:{undo:{html:'\n<svg width="15" height="16" viewBox="0 0 15 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M3.63544 0.885742L1.42188 3.70301L3.63544 6.52023" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M1.42188 3.70312H9.30786C11.7026 3.70312 13.6696 6.11082 13.7629 9.15633C13.8616 12.3745 11.8384 15.0519 9.30786 15.0519H3.50883" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',cmd:()=>g.undo(),key:"Z"},redo:{html:'\n<svg width="15" height="17" viewBox="0 0 15 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M11.989 1.57324L14.2344 4.43094L11.989 7.28859" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M14.2344 4.43066H6.23521C3.80613 4.43066 1.81087 6.87291 1.71621 9.96213C1.61615 13.2265 3.66839 15.9423 6.23521 15.9423H12.1175" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',cmd:()=>g.redo(),key:"Y"},source:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#clip0_8600_37557)">\n<path d="M1.95233 8.93701C1.771 8.68834 1.68033 8.56367 1.61767 8.32367C1.57536 8.10997 1.57536 7.89005 1.61767 7.67634C1.68033 7.43567 1.771 7.31101 1.95233 7.06301C2.945 5.69967 5.121 3.33301 8.25233 3.33301C11.3837 3.33301 13.5597 5.69967 14.5523 7.06234C14.7337 7.31101 14.8243 7.43567 14.887 7.67567C14.9293 7.88938 14.9293 8.1093 14.887 8.32301C14.8243 8.56367 14.7337 8.68834 14.5523 8.93634C13.5597 10.2997 11.3837 12.6663 8.25233 12.6663C5.121 12.6663 2.945 10.2997 1.95233 8.93701Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M8.2474 9.33366C8.60102 9.33366 8.94016 9.19318 9.1902 8.94313C9.44025 8.69309 9.58073 8.35395 9.58073 8.00033C9.58073 7.6467 9.44025 7.30757 9.1902 7.05752C8.94016 6.80747 8.60102 6.66699 8.2474 6.66699C7.89377 6.66699 7.55464 6.80747 7.30459 7.05752C7.05454 7.30757 6.91406 7.6467 6.91406 8.00033C6.91406 8.35395 7.05454 8.69309 7.30459 8.94313C7.55464 9.19318 7.89377 9.33366 8.2474 9.33366Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</g>\n<defs>\n<clipPath id="clip0_8600_37557">\n<rect width="16" height="16" fill="white" transform="translate(0.25)"/>\n</clipPath>\n</defs>\n</svg>\n',cmd:e=>{this.setMode("source"==this.mode?"wysiwyg":"source"),e.classList.toggle("active","source"==this.mode)}}},clear:{removeStyle:{html:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M13.7972 13.6499H6.38173L3.40849 10.6131C3.27696 10.4808 3.20313 10.3018 3.20312 10.1152C3.20313 9.92861 3.27696 9.74962 3.40849 9.6173L10.4708 2.55498C10.6031 2.42344 10.7821 2.34961 10.9687 2.34961C11.1553 2.34961 11.3343 2.42344 11.4666 2.55498L14.9978 6.08614C15.1293 6.21846 15.2031 6.39745 15.2031 6.58403C15.2031 6.77061 15.1293 6.9496 14.9978 7.08192L8.50042 13.6499M13.0909 8.91813L8.64167 4.46886" stroke="black" stroke-width="1.41246" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',cmd:()=>g.setStyle()}}},h=o("textarea"),u=o("div"),f=o("div"),p=o("input"),g=new Squire(u,c);r.type="color",f.append(r);let m,v,C="squire-colors",y=e.getElementById(C),S=e=>y.append(new Option(e));for(m in y||(y=o("datalist"),y.id=C,S("rgba(0,0,0,0)"),S("#11161F"),S("#31393C"),S("#747F81"),S("#BFCDCE"),S("#FFFFFF"),S("#D74642"),S("#F59524"),S("#F6E120"),S("#99DD57"),S("#70B62B"),S("#37B760"),S("#39D5DA"),S("#0E8BEF"),S("#1B54EC"),S("#7454E3"),e.body.append(y)),r.setAttribute("list",C),p.type="file",p.accept="image/*",p.style.display="none",p.onchange=()=>{if(p.files.length){let e=new FileReader;e.readAsDataURL(p.files[0]),e.onloadend=()=>e.result&&g.insertImage(e.result)}},h.className="squire-plain",u.className="squire-wysiwyg",u.dir="auto",this.mode="",this.container=i,this.squire=g,this.plain=h,this.wysiwyg=u,dispatchEvent(new CustomEvent("squire-toolbar",{detail:{squire:this,actions:a}})),f.className="squire-toolbar btn-toolbar",a){let e=o("div");for(v in e.className="btn-group",e.id="squire-toolgroup-"+m,a[m]){let i,r=a[m][v],s="click";r.input?(i=o("input"),i.type=r.input,s="change"):r.select?(i=o("select"),i.className="btn",Array.isArray(r.select)?r.select.forEach(e=>{e=Array.isArray(e)?e:[e,e];var t=new Option(e[0],e[1]);t.style[v]=e[1],i.append(t)}):("font"==m?i.add(new Option("Шрифт","")):i.add(new Option(t("GLOBAL/DEFAULT"),"")),Object.entries(r.select).forEach(([e,t])=>{let n=o("optgroup");n.label=e,Object.entries(t).forEach(([e,t])=>{var o=new Option(e,t);o.style[v]=t,n.append(o)}),i.add(n)})),s="input"):(i=o("button"),i.type="button",i.className="btn",i.innerHTML=r.html,i.action_cmd=r.cmd),i.addEventListener(s,()=>r.cmd(i)),r.hint=t("EDITOR/"+v.toUpperCase()),r.hint?i.title=r.key?r.hint+" ("+n+r.key+")":r.hint:r.key&&(i.title=n+r.key),i.dataset.action=v,i.tabIndex=-1,r.input=i,e.append(i)}e.children.length&&f.append(e)}this.modeSelect=a.mode.plain.input;let k=a.changes;k.undo.input.disabled=k.redo.input.disabled=!0,g.addEventListener("undoStateChange",e=>{k.undo.input.disabled=!e.detail.canUndo,k.redo.input.disabled=!e.detail.canRedo}),g.addEventListener("pasteImage",e=>{const t=e.detail.clipboardData.items;let n=t.length;for(;n--;){const e=t[n];if(/^image\/(png|jpeg|webp)/.test(e.type)){let t=new FileReader;t.onload=e=>{let t=o("img"),n=o("canvas"),i=n.getContext("2d");t.onload=()=>{i.drawImage(t,0,0);let e=t.width,o=t.height;e>o?e>1024&&(o=1024*o/e,e=1024):o>1024&&(e=1024*e/o,o=1024),n.width=e,n.height=o,i.drawImage(t,0,0,e,o),g.insertHTML('<img alt="" style="width:100%;max-width:'+e+'px" src="'+n.toDataURL()+'">',!0)},t.src=e.target.result},t.readAsDataURL(e.getAsFile());break}}}),a.font.fontSize.input.selectedIndex=a.font.fontSize.defaultValueIndex,i.append(f,u,h);const E=e=>e.trim().replace(/(^["']*|["']*$)/g,"").trim().toLowerCase(),_=Object.values(a.font.fontFamily.input.options).map(e=>e.value.toLowerCase());let w=0;const N=getComputedStyle(g.getRoot()).fontFamily.split(",").map(E);_.some((e,t)=>{const n=e.split(",").some(e=>{const t=E(e);return N.some(e=>e===t)});return n&&(w=t),n});const x={},T=(e,t)=>{e.split(",").forEach(e=>{const n=E(e);void 0===x[n]&&(x[n]=t)})};T(_[w],w),_.forEach((e,t)=>{t!==w&&T(e,t)}),g.addEventListener("pathChange",()=>{const e=g.getRoot();let t=g.getSelection(),n=t.collapsed,o=n?t.endContainer:t?.commonAncestorContainer;if(!o||o instanceof Element||(o=o.parentElement),l(a,i=>{l(i,i=>{i.matches&&i.input.classList.toggle("active",!(!o||!(!n&&[...o.querySelectorAll(i.matches)].some(e=>t.intersectsNode(e))||o.closestWithin(i.matches,e))))})}),o){let t=a.font.fontSize.defaultValueIndex,n=w,i=!1,r=!1;do{if(!i&&o.style.fontFamily){i=!0,n=-1;const e=o.style.fontFamily.split(",");for(let t=0;t<e.length;t++){const o=x[E(e[t])];if(void 0!==o){n=o;break}}}!r&&o.style.fontSize&&(r=!0,t=a.font.fontSize.select.indexOf(o.style.fontSize)),o=o.parentElement}while((!i||!r)&&o&&o!==e);a.font.fontFamily.input.selectedIndex=n,a.font.fontSize.input.selectedIndex=t}})}doAction(e){this.squire[e](),this.squire.focus()}doList(e){let t=this.squire.getSelectionClosest("UL,OL")?.nodeName;t==e?this.squire.removeList():this.squire[{UL:"makeUnorderedList",OL:"makeOrderedList"}[e]]()}setMode(e){if(this.mode!=e){let t=this.container.classList,n="source"==this.mode;t.remove("squire-mode-"+this.mode),"plain"==e?this.plain.value=s(n?this.plain.value:this.squire.getHTML()):"source"==e?this.plain.value=this.squire.getHTML():(this.setData(n?this.plain.value:a(this.plain.value)),e="wysiwyg"),this.mode=e,t.add("squire-mode-"+e),this.onModeChange?.(),setTimeout(()=>this.focus(),1)}this.modeSelect.selectedIndex="plain"==this.mode?1:0}on(e,t){"mode"==e?this.onModeChange=t:(this.squire.addEventListener(e,t),this.plain.addEventListener(e,t))}execCommand(e,t){if("insertSignature"==e)if((t=Object.assign({clearCache:!1,isHtml:!1,insertBefore:!1,signature:""},t)).clearCache)this._prev_txt_sig=null;else try{const e=t.isHtml?s(t.signature):t.signature;if("plain"===this.mode){let n=this.plain.value,o=this._prev_txt_sig;o&&(n=n.replace(o,"").trim()),this.plain.value=t.insertBefore?"\n\n"+e+"\n\n"+n:n+"\n\n"+e}else{const e=this.squire.getRoot(),n=o("br"),i=o("div");i.className="rl-signature",i.innerHTML=t.isHtml?t.signature:a(t.signature),e.querySelectorAll("div.rl-signature").forEach(e=>e.remove()),t.insertBefore?e.prepend(i):e.append(i),i.before(n),i.before(n.cloneNode())}this._prev_txt_sig=e}catch(e){console.error(e)}}getData(){return"source"==this.mode?this.plain.value:r(this.squire.getHTML())}setData(e){const t=this.squire;t.setHTML(r(e));const n=t.getRoot(),o=t.getSelection();o.setStart(n,0),o.setEnd(n,0),t.setSelection(o)}getPlainData(){return this.plain.value}setPlainData(e){this.plain.value=e}blur(){this.squire.blur()}focus(){"plain"==this.mode?(this.plain.focus(),this.plain.setSelectionRange(0,0)):this.squire.focus()}}})(document);
