(e=>{const t=t=>e.location.pathname.replace(/\/+$/,"")+"/?/"+t,r=t=>e.getElementById("rl-"+t),o="1"==r("app").dataset.admin,a="application/json",n=e=>{r("loading").hidden=!0,e.hidden=!1},s=e=>{let t=r("loading-error");t.append(e),n(t)},i=t=>t?new Promise((r,o)=>{const a=e.createElement("script");a.onload=()=>r(),a.onerror=()=>o("Failed loading "+t),a.src=t,e.head.append(a)}):Promise.reject("src is empty");try{let t=e.cookie.match(/(^|;) ?smctoken=([^;]+)/);if(t=t?t[2]:localStorage.getItem("smctoken"),!t){let e=new Uint8Array(16);crypto.getRandomValues(e),t=encodeURIComponent(btoa(String.fromCharCode(...e)))}localStorage.setItem("smctoken",t),e.cookie="smctoken="+t+";path=/;samesite=strict"}catch(e){console.error(e)}let c={};window.rl={adminArea:()=>o,settings:{get:e=>c[e],set:(e,t)=>c[e]=t,app:e=>c.System[e]},setTitle:t=>e.title=(t||"")+(c.title?(t?" - ":"")+c.title:""),setData:e=>{c=e,rl.app.refresh()},loadScript:i,fetch:(e,t,r)=>{t=Object.assign({mode:"same-origin",cache:"no-cache",redirect:"error",referrerPolicy:"no-referrer",credentials:"same-origin",headers:{}},t);let o=1,n=(c.System||{}).token,s={};return r&&(t.method="POST",r instanceof FormData&&(r.forEach((e,t)=>{e instanceof File?o=0:Reflect.has(s,t)?(Array.isArray(s[t])||(s[t]=[s[t]]),s[t].push(e)):s[t]=e}),o?r=s:n&&r.set("XToken",n)),o&&(t.headers["Content-Type"]=a,r=JSON.stringify(r)),t.body=r),n&&(t.headers["X-SM-Token"]=n),fetch(e,t)},fetchJSON:(e,t,r)=>((t=Object.assign({headers:{}},t)).headers.Accept=a,rl.fetch(e,t,r).then(t=>{if(t.ok){const r=t.headers.get("Content-Type");return r.startsWith(a)?t.json():Promise.reject(new Error(`Invalid Content-Type '${r}' for url '${e}'`))}return Promise.reject(new Error("Network response error: "+t.status))}))},navigator.cookieEnabled?[].flat?rl.fetchJSON(t(`${o?"Admin":""}AppData/0/${Math.random().toString().slice(2)}/`)).then(r=>{c=r;const a=r.StaticLibsJs,n=()=>rl.app.bootstart();i(a).then(()=>i(a.replace("/libs.",`/${o?"admin":"app"}.`))).then(()=>r.PluginsLink?i(t(r.PluginsLink)):Promise.resolve()).then(()=>rl.app?n():e.addEventListener("readystatechange",()=>"complete"==e.readyState&&n())).catch(e=>{throw s(e),e})}).catch(e=>s(e)):n(r("BadBrowser")):n(r("NoCookie"))})(document);
