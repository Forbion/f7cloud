(e=>{addEventListener("rl-view-model.create",(t=>{if("PopupsCompose"===t.detail.viewModelTemplateID){let l=t.detail;l.nextcloudAttach=()=>{e.nextcloud.selectFiles().then((t=>{let o=[];t&&t.forEach((t=>{if(t.name){let o=l.addAttachmentHelper(Jua?.randomId(),t.name.replace(/^.*\/([^/]+)$/,"$1"),t.size);e.pluginRemoteRequest(((e,t)=>{o.uploading(!1).complete(!0),e?o.error(t?.Result?.error||"failed"):o.tempName(t.Result.tempName)}),"NextcloudAttachFile",{file:t.name})}else t.url&&o.push(t.url)})),o.length&&l.oEditor.editor.squire.insertHTML(o.join("<br>"))}))}}}));const t=document.getElementById("PopupsCompose").content.querySelector("#composeUploadButton");t&&t.after(Element.fromHTML('<a class="btn fontastic" data-bind="click: nextcloudAttach">Прикрепить файлы из F7</a>'))})(window.rl);